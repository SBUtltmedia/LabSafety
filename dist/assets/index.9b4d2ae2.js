var k=Object.defineProperty;var E=(t,i,o)=>i in t?k(t,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[i]=o;var b=(t,i,o)=>(E(t,typeof i!="symbol"?i+"":i,o),o);import{M as v,V as L,S as T,D as P,H as _,C as M,P as R,A as p,B as w,R as z,W,E as F,a as H,U as q,b as V,c as $}from"./vendor.f5249cf6.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))c(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&c(s)}).observe(document,{childList:!0,subtree:!0});function o(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerpolicy&&(n.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?n.credentials="include":a.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(a){if(a.ep)return;a.ep=!0;const n=o(a);fetch(a.href,n)}})();window.exports=window;function C(t,i){return t.getChildMeshes().find(o=>o.name===i)||null}function G(t){var c;const i=new URLSearchParams(document.location.search);(i.get("debug")===""||((c=i.get("debug"))==null?void 0:c.toLowerCase())==="true")&&t.debugLayer.show()}document.location.href.includes("github");const K=50,D=3,B="cylinder",S="liquid",U="placard";class Y{constructor(i,o){b(this,"highlightLayer");b(this,"highlightColor");b(this,"highlightReferences");b(this,"highlightingMeshes");b(this,"mesh");b(this,"attach",i=>{this.mesh=i,this.highlightLayer.addMesh(this.mesh,this.highlightColor)});b(this,"detach",()=>{this.highlightLayer.removeMesh(this.mesh),this.highlightReferences=0,this.highlightingMeshes=[]});b(this,"highlightSelf",()=>{this.highlightLayer.isEnabled=!0});b(this,"unhighlightSelf",()=>{this.highlightReferences||(this.highlightLayer.isEnabled=!1)});b(this,"highlightMesh",i=>{if(this.highlightingMeshes.find(c=>c===i))return!1;const o=i.getBehaviorByName(this.name);return o?(o.highlightReferences+=1,o.highlightSelf(),this.highlightingMeshes.push(i),!0):!1});b(this,"unhighlightMesh",i=>{const o=i.getBehaviorByName(this.name);if(!o)return!1;const c=this.highlightingMeshes.findIndex(a=>a===i);return c===-1?!1:(o.highlightReferences-=1,o.unhighlightSelf(),this.highlightingMeshes.splice(c,1),!0)});this.highlightLayer=i,this.highlightColor=o,this.highlightReferences=0,this.highlightingMeshes=[]}get name(){return"Highlight"}init(){}}const I=(t,i,o,c)=>{const a=t.getScene(),n=a.getMeshByName("Table");let s=v.CreateSphere(`pivot-${o}`,{diameterX:.15,diameterY:.33,diameterZ:.2},t.getScene());s.visibility=0,t.name=o,t.parent=s,t.rotationQuaternion=null;let d=v.CreateBox("LEFT_COLLISION");d.scaling.y=.01,d.scaling.x=.04,d.scaling.z=.04,d.parent=s,d.position.y+=.3,d.position.x-=.15,d.visibility=0;let e=v.CreateBox("RIGHT_COLLISION");if(e.scaling.y=.01,e.scaling.x=.04,e.scaling.z=.04,e.parent=s,e.position.y+=.3,e.position.x+=.15,e.visibility=0,t.getChildMeshes().forEach(m=>{switch(m.name){case"BeakerwOpacity":m.name=B,m.rotationQuaternion=null,m.rotation.z=2*Math.PI,m.isPickable=!1;break;case"BeakerLiquid":m.name=S,m.isPickable=!1;break}}),n){const m=n.getBoundingInfo().boundingBox,A=C(t,B).getBoundingInfo().boundingBox.maximum.y+1e-5;s.position.y=m.maximumWorld.y+A,s.position.x=(m.maximumWorld.x-m.minimumWorld.x)/D*i+m.minimumWorld.x-.3,s.position.z=(m.centerWorld.z+m.minimumWorld.z)/2}else s.position.x=-2+i,s.position.y=1.22,s.position.z=.5;s.checkCollisions=!0,s.ellipsoid=new L(.02,.16,.02);const f=C(t,S),h=new T("liquid-material");h.diffuseColor=c,f.material=h;const l=C(t,"Label"),r=new P("dynamic texture",256,a);r.uAng=Math.PI;const g=new T("Mat",a);g.diffuseTexture=r,l.material=g;const u="bold 220px monospace";r.drawText(t.name.split("-")[1].toUpperCase(),65,185,u,"black","white");const y=new _("highlight-layer");y.innerGlow=!0,y.outerGlow=!1,y.isEnabled=!1,C(t,B).addBehavior(new Y(y,M.Green())),Z(s,s.position.x,s.position.y,s.position.z)};function Z(t,i,o,c){let a,n=new R({dragPlaneNormal:new L(0,0,1)});n.useObjectOrientationForDragging=!1,n.moveAttached=!1,n.onDragStartObservable.add(()=>{a&&clearTimeout(a)}),n.onDragObservable.add(s=>{t.moveWithCollisions(s.delta)}),n.onDragEndObservable.add(()=>{a=setTimeout(()=>Q(t,i,o,c),K)}),t.addBehavior(n)}function Q(t,i,o,c){t.isPickable=!1;let a=t.name.split("-")[0],n=t.getScene(),s=t.getChildMeshes(),d=s.find(N=>N.name==="cylinder"),e=s.find(N=>N.name==="liquid"),f=e.visibility,h=new p("InvisibilityOfCylinder","visibility",120,p.ANIMATIONTYPE_FLOAT,p.ANIMATIONLOOPMODE_CONSTANT),l=new p("VisibilityOfCylinder","visibility",120,p.ANIMATIONTYPE_FLOAT,p.ANIMATIONLOOPMODE_CONSTANT),r=new p("InvisibilityOfLiquid","visibility",120,p.ANIMATIONTYPE_FLOAT,p.ANIMATIONLOOPMODE_CONSTANT),g=new p("VisibilityOfLiquid","visibility",120,p.ANIMATIONTYPE_FLOAT,p.ANIMATIONLOOPMODE_CONSTANT);const u=[];u.push({frame:0,value:f}),u.push({frame:60,value:0});const y=[];y.push({frame:0,value:0}),y.push({frame:60,value:f});const m=[];m.push({frame:0,value:1}),m.push({frame:60,value:0});const O=[];O.push({frame:0,value:0}),O.push({frame:60,value:1}),d.animations.push(h),d.animations.push(l),e.animations.push(r),e.animations.push(g),h.setKeys(m),l.setKeys(O),r.setKeys(u),g.setKeys(y),n.beginDirectAnimation(d,[h],0,60,!1),n.beginDirectAnimation(e,[r],0,60,!1,void 0,()=>{d.rotation.z=Math.PI*2,t.position.x=i,t.position.y=o,t.position.z=c,d.getAnimationByName(`${a}-rotateAroundZ`),n.beginDirectAnimation(d,[l],0,60,!1),n.beginDirectAnimation(e,[g],0,60,!1,void 0,()=>{t.isPickable=!0})})}function X(t){t.name="clipboard";const i=t.getScene(),o=i.getMeshByName("Table");if(o){const a=o.getBoundingInfo().boundingBox;t.position.y=a.maximumWorld.y+.003}t.rotationQuaternion=null,t.rotation=new L(0,Math.PI/4,0);const c=i.getMeshByName("pivot-Cylinder-A");c&&(t.position.x=c.position.x+.2,t.position.z=c.position.z+.5)}function j(t){var i=new w(M.FromHexString("#0984e3"));i.ignoreChildren=!0;var o=t[0],c=w.MakeNotPickableAndWrapInBoundingBox(o);i.attachedMesh=c,i.onScaleBoxDragObservable.add(()=>{console.log("scaleDrag")}),i.onScaleBoxDragEndObservable.add(()=>{const a=i.attachedMesh;if(a){const n=a.getHierarchyBoundingVectors(!0);console.log("size x:",n.max.x-n.min.x),console.log("size y:",n.max.y-n.min.y),console.log("size z:",n.max.z-n.min.z)}console.log("scaleEnd")}),i.onRotationSphereDragObservable.add(()=>{console.log("rotDrag")}),i.onRotationSphereDragEndObservable.add(()=>{console.log("rotEnd")})}function x(t,i,o){const c=t.find(l=>l.name==="__root__"),a=c.getScene();c.name=o;const n=t.find(l=>l.name==="Label"),s=t.find(l=>l.name==="Placard");s.name=U;const d=new P("dynamic texture",256,a);d.wAng=-Math.PI/2,d.uAng=Math.PI;const e=new T("Mat",a);e.diffuseTexture=d,n.material=e;const f="bold 220px monospace";d.drawText(c.name.split("-")[1].toUpperCase(),65,185,f,"black","white"),s.addChild(n),s.rotationQuaternion=null,s.rotation=new L(0,Math.PI/2,0);const h=a.getMeshByName("Table");if(h){const l=h.getBoundingInfo().boundingBox;c.position.y=l.maximumWorld.y+.003,c.position.x=(l.maximumWorld.x-l.minimumWorld.x)/D*i+l.minimumWorld.x-.2,c.position.z=(l.centerWorld.z+l.minimumWorld.z)/2+.2}}class J{constructor(i,o,c,a=0){b(this,"complete",!1);b(this,"title");b(this,"description");b(this,"failed",!1);b(this,"onFail");b(this,"onSuccess");b(this,"onCompletion");b(this,"currentState");b(this,"tasks");this.title=i,this.description=o,this.tasks=c,this.currentState=a}}function ee(t,i){t.onBeforeRenderObservable.add(function(){let a=["A","B","C"];for(let n=0;n<a.length;n++){const s=t.getMeshByName(`pivot-Cylinder-${a[n]}`),d=t.getMeshByName("Table");if(d&&s){const e=d.getBoundingInfo().boundingBox;s.position.z=(e.centerWorld.z+e.minimumWorld.z)/2}}});let o=["A","B","C"],c=[];for(let a of o){const n=t.getMeshByName(`pivot-Cylinder-${a}`);c.push(n);let s=new p(`${a}-rotateAroundZ`,"rotation.z",120,p.ANIMATIONTYPE_FLOAT,p.ANIMATIONLOOPMODE_CONSTANT),d=C(n,B);const e=[];e.push({frame:0,value:Math.PI*2}),e.push({frame:60,value:4.62}),d.animations.push(s),s.setKeys(e);let f=new p(`${a}-resetRotateAroundZ`,"rotation.z",120,p.ANIMATIONTYPE_FLOAT,p.ANIMATIONLOOPMODE_CONSTANT);const h=[];h.push({frame:0,value:4.62}),h.push({frame:60,value:Math.PI*2}),d.animations.push(f),f.setKeys(h)}for(let a=0;a<o.length;a++){const n=t.getMeshByName(`pivot-Cylinder-${o[a]}`),s=n.getBehaviorByName("PointerDrag");let d=[];for(let h of c)h!=n&&d.push(h);let e=C(n,B),f=!1;s.onDragObservable.add(()=>{const h=C(n,B).getBehaviorByName("Highlight");let l=!1;for(let r of d){let g=C(r,"LEFT_COLLISION"),u=C(r,"RIGHT_COLLISION"),y=C(r,B);if(n.intersectsMesh(g)||n.intersectsMesh(u)){l=!0;let m=r.name.split("-")[2],N=`${n.name.split("-")[2]}to${m}`;if(i.tasks[i.currentState].label===N&&(i.tasks[i.currentState].next==="complete"?window.location.assign("."):i.currentState=i.tasks.indexOf(i.tasks.find(A=>A.label==i.tasks[i.currentState].next))),h&&(h.highlightMesh(e),h.highlightMesh(y),n.intersectsMesh(g)?(y.rotation.y=Math.PI,e.rotation.y=0):(y.rotation.y=0,e.rotation.y=Math.PI),!f)){let A=e.getAnimationByName(`${o[a]}-rotateAroundZ`);f=!0,t.beginDirectAnimation(e,[A],0,60,!1,void 0,()=>{})}break}else h.unhighlightMesh(y)}if(l==!1){h.unhighlightMesh(e);let r=e.getAnimationByName(`${o[a]}-resetRotateAroundZ`);f&&(f=!1,t.beginDirectAnimation(e,[r],0,60,!1,void 0,()=>{}))}}),s.onDragEndObservable.add(()=>{const h=C(n,B).getBehaviorByName("Highlight");for(let l of d){let r=C(l,"LEFT_COLLISION"),g=C(l,"RIGHT_COLLISION"),u=C(l,B);if(h.unhighlightMesh(e),h.unhighlightMesh(u),e.intersectsMesh(r)||e.intersectsMesh(g)){let y=e.getAnimationByName(`${o[a]}-resetRotateAroundZ`);e.rotation.z==4.62&&t.beginDirectAnimation(e,[y],0,60,!1,void 0,()=>{})}}})}}class te{constructor(){let i,o=new J("","",[{next:"CtoA",label:"BtoC"},{next:"complete",label:"CtoA"}]);const c=[{fileName:"NewLaboratoryUNFINISHED.glb",callback:e=>s(e),label:"floor"},{fileName:"TLLGraduatedCylinderWithLabel.glb",callback:e=>I(e[0],1,"Cylinder-A",new M(1,0,0)),label:"Cylinder-A"},{fileName:"TLLGraduatedCylinderWithLabel.glb",callback:e=>I(e[0],2,"Cylinder-B",new M(0,1,0)),label:"Cylinder-B"},{fileName:"TLLGraduatedCylinderWithLabel.glb",callback:e=>I(e[0],3,"Cylinder-C",new M(0,0,1)),label:"Cylinder-C"},{fileName:"clipBoardWithPaperCompressedTexture.glb",callback:e=>X(e[0])},{fileName:"Placard_Label.glb",callback:e=>x(e,1,"Placard-A")},{fileName:"Placard_Label.glb",callback:e=>x(e,2,"Placard-B")},{fileName:"Placard_Label.glb",callback:e=>x(e,3,"Placard-C")}].map(function(e){return Object.assign({},{fileName:"LabBench.glb",root:"./models/",callback:j,label:"NoLabel"},e)});d().then(a);async function a(e){let f=e.getCameraByName("camera"),h=e.getLightByName("light1");f.speed=.16;let l=setInterval(()=>{h.intensity>=1?clearInterval(l):h.intensity+=.1},60);await n(e),e.getMeshByName("clipboard"),ee(e,o);let r,g;i.input.onControllerAddedObservable.add(u=>{u.onMotionControllerInitObservable.add(y=>{const m=new z(L.Zero(),L.Zero(),.25),O=y.getComponentOfType("squeeze");O.onButtonStateChangedObservable.add(()=>{if(y.rootMesh,O.pressed){u.getWorldPointerRayToRef(m,!0);let N=e.pickWithRay(m);(N==null?void 0:N.hit)&&N.pickedMesh.name.includes("pivot-Cylinder")&&(r=e.getMeshByName(N.pickedMesh.name),g=r==null?void 0:r.getBehaviorByName("PointerDrag"),g.dragging||(console.log("starting the drag"),g.startDrag()))}else r&&g.dragging&&(g.releaseDrag(),r=null,g=null)})})})}async function n(e){const f=["WallsandFloor","WallsAndFloor.001"],h=[];for(let r of f){console.log(r);const g=e.getMeshByName(r);g&&h.push(g)}let l={floorMeshes:h};W.CreateAsync(e,l)}function s(e){const f=["WallsandFloor","WallsAndFloor.001","Table","Roof","Countertop","Walls"];let h,l;for(let r of f){const g=e.find(u=>u.name===r);if(g&&(g.checkCollisions=!0,g.name==="Table")){const y=g.getBoundingInfo().boundingBox.center.x;h=g.getScene(),l=h.getCameraByName("camera"),l.position.x=y-.7}}}function d(){return new Promise(e=>{var f=document.getElementById("canvas"),h=new F(f,!0,{stencil:!0}),l=new H(h);l.collisionsEnabled=!0,window.addEventListener("resize",function(){h.resize()}),G(l);const r=new q("camera",new L(0,1.84,-1.134),l);r.ellipsoid=new L(.4,.7,.4),r.attachControl(f,!0),r.applyGravity=!0,r.minZ=0,r.speed=0,r.checkCollisions=!0,r.keysUp.push(87),r.keysDown.push(83),r.keysLeft.push(65),r.keysRight.push(68);var g=new V("light1",new L(1,1,0),l);g.intensity=0,Promise.all(c.map(u=>new Promise(y=>$.ImportMesh("",u.root,u.fileName,l,function(m){u.mesh=m,y(m)})))).then(()=>{c.map(u=>{u.callback(u.mesh),e(l)})}),window.addEventListener("keydown",u=>{u.shiftKey&&u.ctrlKey&&u.altKey&&u.keyCode===73&&(l.debugLayer.isVisible()?l.debugLayer.hide():l.debugLayer.show())}),h.runRenderLoop(()=>{l.render()})})}}}new te;
