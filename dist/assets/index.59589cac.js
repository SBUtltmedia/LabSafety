var $=Object.defineProperty;var U=(l,e,n)=>e in l?$(l,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[e]=n;var c=(l,e,n)=>(U(l,typeof e!="symbol"?e+"":e,n),n),V=(l,e,n)=>{if(!e.has(l))throw TypeError("Cannot "+n)};var W=(l,e,n)=>(V(l,e,"read from private field"),n?n.call(l):e.get(l)),F=(l,e,n)=>{if(e.has(l))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(l):e.set(l,n)};import{M as w,V as v,S as k,D as q,H as Y,C as I,P as Z,A as f,B as z,a as Q,R as X,b as H,c as D,W as j,E as J,d as ee,U as te,e as ie,f as ne}from"./vendor.8cc9db75.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const t of i)if(t.type==="childList")for(const h of t.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&o(h)}).observe(document,{childList:!0,subtree:!0});function n(i){const t={};return i.integrity&&(t.integrity=i.integrity),i.referrerpolicy&&(t.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?t.credentials="include":i.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function o(i){if(i.ep)return;i.ep=!0;const t=n(i);fetch(i.href,t)}})();window.exports=window;function p(l,e){return l.getChildMeshes().find(n=>n.name===e)||null}function oe(l){var o;const e=new URLSearchParams(document.location.search);(e.get("debug")===""||((o=e.get("debug"))==null?void 0:o.toLowerCase())==="true")&&l.debugLayer.show()}class ae{constructor(e,n,o,i=0){c(this,"complete",!1);c(this,"title");c(this,"description");c(this,"failed",!1);c(this,"onFail");c(this,"onSuccess");c(this,"onCompletion");c(this,"currentState");c(this,"tasks");this.title=e,this.description=n,this.tasks=o,this.currentState=i}}const B=60,se=50,K=3,M="cylinder",G="liquid",le="placard",re=new ae("","",[{next:"CtoA",label:"BtoC"},{next:"complete",label:"CtoA"}]),A={right:"handR2320",left:"handL2320"};class he{constructor(e,n){c(this,"highlightLayer");c(this,"highlightColor");c(this,"highlightReferences");c(this,"highlightingMeshes");c(this,"mesh");c(this,"attach",e=>{this.mesh=e,this.highlightLayer.addMesh(this.mesh,this.highlightColor)});c(this,"detach",()=>{this.highlightLayer.removeMesh(this.mesh),this.highlightReferences=0,this.highlightingMeshes=[]});c(this,"highlightSelf",()=>{this.highlightLayer.isEnabled=!0});c(this,"unhighlightSelf",()=>{this.highlightReferences||(this.highlightLayer.isEnabled=!1)});c(this,"highlightMesh",e=>{if(this.highlightingMeshes.find(o=>o===e))return!1;const n=e.getBehaviorByName(this.name);return n?(n.highlightReferences+=1,n.highlightSelf(),this.highlightingMeshes.push(e),!0):!1});c(this,"unhighlightMesh",e=>{const n=e.getBehaviorByName(this.name);if(!n)return!1;const o=this.highlightingMeshes.findIndex(i=>i===e);return o===-1?!1:(n.highlightReferences-=1,n.unhighlightSelf(),this.highlightingMeshes.splice(o,1),!0)});this.highlightLayer=e,this.highlightColor=n,this.highlightReferences=0,this.highlightingMeshes=[]}get name(){return"Highlight"}init(){}}class E{constructor(e,n,o,i){c(this,"name");c(this,"position");c(this,"mesh");console.log(e),this.name=o;const t=e.getScene(),h=t.getMeshByName("Table");let a=w.CreateSphere(`pivot-Cylinder-${o}`,{diameterX:.15,diameterY:.33,diameterZ:.2},e.getScene());a.visibility=0,e.name=o,e.parent=a,e.rotationQuaternion=null;let r=w.CreateBox("LEFT_COLLISION");r.scaling.y=.01,r.scaling.x=.04,r.scaling.z=.04,r.parent=a,r.position.y+=.3,r.position.x-=.15,r.visibility=0;let s=w.CreateBox("RIGHT_COLLISION");if(s.scaling.y=.01,s.scaling.x=.04,s.scaling.z=.04,s.parent=a,s.position.y+=.3,s.position.x+=.15,s.visibility=0,e.getChildMeshes().forEach(b=>{switch(b.name){case"BeakerwOpacity":b.name=M,b.rotationQuaternion=null,b.rotation.z=2*Math.PI,b.isPickable=!1;break;case"BeakerLiquid":b.name=G,b.isPickable=!1;break}}),h){const b=h.getBoundingInfo().boundingBox,x=p(e,M).getBoundingInfo().boundingBox.maximum.y+1e-5;a.position.y=b.maximumWorld.y+x,a.position.x=(b.maximumWorld.x-b.minimumWorld.x)/K*n+b.minimumWorld.x-.3,a.position.z=(b.centerWorld.z+b.minimumWorld.z)/2,this.position={...a.position}}else a.position.x=-2+n,a.position.y=1.22,a.position.z=.5;a.checkCollisions=!0,a.ellipsoid=new v(.02,.16,.02),this.mesh=a;const d=p(e,G),g=new k("liquid-material");g.diffuseColor=i,d.material=g;const m=p(e,"Label"),O=p(e,"LabelBack");console.log("Label:",m);const y=new q("dynamic texture",256,t);y.uAng=Math.PI;const u=new k("Mat",t);u.diffuseTexture=y,m.material=u,O.material=u;const L="bold 220px monospace";y.drawText(e.name.toUpperCase(),65,185,L,"black","white");const C=new Y("highlight-layer");C.innerGlow=!0,C.outerGlow=!1,C.isEnabled=!1,p(e,M).addBehavior(new he(C,I.Green())),this.addDragCollision()}addDragCollision(){let e=new Z({dragPlaneNormal:new v(0,0,1)});e.useObjectOrientationForDragging=!1,e.moveAttached=!1,e.onDragStartObservable.add(()=>{}),e.onDragObservable.add(n=>{this.mesh.moveWithCollisions(n.delta)}),e.onDragEndObservable.add(()=>{this.fadeAndRespawn()}),this.mesh.addBehavior(e)}fadeAndRespawn(e=se){setTimeout(()=>{this.mesh.isPickable=!1;let n=this.mesh.name.split("-")[0],o=this.mesh.getScene(),i=this.mesh.getChildMeshes(),t=i.find(u=>u.name==="cylinder"),h=i.find(u=>u.name==="liquid"),a=new f("InvisibilityOfCylinder","visibility",120,f.ANIMATIONTYPE_FLOAT,f.ANIMATIONLOOPMODE_CONSTANT),r=new f("VisibilityOfCylinder","visibility",120,f.ANIMATIONTYPE_FLOAT,f.ANIMATIONLOOPMODE_CONSTANT),s=new f("InvisibilityOfLiquid","visibility",120,f.ANIMATIONTYPE_FLOAT,f.ANIMATIONLOOPMODE_CONSTANT),d=new f("VisibilityOfLiquid","visibility",120,f.ANIMATIONTYPE_FLOAT,f.ANIMATIONLOOPMODE_CONSTANT);const g=[{frame:0,value:1},{frame:60,value:0}],m=[{frame:0,value:0},{frame:60,value:1}],O=[{frame:0,value:1},{frame:60,value:0}],y=[{frame:0,value:0},{frame:60,value:1}];t.animations=[a,r],h.animations=[s,d],a.setKeys(O),r.setKeys(y),s.setKeys(g),d.setKeys(m),o.beginDirectAnimation(t,[a],0,60,!1),o.beginDirectAnimation(h,[s],0,60,!1,void 0,()=>{t.rotation.z=Math.PI*2,console.log(this.mesh,this.position),this.mesh.position.x=this.position._x,this.mesh.position.y=this.position._y,this.mesh.position.z=this.position._z,t.getAnimationByName(`${n}-rotateAroundZ`),o.beginDirectAnimation(t,[r],0,60,!1),o.beginDirectAnimation(h,[d],0,60,!1,void 0,()=>{this.mesh.isPickable=!0})})},e)}}function de(l){l.name="clipboard";const e=l.getScene(),n=e.getMeshByName("Table");if(n){const i=n.getBoundingInfo().boundingBox;l.position.y=i.maximumWorld.y+.003}l.rotationQuaternion=null,l.rotation=new v(0,Math.PI/4,0);const o=e.getMeshByName("pivot-Cylinder-A");o&&(l.position.x=o.position.x+.2,l.position.z=o.position.z+.5)}function ce(l){var e=new z(I.FromHexString("#0984e3"));e.ignoreChildren=!0;var n=l[0],o=z.MakeNotPickableAndWrapInBoundingBox(n);e.attachedMesh=o,e.onScaleBoxDragObservable.add(()=>{console.log("scaleDrag")}),e.onScaleBoxDragEndObservable.add(()=>{const i=e.attachedMesh;if(i){const t=i.getHierarchyBoundingVectors(!0);console.log("size x:",t.max.x-t.min.x),console.log("size y:",t.max.y-t.min.y),console.log("size z:",t.max.z-t.min.z)}console.log("scaleEnd")}),e.onRotationSphereDragObservable.add(()=>{console.log("rotDrag")}),e.onRotationSphereDragEndObservable.add(()=>{console.log("rotEnd")})}function S(l,e,n){const o=l.find(g=>g.name==="__root__"),i=o.getScene();o.name=n;const t=l.find(g=>g.name==="Label"),h=l.find(g=>g.name==="Placard");h.name=le;const a=new q("dynamic texture",256,i);a.wAng=-Math.PI/2,a.uAng=Math.PI;const r=new k("Mat",i);r.diffuseTexture=a,t.material=r;const s="bold 220px monospace";a.drawText(o.name.split("-")[1].toUpperCase(),65,185,s,"black","white"),h.addChild(t),h.rotationQuaternion=null,h.rotation=new v(0,Math.PI/2,0);const d=i.getMeshByName("Table");if(d){const g=d.getBoundingInfo().boundingBox;o.position.y=g.maximumWorld.y+.003,o.position.x=(g.maximumWorld.x-g.minimumWorld.x)/K*e+g.minimumWorld.x-.2,o.position.z=(g.centerWorld.z+g.minimumWorld.z)/2+.2}}function ge(l,e){let n;return new Promise(o=>{const i="./models/",t="left.glb",h="right.glb";var a={};const r=new Q(l);r.addMeshTask("load left hand","",i,t),r.addMeshTask("load right hand","",i,h),r.onTaskSuccess=s=>{console.log("Task:",s.loadedMeshes[0]);for(let d of s.loadedMeshes)a[d.name]=d;console.log("MODELS: ",a),n=s.loadedAnimationGroups,console.log("Scene animation groups: ",l.animationGroups)},r.onTasksDoneObservable.add(()=>{for(let s=0;s<l.animationGroups.length;s++)l.animationGroups[s].pause();e.pointerSelection.detach(),e.input.onControllerAddedObservable.add(s=>{let d=s.inputSource.handedness,g=a[A[d]].parent.parent;a[A[d]].isPickable=!1,console.log(g);let m=(Object.keys(a).indexOf(A[d])-1)*2-1;console.log(a[A[d]]),a[A[d]].rotation.y=Math.PI*m,a[A[d]].rotation.z=0,a[A[d]].rotation.x=-Math.PI/4,g.parent=s.grip||s.pointer})}),r.loadAsync().then(()=>{o(n)})})}function me(l,e,n,o,i){let t;function h(a){for(let r of["A","B","C"]){let s=l.getMeshByName(`pivot-Cylinder-${r}`);if(a.intersectsMesh(s,!1))return s}return!1}e.input.onControllerAddedObservable.add(a=>{a.onMotionControllerInitObservable.add(r=>{let s=r;s.handID=r.handedness;let d=new X(v.Zero(),v.Zero(),.25);const g=r.getComponentOfType("squeeze"),m=r.getComponentOfType("trigger");function O(y,u){s.lastPosition=null,clearInterval(u),console.log("Dropped test tube"),s.grabbed=!1,s.meshGrabbed=void 0,console.log("Current hand: ",s),console.log(y),console.log(i),y&&i.find(C=>{console.log(C,y);let b=y.name.split("-");return C.name==b[b.length-1]}).fadeAndRespawn(100)}[m,g].forEach(y=>{y.onButtonStateChangedObservable.add(u=>{let L=A[s.handID],C;console.log("Trigger pressed: ",u.value);let b={left:0,right:7},N=l.animationGroups[b[s.handID]];console.log(N),N.goToFrame(u.value*(N._to-1)+1);let P=h(l.getMeshByName(A[s.handID]));if(u.value>0&&(s.lastPosition=Object.assign({},d.origin)),u.value>0&&!s.grabbed){if(P){t=P,s.meshGrabbed=t,s.grabbed=!0,a.getWorldPointerRayToRef(d),s.lastPosition=Object.assign({},d.origin),console.log("Current hand: ",s);let x=s.lastPosition,_=d.origin;_!=x&&(C=setInterval(()=>{let R=s.lastPosition;a.getWorldPointerRayToRef(d),R&&t&&t.moveWithCollisions(_.subtract(R)),!h(l.getMeshByName(L))&&t&&(console.log(L,t),O(t,C),t=null),s.lastPosition=Object.assign({},d.origin)},10))}}else(!u.value||!P)&&t&&(console.log(L,t),O(t,C),t=null)})})})})}function ue(l,e){l.onBeforeRenderObservable.add(function(){let i=["A","B","C"];for(let t=0;t<i.length;t++){const h=l.getMeshByName(`pivot-Cylinder-${i[t]}`),a=l.getMeshByName("Table");if(a&&h){const r=a.getBoundingInfo().boundingBox;h.position.z=(r.centerWorld.z+r.minimumWorld.z)/2}}});let n=["A","B","C"],o=[];for(let i of n){const t=l.getMeshByName(`pivot-Cylinder-${i}`);o.push(t);let h=new f(`${i}-rotateAroundZ`,"rotation.z",120,f.ANIMATIONTYPE_FLOAT,f.ANIMATIONLOOPMODE_CONSTANT),a=p(t,M);const r=[];r.push({frame:0,value:Math.PI*2}),r.push({frame:60,value:4.62}),a.animations.push(h),h.setKeys(r);let s=new f(`${i}-resetRotateAroundZ`,"rotation.z",120,f.ANIMATIONTYPE_FLOAT,f.ANIMATIONLOOPMODE_CONSTANT);const d=[];d.push({frame:0,value:4.62}),d.push({frame:60,value:Math.PI*2}),a.animations.push(s),s.setKeys(d)}for(let i=0;i<n.length;i++){const t=l.getMeshByName(`pivot-Cylinder-${n[i]}`),h=t.getBehaviorByName("PointerDrag");let a=[];for(let d of o)d!=t&&a.push(d);let r=p(t,M),s=!1;h.onDragObservable.add(()=>{const d=p(t,M).getBehaviorByName("Highlight");let g=!1;for(let m of a){let O=p(m,"LEFT_COLLISION"),y=p(m,"RIGHT_COLLISION"),u=p(m,M);if(t.intersectsMesh(O)||t.intersectsMesh(y)){g=!0;let L=m.name.split("-")[2],b=`${t.name.split("-")[2]}to${L}`;if(e.tasks[e.currentState].label===b&&(e.tasks[e.currentState].next==="complete"?window.location.assign("."):e.currentState=e.tasks.indexOf(e.tasks.find(N=>N.label==e.tasks[e.currentState].next))),d&&(d.highlightMesh(r),d.highlightMesh(u),t.intersectsMesh(O)?(u.rotation.y=Math.PI,r.rotation.y=0):(u.rotation.y=0,r.rotation.y=Math.PI),!s)){let N=r.getAnimationByName(`${n[i]}-rotateAroundZ`);s=!0,l.beginDirectAnimation(r,[N],0,60,!1,void 0,()=>{})}break}else d.unhighlightMesh(u)}if(g==!1){d.unhighlightMesh(r);let m=r.getAnimationByName(`${n[i]}-resetRotateAroundZ`);s&&(s=!1,l.beginDirectAnimation(r,[m],0,60,!1,void 0,()=>{}))}}),h.onDragEndObservable.add(()=>{const d=p(t,M).getBehaviorByName("Highlight");for(let g of a){let m=p(g,"LEFT_COLLISION"),O=p(g,"RIGHT_COLLISION"),y=p(g,M);if(d.unhighlightMesh(r),d.unhighlightMesh(y),r.intersectsMesh(m)||r.intersectsMesh(O)){let u=r.getAnimationByName(`${n[i]}-resetRotateAroundZ`);r.rotation.z==4.62&&l.beginDirectAnimation(r,[u],0,60,!1,void 0,()=>{})}}})}}var T;class fe{constructor(e){c(this,"flying",!1);c(this,"active",!1);c(this,"camera");c(this,"mesh");c(this,"offset",.3);c(this,"animations");c(this,"returnPosition");c(this,"returnRotation");c(this,"onPointerDownObserver");c(this,"xrCamera");c(this,"attach",(e,n,o,i,t)=>{const h=e.getScene();if(this.mesh=e,!n&&(n=h.activeCamera,!n))throw new Error("The scene has no active camera, and no camera was provided.");this.camera=n,o||(o=this.mesh.position),i||(i=this.mesh.rotation),t&&(this.offset=t),this.returnPosition=o,this.returnRotation=i,this.onPointerDownObserver=h.onPointerObservable.add(this.clipboardClick)});c(this,"detach",()=>{this.mesh.getScene().onPointerObservable.remove(this.onPointerDownObserver)});c(this,"clipboardClick",(e={type:H.POINTERDOWN,pickInfo:{pickedMesh:this.mesh}})=>{var n;if(e.type===H.POINTERDOWN){const o=(n=e.pickInfo)==null?void 0:n.pickedMesh;if(o&&(o===this.mesh||o.isDescendantOf(this.mesh))&&!this.flying){const i=this.active?B/2:0,t=this.active?0:B/2;W(this,T).call(this),this.flying=!0,this.mesh.billboardMode==D.BILLBOARDMODE_ALL?this.mesh.billboardMode=D.BILLBOARDMODE_NONE:this.mesh.billboardMode=D.BILLBOARDMODE_ALL,this.mesh.getScene().beginDirectAnimation(this.mesh,this.animations,i,t,!1,void 0,()=>{this.flying=!1,this.active=!this.active})}}});c(this,"calculateTargetPositionWithOffset",e=>{if(this.xrCamera!==void 0&&this.xrCamera.state===j.IN_XR){const h=this.xrCamera.camera._position.subtract(this.returnPosition).scale(1-e/v.Distance(this.returnPosition,this.xrCamera.camera._position));return this.returnPosition.add(h)}const o=this.camera._position.subtract(this.returnPosition).scale(1-e/v.Distance(this.returnPosition,this.camera._position));return this.returnPosition.add(o)});c(this,"setClipboardUp",()=>new v(3.1468286,4.6617744,1.680752));F(this,T,()=>{const e=this.animations.find(({name:t})=>t==="translate"),n=this.animations.find(({name:t})=>t==="rotate"),o=[{frame:0,value:this.returnPosition},{frame:B/2,value:this.calculateTargetPositionWithOffset(this.offset)}],i=[{frame:0,value:this.returnRotation},{frame:B/2,value:this.setClipboardUp()}];e.setKeys(o),n.setKeys(i)});const n=new f("translate","position",B,f.ANIMATIONTYPE_VECTOR3),o=new f("rotate","rotation",B,f.ANIMATIONTYPE_VECTOR3);this.animations=[n,o],this.xrCamera=e}get name(){return"FlyToCamera"}init(){}}T=new WeakMap;class be{constructor(){c(this,"handAnimation");c(this,"sop");c(this,"models");c(this,"cylinders");this.cylinders=[],this.models=[{fileName:"NewLaboratoryUNFINISHED.glb",callback:e=>this.createRoom(e),label:"floor"},{fileName:"clipBoardWithPaperCompressedTexture.glb",callback:e=>de(e[0])},{fileName:"Placard_Label.glb",callback:e=>S(e,1,"Placard-A")},{fileName:"Placard_Label.glb",callback:e=>S(e,2,"Placard-B")},{fileName:"Placard_Label.glb",callback:e=>S(e,3,"Placard-C")},{fileName:"TLLGraduatedCylinderWithLabel.glb",callback:e=>this.cylinders.push(new E(e[0],1,"A",new I(1,0,0))),label:"Cylinder-A"},{fileName:"TLLGraduatedCylinderWithLabel.glb",callback:e=>this.cylinders.push(new E(e[0],2,"B",new I(0,1,0))),label:"Cylinder-B"},{fileName:"TLLGraduatedCylinderWithLabel.glb",callback:e=>this.cylinders.push(new E(e[0],3,"C",new I(0,0,1))),label:"Cylinder-C"}].map(function(e){return Object.assign({},{fileName:"LabBench.glb",root:"./models/",callback:ce,label:"NoLabel"},e)}),this.createScene().then(e=>{let n={};for(let o of["A","B","C"])n[`pivot-Cylinder-${o}`]=Object.assign({},e.getMeshByName(`pivot-Cylinder-${o}`).position);this.processScene(e,n,this.cylinders)})}async processScene(e,n,o){let i=e.getCameraByName("camera"),t=e.getLightByName("light1"),h={};i.speed=.16;let a=setInterval(()=>{t.intensity>=1?clearInterval(a):t.intensity+=.1},60);const r=["WallsandFloor","WallsAndFloor.001"],s=[];for(let g of r){console.log(g);const m=e.getMeshByName(g);m&&s.push(m)}let d={floorMeshes:s,inputOptions:{doNotLoadControllerMeshes:!0}};h=await e.createDefaultXRExperienceAsync(d),h.pointerSelection.displayLaserPointer=!1,h.pointerSelection.displaySelectionMesh=!1,ge(e,h).then(g=>{const m=e.getMeshByName("clipboard");if(h){const O=new fe(h.baseExperience);m.addBehavior(O)}console.log(this.models[2]),ue(e,re),me(e,h,g,n,o)})}createRoom(e){const n=["WallsandFloor","WallsAndFloor.001","Table","Roof","Countertop","Walls"];let o,i;for(let t of n){const h=e.find(a=>a.name===t);if(h&&(h.checkCollisions=!0,h.name==="Table")){const r=h.getBoundingInfo().boundingBox.center.x;o=h.getScene(),i=o.getCameraByName("camera"),i.position.x=r-.7}}}createScene(){return new Promise(e=>{var n=document.getElementById("canvas"),o=new J(n,!0,{stencil:!0}),i=new ee(o);i.debugLayer.show(),i.collisionsEnabled=!0,window.addEventListener("resize",function(){o.resize()}),oe(i);const t=new te("camera",new v(0,1.84,-1.134),i);t.ellipsoid=new v(.4,.7,.4),t.attachControl(n,!0),t.applyGravity=!0,t.minZ=0,t.speed=0,t.checkCollisions=!0,t.keysUp.push(87),t.keysDown.push(83),t.keysLeft.push(65),t.keysRight.push(68);var h=new ie("light1",new v(1,1,0),i);h.intensity=0,Promise.all(this.models.map(a=>new Promise(r=>ne.ImportMesh("",a.root,a.fileName,i,function(s){a.mesh=s,r(s)})))).then(()=>{let a=[];this.models.map(r=>{a.push(r.callback(r.mesh)),e(i)})}),window.addEventListener("keydown",a=>{a.shiftKey&&a.ctrlKey&&a.altKey&&a.keyCode===73&&(i.debugLayer.isVisible()?i.debugLayer.hide():i.debugLayer.show())}),o.runRenderLoop(()=>{i.render()})})}}new be;
