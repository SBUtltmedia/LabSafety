var G=Object.defineProperty;var K=(i,e,n)=>e in i?G(i,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[e]=n;var c=(i,e,n)=>(K(i,typeof e!="symbol"?e+"":e,n),n),V=(i,e,n)=>{if(!e.has(i))throw TypeError("Cannot "+n)};var k=(i,e,n)=>(V(i,e,"read from private field"),n?n.call(i):e.get(i)),R=(i,e,n)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,n)};import{M as x,V as N,S as E,D as F,H as U,C as I,P as Y,A as p,B as _,a as W,b as w,W as $,R as Z,E as X,c as Q,U as j,d as J,e as ee,f as te}from"./vendor.6b852071.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();window.exports=window;function O(i,e){return i.getChildMeshes().find(n=>n.name===e)||null}function ie(i){var s;const e=new URLSearchParams(document.location.search);(e.get("debug")===""||((s=e.get("debug"))==null?void 0:s.toLowerCase())==="true")&&i.debugLayer.show()}document.location.href.includes("github");const L=60,ne=50,H=3,A="cylinder",z="liquid",ae="placard";class oe{constructor(e,n){c(this,"highlightLayer");c(this,"highlightColor");c(this,"highlightReferences");c(this,"highlightingMeshes");c(this,"mesh");c(this,"attach",e=>{this.mesh=e,this.highlightLayer.addMesh(this.mesh,this.highlightColor)});c(this,"detach",()=>{this.highlightLayer.removeMesh(this.mesh),this.highlightReferences=0,this.highlightingMeshes=[]});c(this,"highlightSelf",()=>{this.highlightLayer.isEnabled=!0});c(this,"unhighlightSelf",()=>{this.highlightReferences||(this.highlightLayer.isEnabled=!1)});c(this,"highlightMesh",e=>{if(this.highlightingMeshes.find(s=>s===e))return!1;const n=e.getBehaviorByName(this.name);return n?(n.highlightReferences+=1,n.highlightSelf(),this.highlightingMeshes.push(e),!0):!1});c(this,"unhighlightMesh",e=>{const n=e.getBehaviorByName(this.name);if(!n)return!1;const s=this.highlightingMeshes.findIndex(o=>o===e);return s===-1?!1:(n.highlightReferences-=1,n.unhighlightSelf(),this.highlightingMeshes.splice(s,1),!0)});this.highlightLayer=e,this.highlightColor=n,this.highlightReferences=0,this.highlightingMeshes=[]}get name(){return"Highlight"}init(){}}const D=(i,e,n,s)=>{const o=i.getScene(),a=o.getMeshByName("Table");let r=x.CreateSphere(`pivot-${n}`,{diameterX:.15,diameterY:.33,diameterZ:.2},i.getScene());r.visibility=0,i.name=n,i.parent=r,i.rotationQuaternion=null;let g=x.CreateBox("LEFT_COLLISION");g.scaling.y=.01,g.scaling.x=.04,g.scaling.z=.04,g.parent=r,g.position.y+=.3,g.position.x-=.15,g.visibility=0;let t=x.CreateBox("RIGHT_COLLISION");if(t.scaling.y=.01,t.scaling.x=.04,t.scaling.z=.04,t.parent=r,t.position.y+=.3,t.position.x+=.15,t.visibility=0,i.getChildMeshes().forEach(f=>{switch(f.name){case"BeakerwOpacity":f.name=A,f.rotationQuaternion=null,f.rotation.z=2*Math.PI,f.isPickable=!1;break;case"BeakerLiquid":f.name=z,f.isPickable=!1;break}}),a){const f=a.getBoundingInfo().boundingBox,B=O(i,A).getBoundingInfo().boundingBox.maximum.y+1e-5;r.position.y=f.maximumWorld.y+B+.5,r.position.x=(f.maximumWorld.x-f.minimumWorld.x)/H*e+f.minimumWorld.x-.3,r.position.z=(f.centerWorld.z+f.minimumWorld.z)/2}else r.position.x=-2+e,r.position.y=1.22,r.position.z=.5;r.checkCollisions=!0,r.ellipsoid=new N(.02,.16,.02);const y=O(i,z),h=new E("liquid-material");h.diffuseColor=s,y.material=h;const l=O(i,"Label"),d=new F("dynamic texture",256,o);d.uAng=Math.PI;const u=new E("Mat",o);u.diffuseTexture=d,l.material=u;const m="bold 220px monospace";d.drawText(i.name.split("-")[1].toUpperCase(),65,185,m,"black","white");const b=new U("highlight-layer");b.innerGlow=!0,b.outerGlow=!1,b.isEnabled=!1,O(i,A).addBehavior(new oe(b,I.Green())),se(r,r.position.x,r.position.y,r.position.z)};function se(i,e,n,s){let o,a=new Y({dragPlaneNormal:new N(0,0,1)});a.useObjectOrientationForDragging=!1,a.moveAttached=!1,a.onDragStartObservable.add(()=>{o&&clearTimeout(o)}),a.onDragObservable.add(r=>{i.moveWithCollisions(r.delta)}),a.onDragEndObservable.add(()=>{o=setTimeout(()=>re(i,e,n,s),ne)}),i.addBehavior(a)}function re(i,e,n,s){i.isPickable=!1;let o=i.name.split("-")[0],a=i.getScene(),r=i.getChildMeshes(),g=r.find(C=>C.name==="cylinder"),t=r.find(C=>C.name==="liquid"),y=t.visibility,h=new p("InvisibilityOfCylinder","visibility",120,p.ANIMATIONTYPE_FLOAT,p.ANIMATIONLOOPMODE_CONSTANT),l=new p("VisibilityOfCylinder","visibility",120,p.ANIMATIONTYPE_FLOAT,p.ANIMATIONLOOPMODE_CONSTANT),d=new p("InvisibilityOfLiquid","visibility",120,p.ANIMATIONTYPE_FLOAT,p.ANIMATIONLOOPMODE_CONSTANT),u=new p("VisibilityOfLiquid","visibility",120,p.ANIMATIONTYPE_FLOAT,p.ANIMATIONLOOPMODE_CONSTANT);const m=[];m.push({frame:0,value:y}),m.push({frame:60,value:0});const b=[];b.push({frame:0,value:0}),b.push({frame:60,value:y});const f=[];f.push({frame:0,value:1}),f.push({frame:60,value:0});const v=[];v.push({frame:0,value:0}),v.push({frame:60,value:1}),g.animations.push(h),g.animations.push(l),t.animations.push(d),t.animations.push(u),h.setKeys(f),l.setKeys(v),d.setKeys(m),u.setKeys(b),a.beginDirectAnimation(g,[h],0,60,!1),a.beginDirectAnimation(t,[d],0,60,!1,void 0,()=>{g.rotation.z=Math.PI*2,i.position.x=e,i.position.y=n,i.position.z=s,g.getAnimationByName(`${o}-rotateAroundZ`),a.beginDirectAnimation(g,[l],0,60,!1),a.beginDirectAnimation(t,[u],0,60,!1,void 0,()=>{i.isPickable=!0})})}function le(i){i.name="clipboard";const e=i.getScene(),n=e.getMeshByName("Table");if(n){const o=n.getBoundingInfo().boundingBox;i.position.y=o.maximumWorld.y+.003}i.rotationQuaternion=null,i.rotation=new N(0,Math.PI/4,0);const s=e.getMeshByName("pivot-Cylinder-A");s&&(i.position.x=s.position.x+.2,i.position.z=s.position.z+.5)}function he(i){var e=new _(I.FromHexString("#0984e3"));e.ignoreChildren=!0;var n=i[0],s=_.MakeNotPickableAndWrapInBoundingBox(n);e.attachedMesh=s,e.onScaleBoxDragObservable.add(()=>{console.log("scaleDrag")}),e.onScaleBoxDragEndObservable.add(()=>{const o=e.attachedMesh;if(o){const a=o.getHierarchyBoundingVectors(!0);console.log("size x:",a.max.x-a.min.x),console.log("size y:",a.max.y-a.min.y),console.log("size z:",a.max.z-a.min.z)}console.log("scaleEnd")}),e.onRotationSphereDragObservable.add(()=>{console.log("rotDrag")}),e.onRotationSphereDragEndObservable.add(()=>{console.log("rotEnd")})}function S(i,e,n){const s=i.find(l=>l.name==="__root__"),o=s.getScene();s.name=n;const a=i.find(l=>l.name==="Label"),r=i.find(l=>l.name==="Placard");r.name=ae;const g=new F("dynamic texture",256,o);g.wAng=-Math.PI/2,g.uAng=Math.PI;const t=new E("Mat",o);t.diffuseTexture=g,a.material=t;const y="bold 220px monospace";g.drawText(s.name.split("-")[1].toUpperCase(),65,185,y,"black","white"),r.addChild(a),r.rotationQuaternion=null,r.rotation=new N(0,Math.PI/2,0);const h=o.getMeshByName("Table");if(h){const l=h.getBoundingInfo().boundingBox;s.position.y=l.maximumWorld.y+.003,s.position.x=(l.maximumWorld.x-l.minimumWorld.x)/H*e+l.minimumWorld.x-.2,s.position.z=(l.centerWorld.z+l.minimumWorld.z)/2+.2}}class ce{constructor(e,n,s,o=0){c(this,"complete",!1);c(this,"title");c(this,"description");c(this,"failed",!1);c(this,"onFail");c(this,"onSuccess");c(this,"onCompletion");c(this,"currentState");c(this,"tasks");this.title=e,this.description=n,this.tasks=s,this.currentState=o}}function de(i,e){i.onBeforeRenderObservable.add(function(){let o=["A","B","C"];for(let a=0;a<o.length;a++){const r=i.getMeshByName(`pivot-Cylinder-${o[a]}`),g=i.getMeshByName("Table");if(g&&r){const t=g.getBoundingInfo().boundingBox;r.position.z=(t.centerWorld.z+t.minimumWorld.z)/2}}});let n=["A","B","C"],s=[];for(let o of n){const a=i.getMeshByName(`pivot-Cylinder-${o}`);s.push(a);let r=new p(`${o}-rotateAroundZ`,"rotation.z",120,p.ANIMATIONTYPE_FLOAT,p.ANIMATIONLOOPMODE_CONSTANT),g=O(a,A);const t=[];t.push({frame:0,value:Math.PI*2}),t.push({frame:60,value:4.62}),g.animations.push(r),r.setKeys(t);let y=new p(`${o}-resetRotateAroundZ`,"rotation.z",120,p.ANIMATIONTYPE_FLOAT,p.ANIMATIONLOOPMODE_CONSTANT);const h=[];h.push({frame:0,value:4.62}),h.push({frame:60,value:Math.PI*2}),g.animations.push(y),y.setKeys(h)}for(let o=0;o<n.length;o++){const a=i.getMeshByName(`pivot-Cylinder-${n[o]}`),r=a.getBehaviorByName("PointerDrag");let g=[];for(let h of s)h!=a&&g.push(h);let t=O(a,A),y=!1;r.onDragObservable.add(()=>{console.log("DRAGGING");const h=O(a,A).getBehaviorByName("Highlight");let l=!1;for(let d of g){let u=O(d,"LEFT_COLLISION"),m=O(d,"RIGHT_COLLISION"),b=O(d,A);if(a.intersectsMesh(u)||a.intersectsMesh(m)){l=!0;let f=d.name.split("-")[2],C=`${a.name.split("-")[2]}to${f}`;if(e.tasks[e.currentState].label===C&&(e.tasks[e.currentState].next==="complete"?window.location.assign("."):e.currentState=e.tasks.indexOf(e.tasks.find(B=>B.label==e.tasks[e.currentState].next))),h&&(h.highlightMesh(t),h.highlightMesh(b),a.intersectsMesh(u)?(b.rotation.y=Math.PI,t.rotation.y=0):(b.rotation.y=0,t.rotation.y=Math.PI),!y)){let B=t.getAnimationByName(`${n[o]}-rotateAroundZ`);y=!0,i.beginDirectAnimation(t,[B],0,60,!1,void 0,()=>{})}break}else h.unhighlightMesh(b)}if(l==!1){h.unhighlightMesh(t);let d=t.getAnimationByName(`${n[o]}-resetRotateAroundZ`);y&&(y=!1,i.beginDirectAnimation(t,[d],0,60,!1,void 0,()=>{}))}}),r.onDragEndObservable.add(()=>{const h=O(a,A).getBehaviorByName("Highlight");for(let l of g){let d=O(l,"LEFT_COLLISION"),u=O(l,"RIGHT_COLLISION"),m=O(l,A);if(h.unhighlightMesh(t),h.unhighlightMesh(m),t.intersectsMesh(d)||t.intersectsMesh(u)){let b=t.getAnimationByName(`${n[o]}-resetRotateAroundZ`);t.rotation.z==4.62&&i.beginDirectAnimation(t,[b],0,60,!1,void 0,()=>{})}}})}}var P;class ge{constructor(e){c(this,"flying",!1);c(this,"active",!1);c(this,"camera");c(this,"mesh");c(this,"offset",.3);c(this,"animations");c(this,"returnPosition");c(this,"returnRotation");c(this,"onPointerDownObserver");c(this,"xrCamera");c(this,"attach",(e,n,s,o,a)=>{const r=e.getScene();if(this.mesh=e,!n&&(n=r.activeCamera,!n))throw new Error("The scene has no active camera, and no camera was provided.");this.camera=n,s||(s=this.mesh.position),o||(o=this.mesh.rotation),a&&(this.offset=a),this.returnPosition=s,this.returnRotation=o,this.onPointerDownObserver=r.onPointerObservable.add(this.clipboardClick)});c(this,"detach",()=>{this.mesh.getScene().onPointerObservable.remove(this.onPointerDownObserver)});c(this,"clipboardClick",(e={type:W.POINTERDOWN,pickInfo:{pickedMesh:this.mesh}})=>{var n;if(e.type===W.POINTERDOWN){const s=(n=e.pickInfo)==null?void 0:n.pickedMesh;if(s&&(s===this.mesh||s.isDescendantOf(this.mesh))&&!this.flying){const o=this.active?L/2:0,a=this.active?0:L/2;k(this,P).call(this),this.flying=!0,this.mesh.billboardMode==w.BILLBOARDMODE_ALL?this.mesh.billboardMode=w.BILLBOARDMODE_NONE:this.mesh.billboardMode=w.BILLBOARDMODE_ALL,this.mesh.getScene().beginDirectAnimation(this.mesh,this.animations,o,a,!1,void 0,()=>{this.flying=!1,this.active=!this.active})}}});c(this,"calculateTargetPositionWithOffset",e=>{if(this.xrCamera!==void 0&&this.xrCamera.state===$.IN_XR){const r=this.xrCamera.camera._position.subtract(this.returnPosition).scale(1-e/N.Distance(this.returnPosition,this.xrCamera.camera._position));return this.returnPosition.add(r)}const s=this.camera._position.subtract(this.returnPosition).scale(1-e/N.Distance(this.returnPosition,this.camera._position));return this.returnPosition.add(s)});c(this,"setClipboardUp",()=>new N(3.1468286,4.6617744,1.680752));R(this,P,()=>{const e=this.animations.find(({name:a})=>a==="translate"),n=this.animations.find(({name:a})=>a==="rotate"),s=[{frame:0,value:this.returnPosition},{frame:L/2,value:this.calculateTargetPositionWithOffset(this.offset)}],o=[{frame:0,value:this.returnRotation},{frame:L/2,value:this.setClipboardUp()}];e.setKeys(s),n.setKeys(o)});const n=new p("translate","position",L,p.ANIMATIONTYPE_VECTOR3),s=new p("rotate","rotation",L,p.ANIMATIONTYPE_VECTOR3);this.animations=[n,s],this.xrCamera=e}get name(){return"FlyToCamera"}init(){}}P=new WeakMap;class ue{constructor(){let e,n=new ce("","",[{next:"CtoA",label:"BtoC"},{next:"complete",label:"CtoA"}]);const s=[{fileName:"NewLaboratoryUNFINISHED.glb",callback:t=>r(t),label:"floor"},{fileName:"TLLGraduatedCylinderWithLabel.glb",callback:t=>D(t[0],1,"Cylinder-A",new I(1,0,0)),label:"Cylinder-A"},{fileName:"TLLGraduatedCylinderWithLabel.glb",callback:t=>D(t[0],2,"Cylinder-B",new I(0,1,0)),label:"Cylinder-B"},{fileName:"TLLGraduatedCylinderWithLabel.glb",callback:t=>D(t[0],3,"Cylinder-C",new I(0,0,1)),label:"Cylinder-C"},{fileName:"clipBoardWithPaperCompressedTexture.glb",callback:t=>le(t[0])},{fileName:"Placard_Label.glb",callback:t=>S(t,1,"Placard-A")},{fileName:"Placard_Label.glb",callback:t=>S(t,2,"Placard-B")},{fileName:"Placard_Label.glb",callback:t=>S(t,3,"Placard-C")}].map(function(t){return Object.assign({},{fileName:"LabBench.glb",root:"./models/",callback:he,label:"NoLabel"},t)});g().then(o);async function o(t){let y=t.getCameraByName("camera"),h=t.getLightByName("light1");y.speed=.16;let l=setInterval(()=>{h.intensity>=1?clearInterval(l):h.intensity+=.1},60);await a(t);const d=t.getMeshByName("clipboard");if(e){const b=new ge(e.baseExperience);d.addBehavior(b)}de(t,n);let u,m;e.input.onControllerAddedObservable.add(b=>{b.onMotionControllerInitObservable.add(f=>{f.handID=f.handedness;let v=f,C=new Z(N.Zero(),N.Zero(),.25);b.getWorldPointerRayToRef(C);const B=f.getComponentOfType("squeeze");B.onButtonStateChangedObservable.add(()=>{if(B.pressed&&!v.grabbed){console.log("pressed"),v.grabbed=!0,v.meshGrabbed=t.getMeshByName("pivot-Cylinder-A"),b.getWorldPointerRayToRef(C);let M=t.pickWithRay(C);new te(C).show(t),(M==null?void 0:M.hit)&&M.pickedMesh.name.includes("pivot-Cylinder")&&(u=t.getMeshByName(M.pickedMesh.name),m=u==null?void 0:u.getBehaviorByName("PointerDrag"),console.log("gotCylinder"),m.dragging||t.onBeforeRenderObservable.add(function(){let T=v.lastPosition;if(console.log(T),T){b.getWorldPointerRayToRef(C);let q=C.origin;Math.random()>.9&&console.log(C.origin),u.moveWithCollisions(q.subtract(T))}v.lastPosition=Object.assign({},C.origin)}))}else u&&m.dragging&&(m.releaseDrag(),u=null,m=null),v.grabbed=!1,v.meshGrabbed=void 0})})})}async function a(t){const y=["WallsandFloor","WallsAndFloor.001"],h=[];for(let d of y){console.log(d);const u=t.getMeshByName(d);u&&h.push(u)}let l={floorMeshes:h};e=await t.createDefaultXRExperienceAsync(l),e.pointerSelection.detach()}function r(t){const y=["WallsandFloor","WallsAndFloor.001","Table","Roof","Countertop","Walls"];let h,l;for(let d of y){const u=t.find(m=>m.name===d);if(u&&(u.checkCollisions=!0,u.name==="Table")){const b=u.getBoundingInfo().boundingBox.center.x;h=u.getScene(),l=h.getCameraByName("camera"),l.position.x=b-.7}}}function g(){return new Promise(t=>{var y=document.getElementById("canvas"),h=new X(y,!0,{stencil:!0}),l=new Q(h);l.collisionsEnabled=!0,window.addEventListener("resize",function(){h.resize()}),ie(l);const d=new j("camera",new N(0,1.84,-1.134),l);d.ellipsoid=new N(.4,.7,.4),d.attachControl(y,!0),d.applyGravity=!0,d.minZ=0,d.speed=0,d.checkCollisions=!0,d.keysUp.push(87),d.keysDown.push(83),d.keysLeft.push(65),d.keysRight.push(68);var u=new J("light1",new N(1,1,0),l);u.intensity=0,Promise.all(s.map(m=>new Promise(b=>ee.ImportMesh("",m.root,m.fileName,l,function(f){m.mesh=f,b(f)})))).then(()=>{s.map(m=>{m.callback(m.mesh),t(l)})}),window.addEventListener("keydown",m=>{m.shiftKey&&m.ctrlKey&&m.altKey&&m.keyCode===73&&(l.debugLayer.isVisible()?l.debugLayer.hide():l.debugLayer.show())}),h.runRenderLoop(()=>{l.render()})})}}}new ue;
