import{D as me,S as D,V as f,H as Me,M as ue,T as _,P as z,C as ie,a as w,b as Ce,A as y,c as k,d as xe,e as se,f as ne,R as oe,g as ae,B as re,W as E,E as J,h as Se,i as K,j as Pe,k as le,l as ve,m as we,U as Ie,n as Oe,o as Te,G as he}from"./vendor.24c67432.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function t(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();window.exports=window;class Ae{complete=!1;title;description;failed=!1;onFail;onSuccess;onCompletion;currentState;tasks;constructor(e,i,t,s=0){this.title=e,this.description=i,this.tasks=t,this.currentState=s}resetSOP=()=>{this.currentState=0,this.failed=!1,this.complete=!1}}const $="./",B=60,Ee=50,pe=3,Ne=.12,T="cylinder",R="liquid",ke="placard",x=new Ae("","",[{next:"CtoA",label:"BtoC"},{next:"complete",label:"CtoA"}]);function j(m,e,i){const t=m.find(h=>h.name==="__root__"),s=t.getScene();t.name=i;const n=m.find(h=>h.name==="Label"),o=m.find(h=>h.name==="Placard");o.name=ke;const l=new me("dynamic texture",256,s);l.wAng=-Math.PI/2,l.uAng=Math.PI;const a=new D("Mat",s);a.diffuseTexture=l,n.material=a;const c="bold 220px monospace";l.drawText(t.name.split("-")[1].toUpperCase(),65,185,c,"black","white"),o.addChild(n),o.rotationQuaternion=null,o.rotation=new f(0,Math.PI/2,0);const d=s.getMeshByName("Table");if(d){const h=d.getBoundingInfo().boundingBox;t.position.y=h.maximumWorld.y+.003,t.position.x=(h.maximumWorld.x-h.minimumWorld.x)/pe*e+h.minimumWorld.x-.2,t.position.z=(h.centerWorld.z+h.minimumWorld.z)/2+.2}}function v(m,e){return m.getChildMeshes().find(i=>i.name===e)||null}function W(m){m.rotation.x=0,m.rotation.y=0,m.rotation.z=0}function G(...m){}class Q{name;position;mesh;dragCollision;highlightLayer;scene;particleSystem;currentColor;originalColor;startOpacity;toggleControllers;startPos;EllipsoidLines;moveFlag;pourLocations;rotateEnd;startRotation;dropped;constructor(e,i,t,s){this.name=t,this.moveFlag=!0,this.rotateEnd=!0,this.dropped=!1,this.currentColor=Object.assign({},s),this.originalColor=Object.assign({},s),this.startOpacity=.7;const n=e.getScene();this.scene=n,this.highlightLayer=new Me("highlight-layer",n),this.highlightLayer.innerGlow=!0,this.highlightLayer.outerGlow=!1;const o=n.getMeshByName("Table");let l=.1,a=ue.CreateCylinder(`pivot-Cylinder-${t}`,{diameterTop:l,height:.33,diameterBottom:l},e.getScene());if(a.position._y+=.1,a.visibility=0,e.name=t,e.parent=a,e.rotationQuaternion=null,e.getChildMeshes().forEach(S=>{switch(S.name){case"BeakerwOpacity":S.name=T,S.rotationQuaternion=null,S.rotation.z=2*Math.PI,S.isPickable=!1;break;case"BeakerLiquid":S.name=R,S.isPickable=!1;break}}),o){const S=o.getBoundingInfo().boundingBox,I=v(e,T).getBoundingInfo().boundingBox.maximum.y;a.position.y=S.maximumWorld.y+I/2+.0075,a.position.x=(S.maximumWorld.x-S.minimumWorld.x)/pe*i+S.minimumWorld.x-.3,a.position.z=(S.centerWorld.z+S.minimumWorld.z)/2,this.position={...a.position}}else a.position.x=-2+i,a.position.y=1.22,a.position.z=.5;a.checkCollisions=!0,a.ellipsoid=new f(.02,.05,.02),this.startPos=Object.assign({},a.position),this.mesh=a,this.startRotation=Object.assign({},this.mesh.rotation);const c=v(e,R),d=new D("liquid-material");d.diffuseColor=s,c.material=d;const h=v(e,"Label"),g=v(e,"LabelBack"),b=new me("dynamic texture",256,n,!0,_.LINEAR_LINEAR_MIPNEAREST);b.uAng=Math.PI;const p=new D("Mat",n);p.diffuseTexture=b,h.material=p,g.material=p;const u="bold 250px monospace";b.drawText(e.name.toUpperCase(),0,225,u,"black","white");let r=this.mesh.getChildMeshes().find(S=>S.name==="cylinder");this.mesh.animations=r.animations;const M=new z("particles",500,this.scene);M.particleTexture=new _("https://raw.githubusercontent.com/PatrickRyanMS/BabylonJStextures/master/FFV/smokeParticleTexture.png",this.scene),M.minLifeTime=.5,M.maxLifeTime=.7,M.emitRate=100,M.gravity=new f(0,.5,0),M.minSize=.01,M.maxSize=.07,M.createPointEmitter(new f(0,0,0),new f(0,1,0)),M.addColorGradient(1,ie.FromColor3(c.material.diffuseColor,1)),M.blendMode=z.BLENDMODE_STANDARD,M.emitter=this.mesh.position,this.particleSystem=M,this.setOpacity(this.startOpacity),this.addDragCollision()}startParticles(){this.particleSystem.start()}highlight(e=!0){let i=v(this.mesh,T);e?this.highlightLayer.hasMesh(i)||this.highlightLayer.addMesh(i,w.Green()):this.highlightLayer.hasMesh(i)&&this.highlightLayer.removeMesh(i)}addDragCollision(){let e=new Ce({dragPlaneNormal:new f(0,0,1)});e.useObjectOrientationForDragging=!1,e.moveAttached=!1,e.onDragStartObservable.add(i=>{console.log("drag start!")}),e.onDragObservable.add(i=>{console.log("Drag going!"),i.delta!=f.Zero()&&this.moveFlag&&this.mesh.isPickable&&this.mesh.moveWithCollisions(i.delta)}),e.onDragEndObservable.add(()=>{f.Distance(this.startPos,this.mesh.position)>.1?this.rotateEnd?(this.scene.stopAllAnimations(),this.fadeAndRespawn()):setTimeout(()=>{this.scene.stopAllAnimations(),this.fadeAndRespawn()},1e3):(this.mesh.position.x=this.position._x,this.mesh.position.y=this.position._y,this.mesh.position.z=this.position._z)}),this.mesh.addBehavior(e),this.dragCollision=e}removeDragCollision(){this.mesh.removeBehavior(this.dragCollision)}fadeAndRespawn(e=Ee,i=null,t=!0){this.mesh.isPickable=!1,setTimeout(()=>{let s=this.mesh.getBehaviorByName("PointerDrag");s&&s.releaseDrag();let n=30;this.mesh.name.split("-")[0];let o=this.mesh.getScene(),l=this.mesh.getChildMeshes(),a=l.find(h=>h.name==="cylinder");l.find(h=>h.name==="liquid");let d=[{name:"Invisibility",startValue:v(this.mesh,R).visibility},{name:"Visibility",startValue:0}];d.forEach(h=>{h.init=new y(h.name,"visibility",120,y.ANIMATIONTYPE_FLOAT,y.ANIMATIONLOOPMODE_CONSTANT),h.init.setKeys([{frame:0,value:h.startValue},{frame:n,value:h.startValue===0?this.startOpacity:0}])});for(let h=0;h<l.length-1;++h){let g=l[h];o.beginDirectAnimation(g,[d[0].init],0,60,!1)}o.beginDirectAnimation(l[l.length-1],[d[0].init],0,60,!1,void 0,()=>{let h=v(this.mesh,T);W(this.mesh),W(h),this.mesh.position.x=this.position._x,this.mesh.position.y=this.position._y,this.mesh.position.z=this.position._z,this.mesh.animations=a.animations;for(let g=0;g<l.length-1;++g){let b=l[g];o.beginDirectAnimation(b,[d[1].init],0,60,!1)}o.beginDirectAnimation(l[l.length-1],[d[1].init],0,60,!1,void 0,()=>{if(this.highlight(!1),this.mesh.isPickable=t,v(this.mesh,"cylinder").visibility=this.startOpacity,i)for(let g of i)g&&(g.handMesh.visibility=1)})})},e)}rotateAnimation(e,i=null,t=!1){Object.assign({},this.mesh.position),this.mesh.checkCollisions=!1;let s=this.mesh.getAnimationByName(`${this.name}-${e}`);t||(this.moveFlag=!1,this.rotateEnd=!1,i&&(i.holdingMesh=null)),this.toggleControllers&&this.toggleControllers(),this.scene.beginDirectAnimation(this.mesh,[s],0,600,!1,.5,()=>{this.toggleControllers&&this.toggleControllers(),t||(this.moveFlag=!0,this.rotateEnd=!0,i&&(i.holdingMesh=this.mesh)),this.mesh.checkCollisions=!0})}setColor(e){const i=v(this.mesh,R),t=new D("liquid-material");t.diffuseColor=e,i.material=t,this.currentColor=e}setOpacity(e){const i=v(this.mesh,R);i.visibility=e}resetProperties(){this.setOpacity(this.startOpacity),this.setColor(this.originalColor),W(this.mesh),W(v(this.mesh,T))}showEffects(e=!1){if(e){this.particleSystem.particleTexture=new _("https://raw.githubusercontent.com/PatrickRyanMS/BabylonJStextures/master/FFV/smokeParticleTexture.png",this.scene),this.particleSystem.minLifeTime=.5,this.particleSystem.maxLifeTime=.7,this.particleSystem.emitRate=100,this.particleSystem.gravity=new f(0,.5,0),this.particleSystem.minSize=.01,this.particleSystem.maxSize=.07,this.particleSystem.createPointEmitter(new f(0,0,0),new f(0,1,0));const i=v(this.mesh,R);this.particleSystem.addColorGradient(1,ie.FromColor3(i.material.diffuseColor,1)),this.particleSystem.blendMode=z.BLENDMODE_STANDARD,this.particleSystem.emitter=this.mesh.position,this.particleSystem.start()}else this.particleSystem.stop()}}function Le(m){}class Be{doorMesh;scene;onPointerDownObserver;animations;animating;state;constructor(e){G(e[0]),this.scene=e[0].getScene(),G(this.scene),e.find(l=>l.name==="FireExtinguisherCabinet"),this.doorMesh=e.find(l=>l.name==="Door"),this.doorMesh.rotationQuaternion=null,this.animations=[];let i=new y("rotateAroundY","rotation.y",60,y.ANIMATIONTYPE_FLOAT,y.ANIMATIONLOOPMODE_CONSTANT),t=[],s={value:0},n={value:-Math.PI/2};t.push({...s,frame:0}),t.push({...n,frame:60}),this.doorMesh.animations.push(i),i.setKeys(t),this.animations.push(i);let o=new y("resetAroundY","rotation.y",60,y.ANIMATIONTYPE_FLOAT,y.ANIMATIONLOOPMODE_CONSTANT);t=[],t.push({...n,frame:0}),t.push({...s,frame:60}),this.doorMesh.animations.push(o),o.setKeys(t),this.animations.push(o),this.onPointerDownObserver=this.scene.onPointerObservable.add(this.rotateAroundY),this.animating=!1,this.state=!0}rotateAroundY=(e={type:k.POINTERDOWN,pickInfo:{pickedMesh:this.doorMesh}})=>{if(e.type===k.POINTERDOWN&&x.failed){const i=e.pickInfo?.pickedMesh;if(console.log(this.animating),!this.animating&&i&&(i===this.doorMesh||i.isDescendantOf(this.doorMesh))){this.animating=!0;let t;this.state===!0?t=this.animations[0]:t=this.animations[1],this.scene.beginDirectAnimation(this.doorMesh,[t],0,60,!1,1.5,()=>{this.animating=!1,this.state=!this.state})}}}}const Re="Stony Brook University VR Laboratory",De="Victor Ruben",_e="VR Chemical Mixture Synthesis",Fe="4/1/2023",We="General: Properly mixing VR chemicals",ze="42",He="I",Ve=[{text:"HAZARD IDENTIFICATION",sublistType:"a",sublist:[{text:"Improper mixing of chemicals can lead to explosive results!"}]},{text:"CHEMICAL HANDLING PROCEDURES",sublistType:"a",sublist:[{text:"When mixing these chemicals - always follow the correct sequence"},{text:"Pour chemical B into chemical C"},{text:"Then pour chemical mixture B+C into chemical A"}]},{text:"EMERGENCY PROCEDURES",sublistType:"a",sublist:[{text:"In the event of an improper mixture - use the fire extinguisher to put out the flames"},{text:"Evacuate the lab"},{text:"Call for emergency services"}]}],$e={facility:Re,labDirector:De,scope:_e,lastRevision:Fe,general:We,sopNum:ze,listType:He,items:Ve};function Ge(m){m.name="clipboard";const e=m.getScene(),i=e.getMeshByName("Table");if(i){const o=i.getBoundingInfo().boundingBox;m.position.y=o.maximumWorld.y+.003}m.rotationQuaternion=null,m.rotation=new f(0,Math.PI/4,0);const t=e.getMeshByName("pivot-Cylinder-A");t&&(m.position.x=t.position.x+.2,m.position.z=t.position.z+.5);function s(o){let l=document.createElement("template");l.innerHTML=o;var a=xe.compile(l.innerHTML),c=a($e);return l.innerHTML=c,l.content}function n(o){const a="data:image/svg+xml;utf8,"+encodeURIComponent(o),c=_.LoadFromDataString("tex",a,e,void 0,void 0,void 0,_.LINEAR_LINEAR_MIPNEAREST);let d=new D("mat",e);d.diffuseTexture=c,c.uScale=1,c.vScale=-1,d.emissiveColor=w.White(),d.useAlphaFromDiffuseTexture=!0,c.hasAlpha=!0;let h=v(m,"Plane");h.material=d}fetch(`${$}images/sopTemplate.svg`).then(o=>o.text()).then(o=>{let l=s(o);l.getElementById("procedure-list");const c=new XMLSerializer().serializeToString(l);n(c)}).catch(console.error.bind(console))}class ce{rect;text;button;constructor(e,i,t){this.rect=e,this.text=i,this.button=t}setVisible(e=!0){this.rect.isVisible=e,this.text.isVisible=e,this.button.isVisible=e}}class Ue{advancedTexture;welcomePrompt;gameFinishPrompt;camera;screen;scene;containers;constructor(e){this.scene=e,this.camera=e.activeCamera,this.containers={}}createPromptWithButtonVR(e,i=null,t=null,...s){let n=this.scene.getMeshByName("Start");for(;n!=null&&n!=null;)n.dispose(),n=this.scene.getMeshByName("Start");this.screen=ue.CreatePlane("Start",{size:1});let o=i.baseExperience.camera;this.screen.parent=o,this.screen.position=o.position.add(new f(.6,-1.5,2.75)),this.advancedTexture=se.CreateForMesh(this.screen);let l=new ne("container");var a=new oe;a.width=.5,a.height=.2,a.color="cyan",a.thickness=4,a.background="white",l.addControl(a);var c=new ae;c.text=e,c.color="black",c.fontSize="17px",c.resizeToFit=!0,c.textWrapping=!0,c.paddingBottomInPixels=40,c.paddingLeftInPixels=15,c.paddingRightInPixels=15,a.addControl(c);var d=re.CreateSimpleButton("but1","Click to dismiss");d.width="150px",d.height="40px",d.color="black",d.cornerRadius=20,d.background="white",d.topInPixels=40;let h=new ce(a,c,d),g=this.scene.getMeshByName("Start");document.getElementsByTagName("canvas")[0].addEventListener("pointerdown",function(){i.baseExperience.onStateChangedObservable.add(u=>{u===E.IN_XR&&p()})});function p(){l.dispose(),g.dispose(),t&&t(...s),i&&(i.pointerSelection.displayLaserPointer=!1,i.pointerSelection.displaySelectionMesh=!1)}return h.button.onPointerUpObservable.add(function(){p()}),h.button.onPointerEnterObservable.add(()=>{d.background="grey"}),h.button.onPointerOutObservable.add(()=>{d.background="white"}),l.addControl(h.button),l.addControl(d),this.advancedTexture.addControl(l),h}createPromptWithButton(e,i=null,t=null,...s){this.advancedTexture=se.CreateFullscreenUI("UI");let n=new ne("container");var o=new oe;o.width=.5,o.height=.3,o.color="cyan",o.thickness=4,o.background="white",n.addControl(o);var l=new ae;l.text=e,l.color="black",l.fontSize="17px",l.resizeToFit=!0,l.textWrapping=!0,l.paddingBottomInPixels=40,l.paddingLeftInPixels=15,l.paddingRightInPixels=15,o.addControl(l);var a=re.CreateSimpleButton("but1","Click to dismiss");a.width="150px",a.height="40px",a.color="black",a.cornerRadius=20,a.background="white",a.topInPixels=40;let c=new ce(o,l,a);this.advancedTexture.addControl(n),document.getElementsByTagName("canvas")[0].addEventListener("pointerdown",function(){i.baseExperience.onStateChangedObservable.add(g=>{g===E.IN_XR&&h()})});function h(){n.dispose(),t&&t(...s),i&&(i.pointerSelection.displayLaserPointer=!1,i.pointerSelection.displaySelectionMesh=!1)}return this.containers.p1=h,c.button.onPointerUpObservable.add(function(){h()}),c.button.onPointerEnterObservable.add(()=>{a.background="grey"}),c.button.onPointerOutObservable.add(()=>{a.background="white"}),n.addControl(c.button),n.addControl(a),this.advancedTexture.addControl(n),c}}class Ze{soundList;soundPointer;scene;loadedSounds;constructor(e,i){this.scene=i,this.soundPointer=0,this.soundList=e,this.loadedSounds={}}enableAudio(){J.audioEngine.useCustomUnlockedButton=!0}async loadSounds(){let e=[];return new Promise(i=>{let t=0;this.soundList.forEach(s=>{if(e.push({soundName:s.soundName,sound:new Se(s.soundName,s.fileName,this.scene,()=>{},{})}),t++,t===this.soundList.length){for(let n of e)this.loadedSounds[n.soundName]=n.sound;i(e)}})})}}class Ye{flying=!1;active=!1;camera;mesh;offset=.4;animations;returnPosition;returnRotation;onPointerDownObserver;xrCamera;constructor(e){const i=new y("translate","position",B,y.ANIMATIONTYPE_VECTOR3),t=new y("rotate","rotation",B,y.ANIMATIONTYPE_VECTOR3);this.animations=[i,t],this.xrCamera=e}get name(){return"FlyToCamera"}init(){}attach=(e,i,t,s,n)=>{const o=e.getScene();if(this.mesh=e,!i&&(i=o.activeCamera,!i))throw new Error("The scene has no active camera, and no camera was provided.");this.camera=i,t||(t=this.mesh.position),s||(s=this.mesh.rotation),n&&(this.offset=n),this.returnPosition=t,this.returnRotation=s,this.onPointerDownObserver=o.onPointerObservable.add(this.clipboardClick)};detach=()=>{this.mesh.getScene().onPointerObservable.remove(this.onPointerDownObserver)};clipboardClick=(e={type:k.POINTERDOWN,pickInfo:{pickedMesh:this.mesh}})=>{if(e.type===k.POINTERDOWN){const i=e.pickInfo?.pickedMesh;if(i&&(i===this.mesh||i.isDescendantOf(this.mesh))&&!this.flying||this.active){const t=this.active?B/2:0,s=this.active?0:B/2;this.#e(),this.flying=!0,this.mesh.billboardMode==K.BILLBOARDMODE_ALL?this.mesh.billboardMode=K.BILLBOARDMODE_NONE:this.mesh.billboardMode=K.BILLBOARDMODE_ALL,this.mesh.getScene().beginDirectAnimation(this.mesh,this.animations,t,s,!1,void 0,()=>{this.flying=!1,this.active=!this.active})}}};calculateTargetPositionWithOffset=e=>{if(this.xrCamera!==void 0&&this.xrCamera.state===E.IN_XR){const o=this.xrCamera.camera._position.subtract(this.returnPosition).scale(1-e/f.Distance(this.returnPosition,this.xrCamera.camera._position));return this.returnPosition.add(o)}const t=this.camera._position.subtract(this.returnPosition).scale(1-e/f.Distance(this.returnPosition,this.camera._position));return this.returnPosition.add(t)};setClipboardUp=()=>new f(3.1468286,4.6617744,1.680752);#e=()=>{const e=this.animations.find(({name:n})=>n==="translate"),i=this.animations.find(({name:n})=>n==="rotate"),t=[{frame:0,value:this.returnPosition},{frame:B/2,value:this.calculateTargetPositionWithOffset(this.offset)}],s=[{frame:0,value:this.returnRotation},{frame:B/2,value:this.setClipboardUp()}];e.setKeys(t),i.setKeys(s)}}class fe{cylinderInstances;clipboard;isRotating;scene;labels;guiManager;soundManager;xrCamera;fireExtinguisher;constructor(e,i,t,s,n,o){this.labels=["A","B","C"],this.scene=e,this.cylinderInstances=i,this.guiManager=t,this.soundManager=s,this.xrCamera=n,this.isRotating=!1,this.fireExtinguisher=o}getCylinderInstanceFromMesh(e){let i=e.name.split("-")[2];for(let t of this.cylinderInstances)if(t.name==i)return t;return null}intersectHandCylinder(e){for(let i of this.labels){let t=this.scene.getMeshByName(`pivot-Cylinder-${i}`);if(e.intersectsMesh(t,!1)&&t.isPickable)return t}return null}intersectCylinder(e){for(let i of this.labels){let t=this.scene.getMeshByName(`pivot-Cylinder-${i}`);if(t!=e&&e.intersectsMesh(t))return t}return null}highlightCylinders(e,i){e.highlight(),i.highlight()}RotateCylinders(e,i,t=null){let s=e.mesh.position,n=i.mesh.position,o="rotateAroundZleft";i.mesh.rotation.y=e.mesh.rotation.y;let l=e.mesh.getHierarchyBoundingVectors(),a=l.max.y-l.min.y,c=.2,d=n.x;s.x-d;let h=v(e.mesh,T),g=v(i.mesh,T);n.x<s.x?h.rotation.y=Math.PI:(h.rotation.y=0,o="rotateAroundZright",c=-c),g.rotation.y=h.rotation.y,e.mesh.position.x=i.mesh.position.x+c,e.mesh.position.y=i.mesh.position.y+a/1.5,e.rotateAnimation(o,t)}moveWithCollisions(e,i){e.moveWithCollisions(i)}addColors(e,i){let t=e.currentColor,s=i.currentColor,n=new w((t.r+s.r)/2,(t.g+s.g)/2,(t.b+s.b)/2);i.setColor(n)}fireExtinguishScreen(){for(let t of this.cylinderInstances)t.mesh.isPickable=!1,t.moveFlag=!1;function e(t){for(let s of t)s.mesh.isPickable=!0,s.moveFlag=!0,s.resetProperties(),s.showEffects(!1),setTimeout(()=>{s.setColor(s.originalColor)},1e3)}this.guiManager.createPromptWithButtonVR("Fire extinguished! The scene will now reset.",this.xrCamera,e,this.cylinderInstances);let i=this.scene.getMeshByName("Start");if(i){let t=this.xrCamera.baseExperience.camera;i.parent=t,i.position=t.position.add(new f(-t.position.x,-1.5,1.15)),this.xrCamera.pointerSelection.displayLaserPointer=!0,this.xrCamera.pointerSelection.displaySelectionMesh=!0,i.position.x=0,i.position.y=0,i.position.z=.7,i.rotation=f.Zero()}}showFinishScreen(e=!0){for(let t of this.cylinderInstances)t.mesh.isPickable=!1,t.moveFlag=!1;function i(t){for(let s of t)s.mesh.isPickable=!0,s.moveFlag=!0,s.resetProperties(),s.showEffects(!1),setTimeout(()=>{s.setColor(s.originalColor)},1e3)}if(e){this.guiManager.createPromptWithButtonVR("You have completed the task! The scene will now reset!",this.xrCamera,i,this.cylinderInstances);let t=this.scene.getMeshByName("Start");if(t){let s=this.xrCamera.baseExperience.camera;t.parent=s,t.position=s.position.add(new f(-s.position.x,-1.5,1.15)),this.xrCamera.pointerSelection.displayLaserPointer=!0,this.xrCamera.pointerSelection.displaySelectionMesh=!0,t.position.x=0,t.position.y=0,t.position.z=.7,t.rotation=f.Zero()}}else this.guiManager.createPromptWithButton("You have completed the task! The scene will now reset!",this.xrCamera,i,this.cylinderInstances)}showFailureScreen(e=!0){for(let t of this.cylinderInstances)t.mesh.isPickable=!1;function i(t){for(let s of t)s.mesh.isPickable=!0,s.moveFlag=!0,s.resetProperties(),s.showEffects(!1),setTimeout(()=>{s.setColor(s.originalColor)},1e3)}this.fireExtinguisher.fireCabinetInstance.doorMesh.rotation.y=0,this.guiManager.createPromptWithButton("Task failed! The scene will now reset.",this.xrCamera,i,this.cylinderInstances)}playExplosion(){let e=this.soundManager.loadedSounds.explosion;e.stop(),e.play()}playDing(){let e=this.soundManager.loadedSounds.ding;e.stop(),e.play()}playSuccess(){let e=this.soundManager.loadedSounds.success;e.stop(),e.play()}}class ee{scene;plane;position=new f(-4.3,0,-1.7);set;isRunning;constructor(e){this.scene=e,this.isRunning=!1}show(){this.isRunning=!0,Pe.CreateAsync("fire",this.scene).then(e=>{this.set=e,e.systems.forEach(i=>{i.emitter.x=-4,i.emitter.z=-1.7}),e.start()})}hide(){this.isRunning=!1,this.set.dispose()}}class ge extends fe{particleSystem;instances;fire;constructor(e,i,t,s,n,o){super(e,i,t,s,n,o),this.instances=i,console.log(this.fireExtinguisher)}resetCylinders(){this.particleSystem&&this.particleSystem.stop();let e=["A","B","C"];for(let i=0;i<e.length;i++){const t=this.scene.getMeshByName(`pivot-Cylinder-${e[i]}`),s=this.scene.getMeshByName("Table");if(s&&t){const n=s.getBoundingInfo().boundingBox;t.position.z=(n.centerWorld.z+n.minimumWorld.z)/2}super.getCylinderInstanceFromMesh(t).showEffects(!1),super.getCylinderInstanceFromMesh(t).resetProperties(),super.getCylinderInstanceFromMesh(t).setColor(super.getCylinderInstanceFromMesh(t).originalColor),i==0&&(super.getCylinderInstanceFromMesh(t).setColor(w.Red()),super.getCylinderInstanceFromMesh(t).currentColor=w.Red())}}postSceneCylinder(){let e=["A","B","C"],i=[];for(let s of e){const n=this.scene.getMeshByName(`pivot-Cylinder-${s}`);i.push(n);let o=new y(`${s}-rotateAroundZleft`,"rotation.z",120,y.ANIMATIONTYPE_FLOAT,y.ANIMATIONLOOPMODE_CONSTANT),l=v(n,T),a=[];a.push({frame:0,value:0}),a.push({frame:60,value:Math.PI/2}),l.animations.push(o),o.setKeys(a);let c=new y(`${s}-rotateAroundZright`,"rotation.z",120,y.ANIMATIONTYPE_FLOAT,y.ANIMATIONLOOPMODE_CONSTANT);a=[],a.push({frame:0,value:0}),a.push({frame:60,value:-Math.PI/2}),l.animations.push(c),c.setKeys(a);let d=new y(`${s}-resetRotateAroundZleft`,"rotation.z",120,y.ANIMATIONTYPE_FLOAT,y.ANIMATIONLOOPMODE_CONSTANT),h=[];h.push({frame:0,value:Math.PI/2}),h.push({frame:60,value:0}),l.animations.push(d),d.setKeys(h);let g=new y(`${s}-resetRotateAroundZright`,"rotation.z",120,y.ANIMATIONTYPE_FLOAT,y.ANIMATIONLOOPMODE_CONSTANT);h=[],h.push({frame:0,value:-Math.PI/2}),h.push({frame:60,value:0}),l.animations.push(g),g.setKeys(h)}let t;for(let s=0;s<e.length;s++){const n=this.scene.getMeshByName(`pivot-Cylinder-${e[s]}`);let o=super.getCylinderInstanceFromMesh(n);const l=n.getBehaviorByName("PointerDrag");let a=[];for(let u of i)u!=n&&a.push(u);let c=!1,d=!1,h=v(n,T),g=!1,b="resetRotateAroundZleft",p;n.isPickable&&l.onDragObservable.add(()=>{let u=!1,C=!1;W(n);let r;const M=super.intersectCylinder(n);M&&(r=super.getCylinderInstanceFromMesh(M),t=r,super.highlightCylinders(o,r),C=!0,M.name.split("-")[2],n.name.split("-")[2],g||(g=!0,p=setTimeout(()=>{super.RotateCylinders(o,r);let S=M.name.split("-")[2],Z=`${n.name.split("-")[2]}to${S}`;if(x.tasks[x.currentState].label===Z)d=!0,x.tasks[x.currentState].next==="complete"?(u=!0,setTimeout(()=>{super.playSuccess()},500),setTimeout(()=>{o.fadeAndRespawn()},1500),x.resetSOP(),this.resetCylinders(),super.showFinishScreen(!1)):(x.currentState=x.tasks.indexOf(x.tasks.find(I=>I.label==x.tasks[x.currentState].next)),super.playDing());else if(!c&&!d){for(let A of this.instances)A.mesh.isPickable=!1,A.moveFlag=!1;x.failed=!0,r.showEffects(!0),setTimeout(()=>{super.playExplosion()},800);let I=new ee(this.scene);this.fireExtinguisher.fire=I,I.show(),c=!0,setTimeout(()=>{l.releaseDrag()},1500)}u||super.addColors(o,r),M.position.x>n.position.x&&(b="resetRotateAroundZright")},700))),C===!1&&o.rotateEnd&&(o.highlight(!1),t&&(t.highlight(!1),t=void 0),p?(clearTimeout(p),p=null,d=!1,g=!1):(d=!1,g&&(g=!1,o.rotateAnimation(b,null,!0))))}),l.onDragEndObservable.add(()=>{g=!1;for(let u of a)u!==h&&(o.highlight(!1),super.getCylinderInstanceFromMesh(u).highlight(!1),h.intersectsMesh(u)&&(o.rotateAnimation(b),h.position.x=0,h.position.y=0))})}}}class de extends fe{handedness;holdingInstance;holdingMesh;targetMesh;targetMeshInstance;motionController;handMesh;isVisible;failBeaker;particleSystem;cylinderInstancesHand;constructor(e,i,t,s,n,o,l){super(i,t,s,n,o,l),this.handedness=e,this.handMesh=i.getMeshByName(this.handedness),this.isVisible=!0,this.failBeaker=!1}getMotionController(){return this.motionController}setMotionController(e){this.motionController=e}dropped(e=null,i=!0){f.Distance(this.holdingInstance.mesh.position,this.holdingInstance.startPos)==0&&(i=!1),this.motionController.lastPosition=null,e&&clearInterval(e),this.motionController.grabbed=!1,this.motionController.meshGrabbed=void 0,this.holdingMesh&&(i&&this.holdingInstance.fadeAndRespawn(100,null,this.holdingMesh.isPickable),this.holdingMesh=null,this.holdingInstance=null,this.motionController.meshGrabbed=null)}updateSOPTask(e,i){let t=`${e}to${i}`;if(x.tasks[x.currentState].label===t)if(x.tasks[x.currentState].next==="complete"){new ge(this.scene,this.cylinderInstances,this.guiManager,this.soundManager,this.xrCamera,this.fireExtinguisher);for(let s of this.cylinderInstances)s.moveFlag=!1,s.mesh.isPickable=!1;setTimeout(()=>{for(let s of this.cylinderInstances)s.fadeAndRespawn(100,null,!1);super.playSuccess(),this.disappearAnimation(!1),this.xrCamera.baseExperience.state==E.IN_XR&&(super.showFinishScreen(),this.scene.getMeshByName("Start"))},1e3),x.resetSOP(),this.particleSystem&&this.particleSystem.stop();for(let s of this.cylinderInstances)s.showEffects(!1);return!0}else{super.playDing(),x.currentState=x.tasks.indexOf(x.tasks.find(s=>s.label==x.tasks[x.currentState].next));return}else if(x.failed=!0,!this.failBeaker){let s=new ee(this.scene);this.fireExtinguisher.fire=s,s.show(),setTimeout(()=>{if(this.xrCamera.baseExperience.state==E.IN_XR){let n=this.scene.getMeshByName("Start");if(n){let o=this.xrCamera.baseExperience.camera;n.parent=o,n.position=o.position.add(new f(-o.position.x,-1.5,1.15)),this.xrCamera.pointerSelection.displayLaserPointer=!0,this.xrCamera.pointerSelection.displaySelectionMesh=!0,n.position.x=0,n.position.y=0,n.position.z=.95,n.rotation=f.Zero()}}super.playExplosion(),this.targetMeshInstance.showEffects(!0)},1e3)}}disappearAnimation(e=!0){let i=60,t=[{name:"Invisibility",startValue:1},{name:"Visibility",startValue:0}];t.forEach(s=>{s.init=new y(s.name,"visibility",120,y.ANIMATIONTYPE_FLOAT,y.ANIMATIONLOOPMODE_CONSTANT),s.init.setKeys([{frame:0,value:s.startValue},{frame:i,value:1-s.startValue}])}),e?(this.isVisible=!1,this.scene.beginDirectAnimation(this.handMesh,[t[0].init],0,60,!1)):(this.isVisible=!0,this.scene.beginDirectAnimation(this.handMesh,[t[1].init],0,60,!1))}}function qe(m,e,i,t,s,n,o){let l=new de("right",m,t,s,n,e,o),a=new de("left",m,t,s,n,e,o),c=!1,d={right:l,left:a},h=!1;function g(p){let u=p.name.split("-")[2];for(let C of t)if(C.name==u)return C;return null}let b=p=>{i(p),p.onMotionControllerInitObservable.add(u=>{let C=u;C.handID=u.handedness;let r=d[C.handedness];r.getMotionController()||r.setMotionController(C);let M=new le(f.Zero(),f.Zero(),.25);const S=u.getComponentOfType("squeeze"),U=u.getComponentOfType("trigger");u.getComponentOfType("thumbstick").onAxisValueChangedObservable.add(()=>{e.baseExperience.camera.position.y=e.baseExperience.camera.realWorldHeight}),e.baseExperience.camera.onAfterCameraTeleport.add(()=>{e.baseExperience.camera.position.y=e.baseExperience.camera.realWorldHeight}),[U].forEach(I=>{I.onButtonStateChangedObservable.add(A=>{m.getMeshByName("Start")||(A.value>.3&&C.handID==="right"?(e.pointerSelection.displayLaserPointer=!0,e.pointerSelection.displaySelectionMesh=!0):(e.pointerSelection.displayLaserPointer=!1,e.pointerSelection.displaySelectionMesh=!1));let F=new le(p.pointer.absolutePosition,p.pointer.forward,2),N=m.pickWithRay(F);if(console.log(N.pickedMesh),o.xrHolding&&o.fire&&o.fire.isRunning&&N.pickedMesh&&N.pickedMesh.name=="ExitDoor"&&setTimeout(()=>{r.handMesh.removeChild(o.mesh),r.handMesh.visibility=1,o.reset(),r.fireExtinguishScreen();let P=this.scene.getMeshByName("Start");if(P){let O=this.xrCamera.baseExperience.camera;P.parent=O,P.position=O.position.add(new f(-O.position.x,-1.5,1.15)),P.position.x=0,P.position.y=0,P.position.z=.95,this.xrCamera.pointerSelection.displayLaserPointer=!0,this.xrCamera.pointerSelection.displaySelectionMesh=!0,P.rotation=f.Zero()}},1500),o.xrHolding&&A.value>.3?o.smokeSystem.start():o.smokeSystem.stop(),o.isHolding&&!o.xrHolding){o.xrHolding=!0,r.handMesh.visibility=0;let P=o.mesh;console.log(P.position);let O=r.handMesh.position;P.position=new f(O.x,O.y,O.z),P.parent=p.pointer,P.position.x=.04,P.position.y=.2,P.position.z=-.05,P.rotation=new f(0,Math.PI,0)}})}),[S].forEach(I=>{let A="resetRotateAroundZleft";I.onButtonStateChangedObservable.add(F=>{let N,P={left:"Fist",right:"Fist"},O=m.animationGroups.find((L,X)=>L.name===`${r.motionController.handID}_${P[r.motionController.handID]}`);O.goToFrame(F.value*(O._to-1)+1);let H=r.intersectHandCylinder(m.getMeshByName(C.handID)),Y,q;if(F.value>.5&&!r.motionController.grabbed){if(H&&H.isPickable){J.audioEngine.unlock(),c=!1,r.holdingMesh=H,r.holdingInstance=g(r.holdingMesh),r.motionController.meshGrabbed=r.holdingMesh,r.motionController.grabbed=!0;let L=r.motionController.lastPosition,X=M.origin;X!=L&&(r.disappearAnimation(!0),N=setInterval(()=>{let te=r.motionController.lastPosition;if(p.getWorldPointerRayToRef(M),te&&r.holdingMesh&&r.moveWithCollisions(r.holdingMesh,X.subtract(te)),!r.intersectHandCylinder(m.getMeshByName(r.motionController.handID))&&r.holdingMesh&&r.holdingInstance.rotateEnd&&(r.targetMeshInstance&&r.targetMeshInstance.highlight(!1),r.dropped(N),r.motionController.grabbed=!1,r.handMesh.visibility=1,c=!0,h=!1),r.holdingMesh){let V=r.intersectCylinder(r.holdingMesh);if(V){r.targetMesh=V,r.targetMeshInstance=g(V),r.highlightCylinders(r.holdingInstance,r.targetMeshInstance),r.targetMesh.position.x>r.holdingMesh.position.x&&(A="resetRotateAroundZright");let ye=V.name.split("-")[2],be=r.holdingMesh.name.split("-")[2];h||(h=!0,q=setTimeout(()=>{r.addColors(r.holdingInstance,r.targetMeshInstance),c=r.updateSOPTask(be,ye),r.holdingMesh&&(Y=Object.assign({},r.holdingMesh.position)),r.RotateCylinders(r.holdingInstance,r.targetMeshInstance,r)},800))}else q&&(clearTimeout(q),r.targetMeshInstance&&r.targetMeshInstance.highlight(!1),r.holdingInstance.highlight(!1),h=!1,r.holdingMesh.rotation.z!=0&&Y&&Math.abs(Y._x-r.holdingMesh.position.x)>.2&&(r.targetMeshInstance&&r.targetMeshInstance.highlight(!1),r.holdingInstance.highlight(!1),r.holdingInstance.rotateAnimation(A,r,!0),h=!1))}!c&&r.holdingInstance&&r.holdingInstance.rotateEnd&&(r.motionController.lastPosition=Object.assign({},M.origin),C.lastPosition=Object.assign({},M.origin))},10))}}else if((!F.value||!H)&&r.holdingInstance){let L=function(){r.holdingMesh=r.holdingInstance.mesh,r.holdingInstance.highlight(!1),r.motionController.grabbed=!1,r.targetMeshInstance&&r.targetMeshInstance.highlight(!1),r.dropped(N),r.disappearAnimation(!1),h=!1};r.holdingInstance.rotateEnd?L():setTimeout(()=>{L()},800)}})})})};return function(){let u=e.input.onControllerAddedObservable;u.hasObservers()?u.clear():u.add(b)}}function Xe(m,e,i,t){let s,n;return new Promise(o=>{const l="./models/";let a="";var c={};let d=["left","right"],h={left:new w(1,0,0),right:new w(0,0,1)};const g=new ve(m);d.forEach(p=>{g.addMeshTask(`load ${p} hand`,"",l,`${p}${a}.glb`)});let b=0;g.onTaskSuccess=p=>{c[d[b]]=p.loadedMeshes[1],p.loadedMeshes[1].name=d[b],s=p.loadedAnimationGroups;for(let u=0;u<s.length;u++)s[u].name=`${d[b]}_${s[u].name}`;b++},g.onTasksDoneObservable.add(()=>{for(let p=0;p<m.animationGroups.length;p++)m.animationGroups[p].pause();n=p=>{let u=p.inputSource.handedness;G(c[u]);let C=c[u].parent.parent;c[u].isPickable=!1;for(let S of i)S.removeDragCollision();let r=(Object.keys(c).indexOf(u)-1)*2-1;c[u].rotation.y=Math.PI*r,c[u].rotation.z=-Math.PI/2,c[u].rotation.x=-Math.PI/4;const M=new D("liquid-material");M.diffuseColor=h[u],c[u].material=M,C.parent=p.grip||p.pointer},e.baseExperience.onStateChangedObservable.add(p=>{if(p===E.IN_XR){e.baseExperience.camera.position.y=e.baseExperience.camera.realWorldHeight,e.baseExperience.camera.position.z=-2,console.log(t),t.containers.p1(),t.createPromptWithButtonVR("Welcome to the Lab Safety Simulation. Click on the clipboard to learn more about the simulation!",e);let u=m.getMeshByName("Start");if(u){let C=e.baseExperience.camera;u.parent=C,u.position=C.position.add(new f(-C.position.x,-1.5,1.15)),e.pointerSelection.displayLaserPointer=!0,e.pointerSelection.displaySelectionMesh=!0,u.position.x=0,u.position.y=0,u.position.z=.7,u.rotation=f.Zero()}}}),e.baseExperience.camera.onAfterCameraTeleport.add(()=>{e.baseExperience.camera.position.y=e.baseExperience.camera.realWorldHeight})}),g.loadAsync().then(()=>{o(n),document.getElementsByClassName("babylonVRicon")[0].addEventListener("click",u=>{var C=new AudioContext;C.resume().then(()=>{})})})})}class Ke{scene;xrCamera;addHandModels;cylinders;guiManager;soundManager;fireExtinguisher;constructor(e,i,t,s,n,o,l){this.scene=e,this.xrCamera=i,this.addHandModels=t,this.cylinders=s,this.guiManager=n,this.soundManager=o,this.fireExtinguisher=l}async addWebXr(){return await Xe(this.scene,this.xrCamera,this.cylinders,this.guiManager)}addWebXrBehaviors(){return qe(this.scene,this.xrCamera,this.addHandModels,this.cylinders,this.guiManager,this.soundManager,this.fireExtinguisher)}}class je{models;cylinders;guiManager;soundManager;soundObjects;loadedSounds;scene;fireExtinguisher;constructor(e,i,t,s){this.models=e,this.cylinders=i,this.soundObjects=t,this.fireExtinguisher=s}renderScene(){this.createScene().then(e=>{this.scene=e,this.soundManager=new Ze(this.soundObjects,e),this.soundManager.enableAudio(),this.soundManager.loadSounds().then(i=>{this.loadedSounds=i,this.processScene(e,this.cylinders,this.soundManager)})})}disposeScene(){this.scene.meshes.forEach(e=>{e.dispose()}),this.scene.materials.forEach(e=>{e.dispose()}),this.scene.textures.forEach(e=>{e.dispose()}),this.scene.lights.forEach(e=>{e.dispose()}),this.scene.customRenderTargets.forEach(e=>{e.dispose()}),setTimeout(()=>this.scene.dispose(),1e3)}createScene(){return new Promise(e=>{const i=document.getElementById("canvas"),t=new J(i,!0,{stencil:!0}),s=new we(t);s.collisionsEnabled=!0,window.addEventListener("resize",function(){t.resize()});const n=new Ie("camera",new f(0,1,-1.134),s);n.ellipsoid=new f(.4,.7,.4),n.attachControl(i,!0),n.applyGravity=!0,n.minZ=0,n.speed=0,n.checkCollisions=!0,n.keysUp.push(87),n.keysDown.push(83),n.keysLeft.push(65),n.keysRight.push(68);var o=new Oe("light1",new f(1,1,0),s);o.intensity=0,Promise.all(this.models.map(l=>new Promise(a=>Te.ImportMesh("",l.root,l.fileName,s,function(c){l.mesh=c,a(c)})))).then(()=>{let l=[];this.models.map(a=>{l.push(a.callback(a.mesh)),e(s)})}),window.addEventListener("keydown",l=>{l.shiftKey&&l.ctrlKey&&l.altKey&&l.keyCode===73&&(s.debugLayer.isVisible()?s.debugLayer.hide():s.debugLayer.show())}),t.runRenderLoop(()=>{s.render()})})}async processScene(e,i,t){let s=e.getCameraByName("camera"),n=e.getLightByName("light1"),o;s.speed=.16;let l=setInterval(()=>{n.intensity>=1?clearInterval(l):n.intensity+=.1},60),a={floorMeshes:[e.getMeshByName("Floor")],inputOptions:{doNotLoadControllerMeshes:!0}};o=await e.createDefaultXRExperienceAsync(a),o.baseExperience.camera.position.z-=.5;let c=!1;o.pointerSelection.laserPointerDefaultColor=w.Green(),o.pointerSelection.laserPointerPickedColor=w.Green(),o.pointerSelection.selectionMeshPickedColor=w.Green(),o.pointerSelection.selectionMeshDefaultColor=w.Green(),o.pointerSelection.displayLaserPointer=!1,o.pointerSelection.displaySelectionMesh=!1,this.fireExtinguisher.xrCamera=o,window.addEventListener("keydown",h=>{h.keyCode===73&&(c?c=!1:c=!0,o.pointerSelection.displayLaserPointer=c,o.pointerSelection.displaySelectionMesh=c)}),console.log(this.fireExtinguisher),this.guiManager=new Ue(e),this.guiManager.createPromptWithButton("Welcome to the Lab Safety Simulation. Click on the clipboard to learn more about the simulation!",o);let d=new Ke(e,o,null,i,null,this.soundManager,this.fireExtinguisher);d.guiManager=this.guiManager,d.addWebXr().then(h=>{if(o){const p=new Ye(o.baseExperience);e.getMeshByName("clipboard").addBehavior(p)}d.guiManager=this.guiManager,console.log(this.fireExtinguisher),d.addHandModels=h,new ge(e,i,this.guiManager,t,o,this.fireExtinguisher).postSceneCylinder();var b=d.addWebXrBehaviors();b();for(let p of i)p.toggleControllers=b})}}class Qe{particleSystem;gravity;constructor(e){let i=e.getScene();i.activeCamera,this.gravity=f.Zero();let t;he.IsSupported?(t=new he("particles",{capacity:15e3},i),t.activeParticleCount=2e3):t=new z("particles",2e3,i),t.particleTexture=new _("https://raw.githubusercontent.com/PatrickRyanMS/BabylonJStextures/master/FFV/smokeParticleTexture.png",i),t.emitRate=150,t.createPointEmitter(new f(-3.5,-4,0),new f(3.5,4,0)),t.gravity=new f(0,0,10),t.isLocal=!0,t.minLifeTime=.3,t.maxLifeTime=.3,t.minEmitPower=.7,t.maxEmitPower=.5,t.minSize=.01,t.maxSize=.02;let s=.3;t.addSizeGradient(s,s,s),t.blendMode=z.BLENDMODE_STANDARD,t.emitter=e,this.particleSystem=t}start(){this.particleSystem.start()}stop(){this.particleSystem.stop()}}class Je{modelTransform;scene;mesh;base;startPos=new f(3.8,1.75,-2.5);rotation;smokeSystem;fireCabinetInstance;fireExtinguished=!1;pointerDragBehav;xrCamera;onPointerDownObserver;childMeshes;isHolding=!1;isRunning=!1;xrHolding=!1;extinguished=!1;fire;constructor(){}setPosition(){this.mesh.position=this.startPos}setModel(e){this.mesh=e,this.scene=e.getScene(),this.modelTransform=this.scene.getTransformNodeByName("fire_ex"),this.mesh.isPickable=!0,this.rotation=Object.assign({},this.mesh.rotation),this.setPosition(),this.extinguished=!1,G(this.mesh),this.smokeSystem=new Qe(this.mesh),this.stopSmoke(),this.childMeshes=this.getChildMeshes(this.mesh),this.onPointerDownObserver=this.scene.onPointerObservable.add(this.flyToCamera)}getChildMeshes(e){let i;i=e.getChildMeshes();let t=[];function s(n){for(let o of n.getChildMeshes())t.push(o),s(o)}for(let n of i)t=[n],s(n),i.concat(t);return i}flyToCamera=(e={type:k.POINTERDOWN,pickInfo:{pickedMesh:this.mesh}})=>{if(e.type===k.POINTERDOWN&&!this.isHolding){const i=e.pickInfo?.pickedMesh;if(console.log(this.isHolding),i.isDescendantOf(this.mesh)){this.isHolding=!0;let t=this.scene.activeCamera;this.xrCamera.baseExperience.state===E.IN_XR?console.log("In XR"):(console.log(this.scene),this.mesh.parent=t,this.mesh.position.x=.4,this.mesh.position.y=-.1,this.mesh.position.z=1.1,this.mesh.rotation=new f(0,Math.PI,0))}}else if(this.xrCamera.baseExperience.state!==E.IN_XR&&e.type===k.POINTERDOWN&&this.isHolding){if(new f(0,0,0),!this.isRunning){this.startSmoke(),this.isRunning=!0,console.log("In dispense");let i=this.scene.pickWithRay(this.scene.activeCamera.getForwardRay(10)).pickedMesh;console.log(i),i.id==="ExitDoor"&&setTimeout(()=>{this.extinguished=!0,console.log(this.extinguished),this.fire.hide()},1500)}}else this.isRunning&&(this.stopSmoke(),this.isRunning=!1)};startSmoke(){this.smokeSystem.start()}stopSmoke(){this.smokeSystem.stop()}reset(){this.isHolding=!1,this.isRunning=!1,this.xrHolding=!1,this.mesh.isPickable=!0,this.extinguished=!1,this.stopSmoke(),this.mesh.parent=null,setTimeout(()=>{this.setPosition()},300),this.fire&&this.fire.hide()}}class et{currentScene;constructor(){}disposeCurrentScene(){this.currentScene.disposeScene()}createSceneOne(){let e,i=[],t="CylinderNewSmoothLabel.glb",s=new Je,n=[{fileName:"room.glb",callback:a=>l(a),label:"floor"},{fileName:"Placard_Label.glb",callback:a=>j(a,1,"Placard-A")},{fileName:"Placard_Label.glb",callback:a=>j(a,2,"Placard-B")},{fileName:"Placard_Label.glb",callback:a=>j(a,3,"Placard-C")},{fileName:t,callback:a=>i.push(new Q(a[0],1,"A",new w(1,0,0))),label:"Cylinder-A"},{fileName:t,callback:a=>i.push(new Q(a[0],2,"B",new w(0,1,0))),label:"Cylinder-B"},{fileName:t,callback:a=>i.push(new Q(a[0],3,"C",new w(0,0,1))),label:"Cylinder-C"},{fileName:"clipBoardWithPaperCompressedTextureNew.glb",callback:a=>Ge(a[0])},{fileName:"fireExtinguisherTLL.glb",callback:a=>{let c=a[0];s.setModel(c)}}].map(function(a){return Object.assign({},{fileName:"LabBench.glb",root:"./models/",callback:Le,label:"NoLabel"},a)}),o=[{soundName:"explosion",fileName:`${$}/sound/mi_explosion_03_hpx.mp3`},{soundName:"ding",fileName:`${$}/sound/ding-idea-40142.mp3`},{soundName:"success",fileName:`${$}/sound/success.mp3`}];this.currentScene=new je(n,i,o,s),this.currentScene.renderScene(),setInterval(()=>{s.extinguished===!0&&(s.extinguished=!1,setTimeout(()=>{this.disposeCurrentScene(),setTimeout(()=>{this.createSceneOne()},500)},1e3))},3e3);function l(a){e=new Be(a),s.fireCabinetInstance=e;const c=["WallsandFloor","Floor","Table","Roof","Countertop","Walls"];let d,h;for(let g of c){const b=a.find(p=>p.name===g);if(b&&(b.checkCollisions=!0,b.name==="Table")){const p=b.getBoundingInfo().boundingBox;p.center.x,d=b.getScene(),h=d.getCameraByName("camera"),new ee(d),h.position=new f(p.center.x-.5,1.6,-2.5),h.rotation=new f(Math.PI/8,0,0);let u=h.position.clone();d.onBeforeRenderObservable.add(()=>{const C=h.position.subtract(u),r=C.length();r>Ne&&(h.position=u.addInPlace(C.scale(.01/r))),u=h.position.clone()})}}}}}class tt{constructor(){new et().createSceneOne()}}document.addEventListener("DOMContentLoaded",function(){let m=document.querySelector("div.splash");m.addEventListener("click",()=>{m.classList.add("hide")})},!1);new tt;
