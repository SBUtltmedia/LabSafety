var U=Object.defineProperty;var V=(l,e,i)=>e in l?U(l,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[e]=i;var d=(l,e,i)=>(V(l,typeof e!="symbol"?e+"":e,i),i),Y=(l,e,i)=>{if(!e.has(l))throw TypeError("Cannot "+i)};var W=(l,e,i)=>(Y(l,e,"read from private field"),i?i.call(l):e.get(l)),z=(l,e,i)=>{if(e.has(l))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(l):e.set(l,i)};import{M as x,V as y,S as k,D as q,H as $,C as M,P as Z,A as m,B as F,a as Q,R as X,b as G,c as E,W as j,E as J,d as ee,U as te,e as ie,f as ne}from"./vendor.8cc9db75.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const t of n)if(t.type==="childList")for(const r of t.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function i(n){const t={};return n.integrity&&(t.integrity=n.integrity),n.referrerpolicy&&(t.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?t.credentials="include":n.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function o(n){if(n.ep)return;n.ep=!0;const t=i(n);fetch(n.href,t)}})();window.exports=window;function N(l,e){return l.getChildMeshes().find(i=>i.name===e)||null}function oe(l){var o;const e=new URLSearchParams(document.location.search);(e.get("debug")===""||((o=e.get("debug"))==null?void 0:o.toLowerCase())==="true")&&l.debugLayer.show()}const L=60,ae=50,K=3,P="cylinder",H="liquid",se="placard",v={right:"handR2320",left:"handL2320"};class le{constructor(e,i){d(this,"highlightLayer");d(this,"highlightColor");d(this,"highlightReferences");d(this,"highlightingMeshes");d(this,"mesh");d(this,"attach",e=>{this.mesh=e,this.highlightLayer.addMesh(this.mesh,this.highlightColor)});d(this,"detach",()=>{this.highlightLayer.removeMesh(this.mesh),this.highlightReferences=0,this.highlightingMeshes=[]});d(this,"highlightSelf",()=>{this.highlightLayer.isEnabled=!0});d(this,"unhighlightSelf",()=>{this.highlightReferences||(this.highlightLayer.isEnabled=!1)});d(this,"highlightMesh",e=>{if(this.highlightingMeshes.find(o=>o===e))return!1;const i=e.getBehaviorByName(this.name);return i?(i.highlightReferences+=1,i.highlightSelf(),this.highlightingMeshes.push(e),!0):!1});d(this,"unhighlightMesh",e=>{const i=e.getBehaviorByName(this.name);if(!i)return!1;const o=this.highlightingMeshes.findIndex(n=>n===e);return o===-1?!1:(i.highlightReferences-=1,i.unhighlightSelf(),this.highlightingMeshes.splice(o,1),!0)});this.highlightLayer=e,this.highlightColor=i,this.highlightReferences=0,this.highlightingMeshes=[]}get name(){return"Highlight"}init(){}}class D{constructor(e,i,o,n){d(this,"name");d(this,"position");d(this,"mesh");console.log(e),this.name=o;const t=e.getScene(),r=t.getMeshByName("Table");let a=x.CreateSphere(`pivot-Cylinder-${o}`,{diameterX:.15,diameterY:.33,diameterZ:.2},e.getScene());a.visibility=0,e.name=o,e.parent=a,e.rotationQuaternion=null;let h=x.CreateBox("LEFT_COLLISION");h.scaling.y=.01,h.scaling.x=.04,h.scaling.z=.04,h.parent=a,h.position.y+=.3,h.position.x-=.15,h.visibility=0;let s=x.CreateBox("RIGHT_COLLISION");if(s.scaling.y=.01,s.scaling.x=.04,s.scaling.z=.04,s.parent=a,s.position.y+=.3,s.position.x+=.15,s.visibility=0,e.getChildMeshes().forEach(u=>{switch(u.name){case"BeakerwOpacity":u.name=P,u.rotationQuaternion=null,u.rotation.z=2*Math.PI,u.isPickable=!1;break;case"BeakerLiquid":u.name=H,u.isPickable=!1;break}}),r){const u=r.getBoundingInfo().boundingBox,w=N(e,P).getBoundingInfo().boundingBox.maximum.y+1e-5;a.position.y=u.maximumWorld.y+w,a.position.x=(u.maximumWorld.x-u.minimumWorld.x)/K*i+u.minimumWorld.x-.3,a.position.z=(u.centerWorld.z+u.minimumWorld.z)/2,this.position={...a.position}}else a.position.x=-2+i,a.position.y=1.22,a.position.z=.5;a.checkCollisions=!0,a.ellipsoid=new y(.02,.16,.02),this.mesh=a;const c=N(e,H),g=new k("liquid-material");g.diffuseColor=n,c.material=g;const b=N(e,"Label"),C=N(e,"LabelBack");console.log("Label:",b);const p=new q("dynamic texture",256,t);p.uAng=Math.PI;const f=new k("Mat",t);f.diffuseTexture=p,b.material=f,C.material=f;const A="bold 220px monospace";p.drawText(e.name.toUpperCase(),65,185,A,"black","white");const O=new $("highlight-layer");O.innerGlow=!0,O.outerGlow=!1,O.isEnabled=!1,N(e,P).addBehavior(new le(O,M.Green()))}addDragCollision(){let e=new Z({dragPlaneNormal:new y(0,0,1)});e.useObjectOrientationForDragging=!1,e.moveAttached=!1,e.onDragStartObservable.add(()=>{}),e.onDragObservable.add(i=>{this.mesh.moveWithCollisions(i.delta)}),e.onDragEndObservable.add(()=>{this.fadeAndRespawn()}),this.mesh.addBehavior(e)}fadeAndRespawn(e=ae){setTimeout(()=>{this.mesh.isPickable=!1;let i=this.mesh.name.split("-")[0],o=this.mesh.getScene(),n=this.mesh.getChildMeshes(),t=n.find(f=>f.name==="cylinder"),r=n.find(f=>f.name==="liquid"),a=new m("InvisibilityOfCylinder","visibility",120,m.ANIMATIONTYPE_FLOAT,m.ANIMATIONLOOPMODE_CONSTANT),h=new m("VisibilityOfCylinder","visibility",120,m.ANIMATIONTYPE_FLOAT,m.ANIMATIONLOOPMODE_CONSTANT),s=new m("InvisibilityOfLiquid","visibility",120,m.ANIMATIONTYPE_FLOAT,m.ANIMATIONLOOPMODE_CONSTANT),c=new m("VisibilityOfLiquid","visibility",120,m.ANIMATIONTYPE_FLOAT,m.ANIMATIONLOOPMODE_CONSTANT);const g=[{frame:0,value:1},{frame:60,value:0}],b=[{frame:0,value:0},{frame:60,value:1}],C=[{frame:0,value:1},{frame:60,value:0}],p=[{frame:0,value:0},{frame:60,value:1}];t.animations=[a,h],r.animations=[s,c],a.setKeys(C),h.setKeys(p),s.setKeys(g),c.setKeys(b),o.beginDirectAnimation(t,[a],0,60,!1),o.beginDirectAnimation(r,[s],0,60,!1,void 0,()=>{t.rotation.z=Math.PI*2,console.log(this.mesh,this.position),this.mesh.position.x=this.position._x,this.mesh.position.y=this.position._y,this.mesh.position.z=this.position._z,t.getAnimationByName(`${i}-rotateAroundZ`),o.beginDirectAnimation(t,[h],0,60,!1),o.beginDirectAnimation(r,[c],0,60,!1,void 0,()=>{this.mesh.isPickable=!0})})},e)}}function re(l){l.name="clipboard";const e=l.getScene(),i=e.getMeshByName("Table");if(i){const n=i.getBoundingInfo().boundingBox;l.position.y=n.maximumWorld.y+.003}l.rotationQuaternion=null,l.rotation=new y(0,Math.PI/4,0);const o=e.getMeshByName("pivot-Cylinder-A");o&&(l.position.x=o.position.x+.2,l.position.z=o.position.z+.5)}function he(l){var e=new F(M.FromHexString("#0984e3"));e.ignoreChildren=!0;var i=l[0],o=F.MakeNotPickableAndWrapInBoundingBox(i);e.attachedMesh=o,e.onScaleBoxDragObservable.add(()=>{console.log("scaleDrag")}),e.onScaleBoxDragEndObservable.add(()=>{const n=e.attachedMesh;if(n){const t=n.getHierarchyBoundingVectors(!0);console.log("size x:",t.max.x-t.min.x),console.log("size y:",t.max.y-t.min.y),console.log("size z:",t.max.z-t.min.z)}console.log("scaleEnd")}),e.onRotationSphereDragObservable.add(()=>{console.log("rotDrag")}),e.onRotationSphereDragEndObservable.add(()=>{console.log("rotEnd")})}function S(l,e,i){const o=l.find(g=>g.name==="__root__"),n=o.getScene();o.name=i;const t=l.find(g=>g.name==="Label"),r=l.find(g=>g.name==="Placard");r.name=se;const a=new q("dynamic texture",256,n);a.wAng=-Math.PI/2,a.uAng=Math.PI;const h=new k("Mat",n);h.diffuseTexture=a,t.material=h;const s="bold 220px monospace";a.drawText(o.name.split("-")[1].toUpperCase(),65,185,s,"black","white"),r.addChild(t),r.rotationQuaternion=null,r.rotation=new y(0,Math.PI/2,0);const c=n.getMeshByName("Table");if(c){const g=c.getBoundingInfo().boundingBox;o.position.y=g.maximumWorld.y+.003,o.position.x=(g.maximumWorld.x-g.minimumWorld.x)/K*e+g.minimumWorld.x-.2,o.position.z=(g.centerWorld.z+g.minimumWorld.z)/2+.2}}function de(l,e){let i;return new Promise(o=>{const n="./models/",t="left.glb",r="right.glb";var a={};const h=new Q(l);h.addMeshTask("load left hand","",n,t),h.addMeshTask("load right hand","",n,r),h.onTaskSuccess=s=>{console.log("Task:",s.loadedMeshes[0]);for(let c of s.loadedMeshes)a[c.name]=c;console.log("MODELS: ",a),i=s.loadedAnimationGroups,console.log("Scene animation groups: ",l.animationGroups)},h.onTasksDoneObservable.add(()=>{for(let s=0;s<l.animationGroups.length;s++)l.animationGroups[s].pause();e.pointerSelection.detach(),e.input.onControllerAddedObservable.add(s=>{let c=s.inputSource.handedness,g=a[v[c]].parent.parent;a[v[c]].isPickable=!1,console.log(g);let b=(Object.keys(a).indexOf(v[c])-1)*2-1;console.log(a[v[c]]),a[v[c]].rotation.y=Math.PI*b,a[v[c]].rotation.z=0,a[v[c]].rotation.x=-Math.PI/4,g.parent=s.grip||s.pointer})}),h.loadAsync().then(()=>{o(i)})})}function ce(l,e,i,o,n){let t;function r(a){for(let h of["A","B","C"]){let s=l.getMeshByName(`pivot-Cylinder-${h}`);if(a.intersectsMesh(s,!1))return s}return!1}e.input.onControllerAddedObservable.add(a=>{a.onMotionControllerInitObservable.add(h=>{let s=h;s.handID=h.handedness;let c=new X(y.Zero(),y.Zero(),.25);const g=h.getComponentOfType("squeeze"),b=h.getComponentOfType("trigger");function C(p,f){s.lastPosition=null,clearInterval(f),console.log("Dropped test tube"),s.grabbed=!1,s.meshGrabbed=void 0,console.log("Current hand: ",s),console.log(p),console.log(n),p&&n.find(O=>{console.log(O,p);let u=p.name.split("-");return O.name==u[u.length-1]}).fadeAndRespawn(100)}[b,g].forEach(p=>{p.onButtonStateChangedObservable.add(f=>{let A=v[s.handID],O;console.log("Trigger pressed: ",f.value);let u={left:0,right:7},B=l.animationGroups[u[s.handID]];console.log(B),B.goToFrame(f.value*(B._to-1)+1);let I=r(l.getMeshByName(v[s.handID]));if(f.value>0&&(s.lastPosition=Object.assign({},c.origin)),f.value>0&&!s.grabbed){if(I){t=I,s.meshGrabbed=t,s.grabbed=!0,a.getWorldPointerRayToRef(c),s.lastPosition=Object.assign({},c.origin),console.log("Current hand: ",s);let w=s.lastPosition,_=c.origin;_!=w&&(O=setInterval(()=>{let R=s.lastPosition;a.getWorldPointerRayToRef(c),R&&t&&t.moveWithCollisions(_.subtract(R)),!r(l.getMeshByName(A))&&t&&(console.log(A,t),C(t,O),t=null),s.lastPosition=Object.assign({},c.origin)},10))}}else(!f.value||!I)&&t&&(console.log(A,t),C(t,O),t=null)})})})})}function ge(l,e){l.onBeforeRenderObservable.add(function(){let o=["A","B","C"];for(let n=0;n<o.length;n++){const t=l.getMeshByName(`pivot-Cylinder-${o[n]}`),r=l.getMeshByName("Table");if(r&&t){const a=r.getBoundingInfo().boundingBox;t.position.z=(a.centerWorld.z+a.minimumWorld.z)/2}}});let i=["A","B","C"];for(let o of i){const n=l.getMeshByName(`pivot-Cylinder-${o}`);let t=new m(`${o}-rotateAroundZ`,"rotation.z",120,m.ANIMATIONTYPE_FLOAT,m.ANIMATIONLOOPMODE_CONSTANT),r=N(n,P);const a=[];a.push({frame:0,value:Math.PI*2}),a.push({frame:60,value:4.62}),r.animations.push(t),t.setKeys(a);let h=new m(`${o}-resetRotateAroundZ`,"rotation.z",120,m.ANIMATIONTYPE_FLOAT,m.ANIMATIONLOOPMODE_CONSTANT);const s=[];s.push({frame:0,value:4.62}),s.push({frame:60,value:Math.PI*2}),r.animations.push(h),h.setKeys(s)}}var T;class me{constructor(e){d(this,"flying",!1);d(this,"active",!1);d(this,"camera");d(this,"mesh");d(this,"offset",.3);d(this,"animations");d(this,"returnPosition");d(this,"returnRotation");d(this,"onPointerDownObserver");d(this,"xrCamera");d(this,"attach",(e,i,o,n,t)=>{const r=e.getScene();if(this.mesh=e,!i&&(i=r.activeCamera,!i))throw new Error("The scene has no active camera, and no camera was provided.");this.camera=i,o||(o=this.mesh.position),n||(n=this.mesh.rotation),t&&(this.offset=t),this.returnPosition=o,this.returnRotation=n,this.onPointerDownObserver=r.onPointerObservable.add(this.clipboardClick)});d(this,"detach",()=>{this.mesh.getScene().onPointerObservable.remove(this.onPointerDownObserver)});d(this,"clipboardClick",(e={type:G.POINTERDOWN,pickInfo:{pickedMesh:this.mesh}})=>{var i;if(e.type===G.POINTERDOWN){const o=(i=e.pickInfo)==null?void 0:i.pickedMesh;if(o&&(o===this.mesh||o.isDescendantOf(this.mesh))&&!this.flying){const n=this.active?L/2:0,t=this.active?0:L/2;W(this,T).call(this),this.flying=!0,this.mesh.billboardMode==E.BILLBOARDMODE_ALL?this.mesh.billboardMode=E.BILLBOARDMODE_NONE:this.mesh.billboardMode=E.BILLBOARDMODE_ALL,this.mesh.getScene().beginDirectAnimation(this.mesh,this.animations,n,t,!1,void 0,()=>{this.flying=!1,this.active=!this.active})}}});d(this,"calculateTargetPositionWithOffset",e=>{if(this.xrCamera!==void 0&&this.xrCamera.state===j.IN_XR){const r=this.xrCamera.camera._position.subtract(this.returnPosition).scale(1-e/y.Distance(this.returnPosition,this.xrCamera.camera._position));return this.returnPosition.add(r)}const o=this.camera._position.subtract(this.returnPosition).scale(1-e/y.Distance(this.returnPosition,this.camera._position));return this.returnPosition.add(o)});d(this,"setClipboardUp",()=>new y(3.1468286,4.6617744,1.680752));z(this,T,()=>{const e=this.animations.find(({name:t})=>t==="translate"),i=this.animations.find(({name:t})=>t==="rotate"),o=[{frame:0,value:this.returnPosition},{frame:L/2,value:this.calculateTargetPositionWithOffset(this.offset)}],n=[{frame:0,value:this.returnRotation},{frame:L/2,value:this.setClipboardUp()}];e.setKeys(o),i.setKeys(n)});const i=new m("translate","position",L,m.ANIMATIONTYPE_VECTOR3),o=new m("rotate","rotation",L,m.ANIMATIONTYPE_VECTOR3);this.animations=[i,o],this.xrCamera=e}get name(){return"FlyToCamera"}init(){}}T=new WeakMap;class ue{constructor(){d(this,"handAnimation");d(this,"sop");d(this,"models");d(this,"cylinders");this.cylinders=[],this.models=[{fileName:"NewLaboratoryUNFINISHED.glb",callback:e=>this.createRoom(e),label:"floor"},{fileName:"clipBoardWithPaperCompressedTexture.glb",callback:e=>re(e[0])},{fileName:"Placard_Label.glb",callback:e=>S(e,1,"Placard-A")},{fileName:"Placard_Label.glb",callback:e=>S(e,2,"Placard-B")},{fileName:"Placard_Label.glb",callback:e=>S(e,3,"Placard-C")},{fileName:"TLLGraduatedCylinderWithLabel.glb",callback:e=>this.cylinders.push(new D(e[0],1,"A",new M(1,0,0))),label:"Cylinder-A"},{fileName:"TLLGraduatedCylinderWithLabel.glb",callback:e=>this.cylinders.push(new D(e[0],2,"B",new M(0,1,0))),label:"Cylinder-B"},{fileName:"TLLGraduatedCylinderWithLabel.glb",callback:e=>this.cylinders.push(new D(e[0],3,"C",new M(0,0,1))),label:"Cylinder-C"}].map(function(e){return Object.assign({},{fileName:"LabBench.glb",root:"./models/",callback:he,label:"NoLabel"},e)}),this.createScene().then(e=>{let i={};for(let o of["A","B","C"])i[`pivot-Cylinder-${o}`]=Object.assign({},e.getMeshByName(`pivot-Cylinder-${o}`).position);this.processScene(e,i,this.cylinders)})}async processScene(e,i,o){let n=e.getCameraByName("camera"),t=e.getLightByName("light1"),r={};n.speed=.16;let a=setInterval(()=>{t.intensity>=1?clearInterval(a):t.intensity+=.1},60);const h=["WallsandFloor","WallsAndFloor.001"],s=[];for(let g of h){console.log(g);const b=e.getMeshByName(g);b&&s.push(b)}let c={floorMeshes:s,inputOptions:{doNotLoadControllerMeshes:!0}};r=await e.createDefaultXRExperienceAsync(c),r.pointerSelection.displayLaserPointer=!1,r.pointerSelection.displaySelectionMesh=!1,de(e,r).then(g=>{const b=e.getMeshByName("clipboard");if(r){const C=new me(r.baseExperience);b.addBehavior(C)}console.log(this.models[2]),ge(e),ce(e,r,g,i,o)})}createRoom(e){const i=["WallsandFloor","WallsAndFloor.001","Table","Roof","Countertop","Walls"];let o,n;for(let t of i){const r=e.find(a=>a.name===t);if(r&&(r.checkCollisions=!0,r.name==="Table")){const h=r.getBoundingInfo().boundingBox.center.x;o=r.getScene(),n=o.getCameraByName("camera"),n.position.x=h-.7}}}createScene(){return new Promise(e=>{var i=document.getElementById("canvas"),o=new J(i,!0,{stencil:!0}),n=new ee(o);n.debugLayer.show(),n.collisionsEnabled=!0,window.addEventListener("resize",function(){o.resize()}),oe(n);const t=new te("camera",new y(0,1.84,-1.134),n);t.ellipsoid=new y(.4,.7,.4),t.attachControl(i,!0),t.applyGravity=!0,t.minZ=0,t.speed=0,t.checkCollisions=!0,t.keysUp.push(87),t.keysDown.push(83),t.keysLeft.push(65),t.keysRight.push(68);var r=new ie("light1",new y(1,1,0),n);r.intensity=0,Promise.all(this.models.map(a=>new Promise(h=>ne.ImportMesh("",a.root,a.fileName,n,function(s){a.mesh=s,h(s)})))).then(()=>{let a=[];this.models.map(h=>{a.push(h.callback(h.mesh)),e(n)})}),window.addEventListener("keydown",a=>{a.shiftKey&&a.ctrlKey&&a.altKey&&a.keyCode===73&&(n.debugLayer.isVisible()?n.debugLayer.hide():n.debugLayer.show())}),o.runRenderLoop(()=>{n.render()})})}}new ue;
