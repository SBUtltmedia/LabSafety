var q=Object.defineProperty;var K=(s,e,n)=>e in s?q(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var c=(s,e,n)=>(K(s,typeof e!="symbol"?e+"":e,n),n),U=(s,e,n)=>{if(!e.has(s))throw TypeError("Cannot "+n)};var R=(s,e,n)=>(U(s,e,"read from private field"),n?n.call(s):e.get(s)),W=(s,e,n)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,n)};import{M as w,V as O,S as _,D as $,H as V,C as I,P as Y,A as f,B as z,a as Z,R as Q,b as F,c as D,W as X,E as j,d as J,U as ee,e as te,f as ie}from"./vendor.8cc9db75.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function n(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerpolicy&&(i.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?i.credentials="include":t.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(t){if(t.ep)return;t.ep=!0;const i=n(t);fetch(t.href,i)}})();window.exports=window;function p(s,e){return s.getChildMeshes().find(n=>n.name===e)||null}function ne(s){var o;const e=new URLSearchParams(document.location.search);(e.get("debug")===""||((o=e.get("debug"))==null?void 0:o.toLowerCase())==="true")&&s.debugLayer.show()}class oe{constructor(e,n,o,t=0){c(this,"complete",!1);c(this,"title");c(this,"description");c(this,"failed",!1);c(this,"onFail");c(this,"onSuccess");c(this,"onCompletion");c(this,"currentState");c(this,"tasks");this.title=e,this.description=n,this.tasks=o,this.currentState=t}}const B=60,ae=50,H=3,M="cylinder",G="liquid",se="placard",le=new oe("","",[{next:"CtoA",label:"BtoC"},{next:"complete",label:"CtoA"}]);class re{constructor(e,n){c(this,"highlightLayer");c(this,"highlightColor");c(this,"highlightReferences");c(this,"highlightingMeshes");c(this,"mesh");c(this,"attach",e=>{this.mesh=e,this.highlightLayer.addMesh(this.mesh,this.highlightColor)});c(this,"detach",()=>{this.highlightLayer.removeMesh(this.mesh),this.highlightReferences=0,this.highlightingMeshes=[]});c(this,"highlightSelf",()=>{this.highlightLayer.isEnabled=!0});c(this,"unhighlightSelf",()=>{this.highlightReferences||(this.highlightLayer.isEnabled=!1)});c(this,"highlightMesh",e=>{if(this.highlightingMeshes.find(o=>o===e))return!1;const n=e.getBehaviorByName(this.name);return n?(n.highlightReferences+=1,n.highlightSelf(),this.highlightingMeshes.push(e),!0):!1});c(this,"unhighlightMesh",e=>{const n=e.getBehaviorByName(this.name);if(!n)return!1;const o=this.highlightingMeshes.findIndex(t=>t===e);return o===-1?!1:(n.highlightReferences-=1,n.unhighlightSelf(),this.highlightingMeshes.splice(o,1),!0)});this.highlightLayer=e,this.highlightColor=n,this.highlightReferences=0,this.highlightingMeshes=[]}get name(){return"Highlight"}init(){}}class S{constructor(e,n,o,t){c(this,"name");c(this,"position");c(this,"mesh");c(this,"dragCollision");console.log(e),this.name=o;const i=e.getScene(),d=i.getMeshByName("Table");let a=w.CreateSphere(`pivot-Cylinder-${o}`,{segments:2,diameterX:.15,diameterY:.33,diameterZ:.2},e.getScene());a.visibility=0,e.name=o,e.parent=a,e.rotationQuaternion=null;let l=w.CreateBox("LEFT_COLLISION");l.scaling.y=.01,l.scaling.x=.04,l.scaling.z=.04,l.parent=a,l.position.y+=.3,l.position.x-=.15,l.visibility=0;let r=w.CreateBox("RIGHT_COLLISION");if(r.scaling.y=.01,r.scaling.x=.04,r.scaling.z=.04,r.parent=a,r.position.y+=.3,r.position.x+=.15,r.visibility=0,e.getChildMeshes().forEach(b=>{switch(b.name){case"BeakerwOpacity":b.name=M,b.rotationQuaternion=null,b.rotation.z=2*Math.PI,b.isPickable=!1;break;case"BeakerLiquid":b.name=G,b.isPickable=!1;break}}),d){const b=d.getBoundingInfo().boundingBox,L=p(e,M).getBoundingInfo().boundingBox.maximum.y+1e-5;a.position.y=b.maximumWorld.y+L,a.position.x=(b.maximumWorld.x-b.minimumWorld.x)/H*n+b.minimumWorld.x-.3,a.position.z=(b.centerWorld.z+b.minimumWorld.z)/2,this.position={...a.position}}else a.position.x=-2+n,a.position.y=1.22,a.position.z=.5;a.checkCollisions=!0,a.ellipsoid=new O(.02,.16,.02),this.mesh=a;const g=p(e,G),h=new _("liquid-material");h.diffuseColor=t,g.material=h;const m=p(e,"Label"),C=p(e,"LabelBack");console.log("Label:",m);const y=new $("dynamic texture",256,i);y.uAng=Math.PI;const u=new _("Mat",i);u.diffuseTexture=y,m.material=u,C.material=u;const A="bold 220px monospace";y.drawText(e.name.toUpperCase(),65,185,A,"black","white");const v=new V("highlight-layer");v.innerGlow=!0,v.outerGlow=!1,v.isEnabled=!1,p(e,M).addBehavior(new re(v,I.Green())),this.addDragCollision()}addDragCollision(){let e=new Y({dragPlaneNormal:new O(0,0,1)});e.useObjectOrientationForDragging=!1,e.moveAttached=!1,e.onDragStartObservable.add(()=>{}),e.onDragObservable.add(n=>{this.mesh.moveWithCollisions(n.delta)}),e.onDragEndObservable.add(()=>{this.fadeAndRespawn()}),this.mesh.addBehavior(e),this.dragCollision=e}removeDragCollision(){this.mesh.removeBehavior(this.dragCollision)}fadeAndRespawn(e=ae){setTimeout(()=>{this.mesh.isPickable=!1;let n=this.mesh.name.split("-")[0],o=this.mesh.getScene(),t=this.mesh.getChildMeshes(),i=t.find(u=>u.name==="cylinder"),d=t.find(u=>u.name==="liquid"),a=new f("InvisibilityOfCylinder","visibility",120,f.ANIMATIONTYPE_FLOAT,f.ANIMATIONLOOPMODE_CONSTANT),l=new f("VisibilityOfCylinder","visibility",120,f.ANIMATIONTYPE_FLOAT,f.ANIMATIONLOOPMODE_CONSTANT),r=new f("InvisibilityOfLiquid","visibility",120,f.ANIMATIONTYPE_FLOAT,f.ANIMATIONLOOPMODE_CONSTANT),g=new f("VisibilityOfLiquid","visibility",120,f.ANIMATIONTYPE_FLOAT,f.ANIMATIONLOOPMODE_CONSTANT);const h=[{frame:0,value:1},{frame:60,value:0}],m=[{frame:0,value:0},{frame:60,value:1}],C=[{frame:0,value:1},{frame:60,value:0}],y=[{frame:0,value:0},{frame:60,value:1}];i.animations=[a,l],d.animations=[r,g],a.setKeys(C),l.setKeys(y),r.setKeys(h),g.setKeys(m),o.beginDirectAnimation(i,[a],0,60,!1),o.beginDirectAnimation(d,[r],0,60,!1,void 0,()=>{i.rotation.z=Math.PI*2,console.log(this.mesh,this.position),this.mesh.position.x=this.position._x,this.mesh.position.y=this.position._y,this.mesh.position.z=this.position._z,i.getAnimationByName(`${n}-rotateAroundZ`),o.beginDirectAnimation(i,[l],0,60,!1),o.beginDirectAnimation(d,[g],0,60,!1,void 0,()=>{this.mesh.isPickable=!0})})},e)}}function he(s){s.name="clipboard";const e=s.getScene(),n=e.getMeshByName("Table");if(n){const t=n.getBoundingInfo().boundingBox;s.position.y=t.maximumWorld.y+.003}s.rotationQuaternion=null,s.rotation=new O(0,Math.PI/4,0);const o=e.getMeshByName("pivot-Cylinder-A");o&&(s.position.x=o.position.x+.2,s.position.z=o.position.z+.5)}function de(s){var e=new z(I.FromHexString("#0984e3"));e.ignoreChildren=!0;var n=s[0],o=z.MakeNotPickableAndWrapInBoundingBox(n);e.attachedMesh=o,e.onScaleBoxDragObservable.add(()=>{console.log("scaleDrag")}),e.onScaleBoxDragEndObservable.add(()=>{const t=e.attachedMesh;if(t){const i=t.getHierarchyBoundingVectors(!0);console.log("size x:",i.max.x-i.min.x),console.log("size y:",i.max.y-i.min.y),console.log("size z:",i.max.z-i.min.z)}console.log("scaleEnd")}),e.onRotationSphereDragObservable.add(()=>{console.log("rotDrag")}),e.onRotationSphereDragEndObservable.add(()=>{console.log("rotEnd")})}function E(s,e,n){const o=s.find(h=>h.name==="__root__"),t=o.getScene();o.name=n;const i=s.find(h=>h.name==="Label"),d=s.find(h=>h.name==="Placard");d.name=se;const a=new $("dynamic texture",256,t);a.wAng=-Math.PI/2,a.uAng=Math.PI;const l=new _("Mat",t);l.diffuseTexture=a,i.material=l;const r="bold 220px monospace";a.drawText(o.name.split("-")[1].toUpperCase(),65,185,r,"black","white"),d.addChild(i),d.rotationQuaternion=null,d.rotation=new O(0,Math.PI/2,0);const g=t.getMeshByName("Table");if(g){const h=g.getBoundingInfo().boundingBox;o.position.y=h.maximumWorld.y+.003,o.position.x=(h.maximumWorld.x-h.minimumWorld.x)/H*e+h.minimumWorld.x-.2,o.position.z=(h.centerWorld.z+h.minimumWorld.z)/2+.2}}function ce(s,e,n){let o;return new Promise(t=>{const i="./models/";let d="";var a={};let l=["left","right"];const r=new Z(s);l.forEach(h=>{r.addMeshTask(`load ${h} hand`,"",i,`${h}${d}.glb`)});let g=0;r.onTaskSuccess=h=>{a[l[g]]=h.loadedMeshes[1],h.loadedMeshes[1].name=l[g],o=h.loadedAnimationGroups;for(let m=0;m<h.loadedAnimationGroups.length;m++)h.loadedAnimationGroups[m].name=`${l[g]}_${h.loadedAnimationGroups[m].name}`;g++},r.onTasksDoneObservable.add(()=>{for(let h=0;h<s.animationGroups.length;h++)s.animationGroups[h].pause();e.pointerSelection.detach(),e.input.onControllerAddedObservable.add(h=>{let m=h.inputSource.handedness;console.log(a[m]);let C=a[m].parent.parent;a[m].isPickable=!1;for(let u of n)u.removeDragCollision();let y=(Object.keys(a).indexOf(m)-1)*2-1;a[m].rotation.y=Math.PI*y,a[m].rotation.z=0,a[m].rotation.x=-Math.PI/4,C.parent=h.grip||h.pointer})}),r.loadAsync().then(()=>{t(o)})})}function ge(s,e,n,o){let t,i=["A","B","C"];function d(a){for(let l of i){let r=s.getMeshByName(`pivot-Cylinder-${l}`);if(a.intersectsMesh(r,!1))return r}return!1}e.input.onControllerAddedObservable.add(a=>{a.onMotionControllerInitObservable.add(l=>{let r=l;r.handID=l.handedness;let g=new Q(O.Zero(),O.Zero(),.25);const h=l.getComponentOfType("squeeze"),m=l.getComponentOfType("trigger");function C(y,u){r.lastPosition=null,clearInterval(u),console.log("Dropped test tube"),r.grabbed=!1,r.meshGrabbed=void 0,console.log("Current hand: ",r),console.log(y),console.log(o),y&&o.find(v=>{console.log(v,y);let b=y.name.split("-");return v.name==b[b.length-1]}).fadeAndRespawn(100)}[m,h].forEach(y=>{y.onButtonStateChangedObservable.add(u=>{let A=r.handID,v,b={left:"Fist",right:"Grip"},N=s.animationGroups.find((L,T)=>(console.log(T,A),L.name===`${A}_${b[A]}`));console.log(N._to),console.log(s.animationGroups[0],s.animationGroups[7]),N.goToFrame(u.value*(N._to-1)+1);let P=d(s.getMeshByName(r.handID));if(u.value>0&&(r.lastPosition=Object.assign({},g.origin)),u.value>0&&!r.grabbed){if(P){t=P,r.meshGrabbed=t,r.grabbed=!0,a.getWorldPointerRayToRef(g),r.lastPosition=Object.assign({},g.origin);let L=r.lastPosition,T=g.origin;T!=L&&(v=setInterval(()=>{let k=r.lastPosition;a.getWorldPointerRayToRef(g),k&&t&&t.moveWithCollisions(T.subtract(k)),!d(s.getMeshByName(A))&&t&&(console.log(A,t),C(t,v),t=null),r.lastPosition=Object.assign({},g.origin)},10))}}else(!u.value||!P)&&t&&(console.log(A,t),C(t,v),t=null)})})})})}function me(s,e){s.onBeforeRenderObservable.add(function(){let t=["A","B","C"];for(let i=0;i<t.length;i++){const d=s.getMeshByName(`pivot-Cylinder-${t[i]}`),a=s.getMeshByName("Table");if(a&&d){const l=a.getBoundingInfo().boundingBox;d.position.z=(l.centerWorld.z+l.minimumWorld.z)/2}}});let n=["A","B","C"],o=[];for(let t of n){const i=s.getMeshByName(`pivot-Cylinder-${t}`);o.push(i);let d=new f(`${t}-rotateAroundZ`,"rotation.z",120,f.ANIMATIONTYPE_FLOAT,f.ANIMATIONLOOPMODE_CONSTANT),a=p(i,M);const l=[];l.push({frame:0,value:Math.PI*2}),l.push({frame:60,value:4.62}),a.animations.push(d),d.setKeys(l);let r=new f(`${t}-resetRotateAroundZ`,"rotation.z",120,f.ANIMATIONTYPE_FLOAT,f.ANIMATIONLOOPMODE_CONSTANT);const g=[];g.push({frame:0,value:4.62}),g.push({frame:60,value:Math.PI*2}),a.animations.push(r),r.setKeys(g)}for(let t=0;t<n.length;t++){const i=s.getMeshByName(`pivot-Cylinder-${n[t]}`),d=i.getBehaviorByName("PointerDrag");let a=[];for(let g of o)g!=i&&a.push(g);let l=p(i,M),r=!1;d.onDragObservable.add(()=>{const g=p(i,M).getBehaviorByName("Highlight");let h=!1;for(let m of a){let C=p(m,"LEFT_COLLISION"),y=p(m,"RIGHT_COLLISION"),u=p(m,M);if(i.intersectsMesh(C)||i.intersectsMesh(y)){h=!0;let A=m.name.split("-")[2],b=`${i.name.split("-")[2]}to${A}`;if(e.tasks[e.currentState].label===b&&(e.tasks[e.currentState].next==="complete"?window.location.assign("."):e.currentState=e.tasks.indexOf(e.tasks.find(N=>N.label==e.tasks[e.currentState].next))),g&&(g.highlightMesh(l),g.highlightMesh(u),i.intersectsMesh(C)?(u.rotation.y=Math.PI,l.rotation.y=0):(u.rotation.y=0,l.rotation.y=Math.PI),!r)){let N=l.getAnimationByName(`${n[t]}-rotateAroundZ`);r=!0,s.beginDirectAnimation(l,[N],0,60,!1,void 0,()=>{})}break}else g.unhighlightMesh(u)}if(h==!1){g.unhighlightMesh(l);let m=l.getAnimationByName(`${n[t]}-resetRotateAroundZ`);r&&(r=!1,s.beginDirectAnimation(l,[m],0,60,!1,void 0,()=>{}))}}),d.onDragEndObservable.add(()=>{const g=p(i,M).getBehaviorByName("Highlight");for(let h of a){let m=p(h,"LEFT_COLLISION"),C=p(h,"RIGHT_COLLISION"),y=p(h,M);if(g.unhighlightMesh(l),g.unhighlightMesh(y),l.intersectsMesh(m)||l.intersectsMesh(C)){let u=l.getAnimationByName(`${n[t]}-resetRotateAroundZ`);l.rotation.z==4.62&&s.beginDirectAnimation(l,[u],0,60,!1,void 0,()=>{})}}})}}var x;class ue{constructor(e){c(this,"flying",!1);c(this,"active",!1);c(this,"camera");c(this,"mesh");c(this,"offset",.3);c(this,"animations");c(this,"returnPosition");c(this,"returnRotation");c(this,"onPointerDownObserver");c(this,"xrCamera");c(this,"attach",(e,n,o,t,i)=>{const d=e.getScene();if(this.mesh=e,!n&&(n=d.activeCamera,!n))throw new Error("The scene has no active camera, and no camera was provided.");this.camera=n,o||(o=this.mesh.position),t||(t=this.mesh.rotation),i&&(this.offset=i),this.returnPosition=o,this.returnRotation=t,this.onPointerDownObserver=d.onPointerObservable.add(this.clipboardClick)});c(this,"detach",()=>{this.mesh.getScene().onPointerObservable.remove(this.onPointerDownObserver)});c(this,"clipboardClick",(e={type:F.POINTERDOWN,pickInfo:{pickedMesh:this.mesh}})=>{var n;if(e.type===F.POINTERDOWN){const o=(n=e.pickInfo)==null?void 0:n.pickedMesh;if(o&&(o===this.mesh||o.isDescendantOf(this.mesh))&&!this.flying){const t=this.active?B/2:0,i=this.active?0:B/2;R(this,x).call(this),this.flying=!0,this.mesh.billboardMode==D.BILLBOARDMODE_ALL?this.mesh.billboardMode=D.BILLBOARDMODE_NONE:this.mesh.billboardMode=D.BILLBOARDMODE_ALL,this.mesh.getScene().beginDirectAnimation(this.mesh,this.animations,t,i,!1,void 0,()=>{this.flying=!1,this.active=!this.active})}}});c(this,"calculateTargetPositionWithOffset",e=>{if(this.xrCamera!==void 0&&this.xrCamera.state===X.IN_XR){const d=this.xrCamera.camera._position.subtract(this.returnPosition).scale(1-e/O.Distance(this.returnPosition,this.xrCamera.camera._position));return this.returnPosition.add(d)}const o=this.camera._position.subtract(this.returnPosition).scale(1-e/O.Distance(this.returnPosition,this.camera._position));return this.returnPosition.add(o)});c(this,"setClipboardUp",()=>new O(3.1468286,4.6617744,1.680752));W(this,x,()=>{const e=this.animations.find(({name:i})=>i==="translate"),n=this.animations.find(({name:i})=>i==="rotate"),o=[{frame:0,value:this.returnPosition},{frame:B/2,value:this.calculateTargetPositionWithOffset(this.offset)}],t=[{frame:0,value:this.returnRotation},{frame:B/2,value:this.setClipboardUp()}];e.setKeys(o),n.setKeys(t)});const n=new f("translate","position",B,f.ANIMATIONTYPE_VECTOR3),o=new f("rotate","rotation",B,f.ANIMATIONTYPE_VECTOR3);this.animations=[n,o],this.xrCamera=e}get name(){return"FlyToCamera"}init(){}}x=new WeakMap;class fe{constructor(){c(this,"handAnimation");c(this,"sop");c(this,"models");c(this,"cylinders");this.cylinders=[],this.models=[{fileName:"NewLaboratoryUNFINISHED.glb",callback:e=>this.createRoom(e),label:"floor"},{fileName:"clipBoardWithPaperCompressedTexture.glb",callback:e=>he(e[0])},{fileName:"Placard_Label.glb",callback:e=>E(e,1,"Placard-A")},{fileName:"Placard_Label.glb",callback:e=>E(e,2,"Placard-B")},{fileName:"Placard_Label.glb",callback:e=>E(e,3,"Placard-C")},{fileName:"TLLGraduatedCylinderWithLabel.glb",callback:e=>this.cylinders.push(new S(e[0],1,"A",new I(1,0,0))),label:"Cylinder-A"},{fileName:"TLLGraduatedCylinderWithLabel.glb",callback:e=>this.cylinders.push(new S(e[0],2,"B",new I(0,1,0))),label:"Cylinder-B"},{fileName:"TLLGraduatedCylinderWithLabel.glb",callback:e=>this.cylinders.push(new S(e[0],3,"C",new I(0,0,1))),label:"Cylinder-C"}].map(function(e){return Object.assign({},{fileName:"LabBench.glb",root:"./models/",callback:de,label:"NoLabel"},e)}),this.createScene().then(e=>{for(let n of["A","B","C"])Object.assign({},e.getMeshByName(`pivot-Cylinder-${n}`).position);this.processScene(e,this.cylinders)})}async processScene(e,n){let o=e.getCameraByName("camera"),t=e.getLightByName("light1"),i;o.speed=.16;let d=setInterval(()=>{t.intensity>=1?clearInterval(d):t.intensity+=.1},60);const a=["WallsandFloor","WallsAndFloor.001"],l=[];for(let g of a){console.log(g);const h=e.getMeshByName(g);h&&l.push(h)}let r={floorMeshes:l,inputOptions:{doNotLoadControllerMeshes:!0}};i=await e.createDefaultXRExperienceAsync(r),i.pointerSelection.displayLaserPointer=!1,i.pointerSelection.displaySelectionMesh=!1,ce(e,i,n).then(g=>{const h=e.getMeshByName("clipboard");if(i){const m=new ue(i.baseExperience);h.addBehavior(m)}me(e,le),ge(e,i,g,n)})}createRoom(e){const n=["WallsandFloor","WallsAndFloor.001","Table","Roof","Countertop","Walls"];let o,t;for(let i of n){const d=e.find(a=>a.name===i);if(d&&(d.checkCollisions=!0,d.name==="Table")){const l=d.getBoundingInfo().boundingBox.center.x;o=d.getScene(),t=o.getCameraByName("camera"),t.position.x=l-.7}}}createScene(){return new Promise(e=>{var n=document.getElementById("canvas"),o=new j(n,!0,{stencil:!0}),t=new J(o);t.debugLayer.show(),t.collisionsEnabled=!0,window.addEventListener("resize",function(){o.resize()}),ne(t);const i=new ee("camera",new O(0,1.84,-1.134),t);i.ellipsoid=new O(.4,.7,.4),i.attachControl(n,!0),i.applyGravity=!0,i.minZ=0,i.speed=0,i.checkCollisions=!0,i.keysUp.push(87),i.keysDown.push(83),i.keysLeft.push(65),i.keysRight.push(68);var d=new te("light1",new O(1,1,0),t);d.intensity=0,Promise.all(this.models.map(a=>new Promise(l=>ie.ImportMesh("",a.root,a.fileName,t,function(r){a.mesh=r,l(r)})))).then(()=>{let a=[];this.models.map(l=>{a.push(l.callback(l.mesh)),e(t)})}),window.addEventListener("keydown",a=>{a.shiftKey&&a.ctrlKey&&a.altKey&&a.keyCode===73&&(t.debugLayer.isVisible()?t.debugLayer.hide():t.debugLayer.show())}),o.runRenderLoop(()=>{t.render()})})}}new fe;
