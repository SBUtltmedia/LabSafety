var K=Object.defineProperty;var U=(s,e,i)=>e in s?K(s,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[e]=i;var c=(s,e,i)=>(U(s,typeof e!="symbol"?e+"":e,i),i),q=(s,e,i)=>{if(!e.has(s))throw TypeError("Cannot "+i)};var _=(s,e,i)=>(q(s,e,"read from private field"),i?i.call(s):e.get(s)),z=(s,e,i)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,i)};import{M as Z,V as v,S as E,D as H,H as Y,C as w,P as j,A as C,B as W,a as Q,R as X,b as F,T as J,c as ee,d as $,e as T,W as te,E as ie,f as ne,U as oe,g as ae,h as se}from"./vendor.bf34ae4b.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function i(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerpolicy&&(n.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?n.credentials="include":t.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(t){if(t.ep)return;t.ep=!0;const n=i(t);fetch(t.href,n)}})();window.exports=window;class le{constructor(e,i,a,t=0){c(this,"complete",!1);c(this,"title");c(this,"description");c(this,"failed",!1);c(this,"onFail");c(this,"onSuccess");c(this,"onCompletion");c(this,"currentState");c(this,"tasks");this.title=e,this.description=i,this.tasks=a,this.currentState=t}}const P=60,re=50,V=3,M="cylinder",k="liquid",he="placard",ce=new le("","",[{next:"CtoA",label:"BtoC"},{next:"complete",label:"CtoA"}]);class de{constructor(e,i){c(this,"highlightLayer");c(this,"highlightColor");c(this,"highlightReferences");c(this,"highlightingMeshes");c(this,"mesh");c(this,"attach",e=>{this.mesh=e,this.highlightLayer.addMesh(this.mesh,this.highlightColor)});c(this,"detach",()=>{this.highlightLayer.removeMesh(this.mesh),this.highlightReferences=0,this.highlightingMeshes=[]});c(this,"highlightSelf",()=>{this.highlightLayer.isEnabled=!0});c(this,"unhighlightSelf",()=>{this.highlightReferences||(this.highlightLayer.isEnabled=!1)});c(this,"highlightMesh",e=>{if(this.highlightingMeshes.find(a=>a===e))return!1;const i=e.getBehaviorByName(this.name);return i?(i.highlightReferences+=1,i.highlightSelf(),this.highlightingMeshes.push(e),!0):!1});c(this,"unhighlightMesh",e=>{const i=e.getBehaviorByName(this.name);if(!i)return!1;const a=this.highlightingMeshes.findIndex(t=>t===e);return a===-1?!1:(i.highlightReferences-=1,i.unhighlightSelf(),this.highlightingMeshes.splice(a,1),!0)});this.highlightLayer=e,this.highlightColor=i,this.highlightReferences=0,this.highlightingMeshes=[]}get name(){return"Highlight"}init(){}}function B(s,e){return s.getChildMeshes().find(i=>i.name===e)||null}class S{constructor(e,i,a,t){c(this,"name");c(this,"position");c(this,"mesh");c(this,"dragCollision");console.log(e),this.name=a;const n=e.getScene(),r=n.getMeshByName("Table");let o=Z.CreateSphere(`pivot-Cylinder-${a}`,{segments:2,diameterX:.15,diameterY:.33,diameterZ:.2},e.getScene());if(o.visibility=0,e.name=a,e.parent=o,e.rotationQuaternion=null,e.getChildMeshes().forEach(f=>{switch(f.name){case"BeakerwOpacity":f.name=M,f.rotationQuaternion=null,f.rotation.z=2*Math.PI,f.isPickable=!1;break;case"BeakerLiquid":f.name=k,f.isPickable=!1;break}}),r){const f=r.getBoundingInfo().boundingBox,A=B(e,M).getBoundingInfo().boundingBox.maximum.y+.01001;o.position.y=f.maximumWorld.y+A,o.position.x=(f.maximumWorld.x-f.minimumWorld.x)/V*i+f.minimumWorld.x-.3,o.position.z=(f.centerWorld.z+f.minimumWorld.z)/2,this.position={...o.position}}else o.position.x=-2+i,o.position.y=1.22,o.position.z=.5;o.checkCollisions=!0,o.ellipsoid=new v(.02,.16,.02),this.mesh=o;const d=B(e,k),l=new E("liquid-material");l.diffuseColor=t,d.material=l;const g=B(e,"Label"),h=B(e,"LabelBack");console.log("Label:",g);const m=new H("dynamic texture",256,n);m.uAng=Math.PI;const b=new E("Mat",n);b.diffuseTexture=m,g.material=b,h.material=b;const u="bold 220px monospace";m.drawText(e.name.toUpperCase(),65,185,u,"black","white");const y=new Y("highlight-layer");y.innerGlow=!0,y.outerGlow=!1,y.isEnabled=!1,B(e,M).addBehavior(new de(y,w.Green())),this.addDragCollision()}addDragCollision(){let e=new j({dragPlaneNormal:new v(0,0,1)});e.useObjectOrientationForDragging=!1,e.moveAttached=!1,e.onDragStartObservable.add(()=>{}),e.onDragObservable.add(i=>{this.mesh.moveWithCollisions(i.delta)}),e.onDragEndObservable.add(()=>{this.fadeAndRespawn()}),this.mesh.addBehavior(e),this.dragCollision=e}removeDragCollision(){this.mesh.removeBehavior(this.dragCollision)}fadeAndRespawn(e=re){setTimeout(()=>{this.mesh.isPickable=!1;let i=60;this.mesh.name.split("-")[0];let a=this.mesh.getScene(),t=this.mesh.getChildMeshes();console.log(t);let n=t.find(o=>o.name==="cylinder");t.find(o=>o.name==="liquid");let r=[{name:"Invisibility",startValue:1},{name:"Visibility",startValue:0}];r.forEach(o=>{o.init=new C(o.name,"visibility",120,C.ANIMATIONTYPE_FLOAT,C.ANIMATIONLOOPMODE_CONSTANT),o.init.setKeys([{frame:0,value:o.startValue},{frame:i,value:1-o.startValue}])});for(let o=0;o<t.length-1;++o){let d=t[o];a.beginDirectAnimation(d,[r[0].init],0,60,!1)}a.beginDirectAnimation(t[t.length-1],[r[0].init],0,60,!1,void 0,()=>{console.log(this.mesh,this.position),this.mesh.position.x=this.position._x,this.mesh.position.y=this.position._y,this.mesh.position.z=this.position._z,this.mesh.animations=n.animations,this.mesh.rotation.x=0,this.mesh.rotation.y=0,this.mesh.rotation.z=0;for(let o=0;o<t.length-1;++o){let d=t[o];a.beginDirectAnimation(d,[r[1].init],0,60,!1)}a.beginDirectAnimation(t[t.length-1],[r[1].init],0,60,!1,void 0,()=>{this.mesh.isPickable=!0})})},e)}}function ge(s){s.name="clipboard";const e=s.getScene(),i=e.getMeshByName("Table");if(i){const t=i.getBoundingInfo().boundingBox;s.position.y=t.maximumWorld.y+.003}s.rotationQuaternion=null,s.rotation=new v(0,Math.PI/4,0);const a=e.getMeshByName("pivot-Cylinder-A");a&&(s.position.x=a.position.x+.2,s.position.z=a.position.z+.5)}function me(s){var e=new W(w.FromHexString("#0984e3"));e.ignoreChildren=!0;var i=s[0],a=W.MakeNotPickableAndWrapInBoundingBox(i);e.attachedMesh=a,e.onScaleBoxDragObservable.add(()=>{console.log("scaleDrag")}),e.onScaleBoxDragEndObservable.add(()=>{const t=e.attachedMesh;if(t){const n=t.getHierarchyBoundingVectors(!0);console.log("size x:",n.max.x-n.min.x),console.log("size y:",n.max.y-n.min.y),console.log("size z:",n.max.z-n.min.z)}console.log("scaleEnd")}),e.onRotationSphereDragObservable.add(()=>{console.log("rotDrag")}),e.onRotationSphereDragEndObservable.add(()=>{console.log("rotEnd")})}function I(s,e,i){const a=s.find(h=>h.name==="__root__"),t=a.getScene();a.name=i;const n=s.find(h=>h.name==="Label"),r=s.find(h=>h.name==="Placard");r.name=he;const o=new H("dynamic texture",256,t);o.wAng=-Math.PI/2,o.uAng=Math.PI;const d=new E("Mat",t);d.diffuseTexture=o,n.material=d;const l="bold 220px monospace";o.drawText(a.name.split("-")[1].toUpperCase(),65,185,l,"black","white"),r.addChild(n),r.rotationQuaternion=null,r.rotation=new v(0,Math.PI/2,0);const g=t.getMeshByName("Table");if(g){const h=g.getBoundingInfo().boundingBox;a.position.y=h.maximumWorld.y+.003,a.position.x=(h.maximumWorld.x-h.minimumWorld.x)/V*e+h.minimumWorld.x-.2,a.position.z=(h.centerWorld.z+h.minimumWorld.z)/2+.2}}function ue(s,e,i){let a;return new Promise(t=>{const n="./models/";let r="";var o={};let d=["left","right"];const l=new Q(s);d.forEach(h=>{l.addMeshTask(`load ${h} hand`,"",n,`${h}${r}.glb`)});let g=0;l.onTaskSuccess=h=>{o[d[g]]=h.loadedMeshes[1],h.loadedMeshes[1].name=d[g],a=h.loadedAnimationGroups;for(let m=0;m<a.length;m++)a[m].name=`${d[g]}_${a[m].name}`;g++},l.onTasksDoneObservable.add(()=>{for(let h=0;h<s.animationGroups.length;h++)s.animationGroups[h].pause();e.pointerSelection.detach(),e.input.onControllerAddedObservable.add(h=>{let m=h.inputSource.handedness;console.log(o[m]);let b=o[m].parent.parent;o[m].isPickable=!1;for(let y of i)y.removeDragCollision();let u=(Object.keys(o).indexOf(m)-1)*2-1;o[m].rotation.y=Math.PI*u,o[m].rotation.z=0,o[m].rotation.x=-Math.PI/4,b.parent=h.grip||h.pointer})}),l.loadAsync().then(()=>{t(a)})})}function fe(s,e,i,a){let t,n=["A","B","C"];function r(o){for(let d of n){let l=s.getMeshByName(`pivot-Cylinder-${d}`);if(o.intersectsMesh(l,!1))return l}return!1}e.input.onControllerAddedObservable.add(o=>{o.onMotionControllerInitObservable.add(d=>{let l=d;l.handID=d.handedness;let g=new X(v.Zero(),v.Zero(),.25);const h=d.getComponentOfType("squeeze"),m=d.getComponentOfType("trigger");function b(u,y){l.lastPosition=null,clearInterval(y),console.log("Dropped test tube"),l.grabbed=!1,l.meshGrabbed=void 0,console.log("Current hand: ",l),console.log(u),console.log(a),u&&a.find(x=>{console.log(x,u);let p=u.name.split("-");return x.name==p[p.length-1]}).fadeAndRespawn(100)}[m,h].forEach(u=>{u.onButtonStateChangedObservable.add(y=>{let f=l.handID,x,p={left:"Fist",right:"Grip"},A=s.animationGroups.find((O,L)=>(console.log(L,f),O.name===`${f}_${p[f]}`));console.log(A._to),console.log(s.animationGroups[0],s.animationGroups[7]),A.goToFrame(y.value*(A._to-1)+1);let N=r(s.getMeshByName(l.handID));if(y.value>0&&(l.lastPosition=Object.assign({},g.origin)),y.value>0&&!l.grabbed){if(N){t=N,l.meshGrabbed=t,l.grabbed=!0,o.getWorldPointerRayToRef(g),l.lastPosition=Object.assign({},g.origin);let O=l.lastPosition,L=g.origin;L!=O&&(x=setInterval(()=>{let R=l.lastPosition;o.getWorldPointerRayToRef(g),R&&t&&t.moveWithCollisions(L.subtract(R)),!r(s.getMeshByName(f))&&t&&(console.log(f,t),b(t,x),t=null),l.lastPosition=Object.assign({},g.origin)},10))}}else(!y.value||!N)&&t&&(console.log(f,t),b(t,x),t=null)})})})})}function G(s){s.rotation.x=0,s.rotation.y=0,s.rotation.z=0}function pe(s,e){s.onBeforeRenderObservable.add(function(){let n=["A","B","C"];for(let r=0;r<n.length;r++){const o=s.getMeshByName(`pivot-Cylinder-${n[r]}`),d=s.getMeshByName("Table");if(d&&o){const l=d.getBoundingInfo().boundingBox;o.position.z=(l.centerWorld.z+l.minimumWorld.z)/2}}});let i=["A","B","C"],a=[];for(let n of i){const r=s.getMeshByName(`pivot-Cylinder-${n}`);a.push(r);let o=new C(`${n}-rotateAroundZ`,"rotation.z",120,C.ANIMATIONTYPE_FLOAT,C.ANIMATIONLOOPMODE_CONSTANT),d=B(r,M);const l=[];l.push({frame:0,value:Math.PI*2}),l.push({frame:60,value:4.62}),d.animations.push(o),o.setKeys(l);let g=new C(`${n}-resetRotateAroundZ`,"rotation.z",120,C.ANIMATIONTYPE_FLOAT,C.ANIMATIONLOOPMODE_CONSTANT);const h=[];h.push({frame:0,value:4.62}),h.push({frame:60,value:Math.PI*2}),d.animations.push(g),g.setKeys(h)}let t=!1;for(let n=0;n<i.length;n++){const r=s.getMeshByName(`pivot-Cylinder-${i[n]}`),o=r.getBehaviorByName("PointerDrag");let d=[];for(let h of a)h!=r&&d.push(h);let l=B(r,M),g=!1;o.onDragObservable.add(()=>{const h=B(r,M).getBehaviorByName("Highlight");let m=!1;for(let b=0;b<i.length;b++){if(n==b)continue;const u=s.getMeshByName(`pivot-Cylinder-${i[b]}`);if(G(r),G(u),r.intersectsMesh(u)){m=!0;let y=u.name.split("-")[2],x=`${r.name.split("-")[2]}to${y}`;if(e.tasks[e.currentState].label===x)e.tasks[e.currentState].next==="complete"?window.location.assign("."):e.currentState=e.tasks.indexOf(e.tasks.find(p=>p.label==e.tasks[e.currentState].next));else if(!t){t=!0;const p=new F("particles",500,s);p.particleTexture=new J("https://raw.githubusercontent.com/PatrickRyanMS/BabylonJStextures/master/FFV/smokeParticleTexture.png",s),p.minLifeTime=2,p.maxLifeTime=6,p.emitRate=10,p.gravity=new v(0,1.5,0),p.addSizeGradient(.3,.05,.05);const A=B(u,k);p.addColorGradient(1,ee.FromColor3(A.material.diffuseColor,1)),p.blendMode=F.BLENDMODE_STANDARD,p.emitter=u.position,p.start()}if(h){let p=B(u,M);h.highlightMesh(l),h.highlightMesh(p);let A=r.getAbsolutePosition()._x,N=u.getAbsolutePosition()._x;if(console.log("Current x: ",A,"Target x: ",N),N<A?(console.log("Left hit!"),l.rotation.y=Math.PI,u.rotation.y=l.rotation.y):(console.log("Right hit!"),l.rotation.y=0,u.rotation.y=l.rotation.y),!g){let O=l.getAnimationByName(`${i[n]}-rotateAroundZ`);g=!0,s.beginDirectAnimation(l,[O],0,60,!1,void 0,()=>{})}}break}else h.unhighlightMesh(B(u,M)),u.rotation.x=0,u.rotation.y=0,u.rotation.z=0}if(m==!1){h.unhighlightMesh(l);let b=l.getAnimationByName(`${i[n]}-resetRotateAroundZ`);g&&(g=!1,console.log(l,b,`${i[n]}-resetRotateAroundZ`),s.beginDirectAnimation(l,[b],0,60,!1,void 0,()=>{}))}}),o.onDragEndObservable.add(()=>{const h=B(r,M).getBehaviorByName("Highlight");for(let m of d){if(m==l)continue;let b=B(m,M);if(h.unhighlightMesh(l),h.unhighlightMesh(b),l.intersectsMesh(m)){let u=l.getAnimationByName(`${i[n]}-resetRotateAroundZ`);l.rotation.z==4.62&&s.beginDirectAnimation(l,[u],0,60,!1,void 0,()=>{})}}})}}var D;class be{constructor(e){c(this,"flying",!1);c(this,"active",!1);c(this,"camera");c(this,"mesh");c(this,"offset",.3);c(this,"animations");c(this,"returnPosition");c(this,"returnRotation");c(this,"onPointerDownObserver");c(this,"xrCamera");c(this,"attach",(e,i,a,t,n)=>{const r=e.getScene();if(this.mesh=e,!i&&(i=r.activeCamera,!i))throw new Error("The scene has no active camera, and no camera was provided.");this.camera=i,a||(a=this.mesh.position),t||(t=this.mesh.rotation),n&&(this.offset=n),this.returnPosition=a,this.returnRotation=t,this.onPointerDownObserver=r.onPointerObservable.add(this.clipboardClick)});c(this,"detach",()=>{this.mesh.getScene().onPointerObservable.remove(this.onPointerDownObserver)});c(this,"clipboardClick",(e={type:$.POINTERDOWN,pickInfo:{pickedMesh:this.mesh}})=>{var i;if(e.type===$.POINTERDOWN){const a=(i=e.pickInfo)==null?void 0:i.pickedMesh;if(a&&(a===this.mesh||a.isDescendantOf(this.mesh))&&!this.flying){const t=this.active?P/2:0,n=this.active?0:P/2;_(this,D).call(this),this.flying=!0,this.mesh.billboardMode==T.BILLBOARDMODE_ALL?this.mesh.billboardMode=T.BILLBOARDMODE_NONE:this.mesh.billboardMode=T.BILLBOARDMODE_ALL,this.mesh.getScene().beginDirectAnimation(this.mesh,this.animations,t,n,!1,void 0,()=>{this.flying=!1,this.active=!this.active})}}});c(this,"calculateTargetPositionWithOffset",e=>{if(this.xrCamera!==void 0&&this.xrCamera.state===te.IN_XR){const r=this.xrCamera.camera._position.subtract(this.returnPosition).scale(1-e/v.Distance(this.returnPosition,this.xrCamera.camera._position));return this.returnPosition.add(r)}const a=this.camera._position.subtract(this.returnPosition).scale(1-e/v.Distance(this.returnPosition,this.camera._position));return this.returnPosition.add(a)});c(this,"setClipboardUp",()=>new v(3.1468286,4.6617744,1.680752));z(this,D,()=>{const e=this.animations.find(({name:n})=>n==="translate"),i=this.animations.find(({name:n})=>n==="rotate"),a=[{frame:0,value:this.returnPosition},{frame:P/2,value:this.calculateTargetPositionWithOffset(this.offset)}],t=[{frame:0,value:this.returnRotation},{frame:P/2,value:this.setClipboardUp()}];e.setKeys(a),i.setKeys(t)});const i=new C("translate","position",P,C.ANIMATIONTYPE_VECTOR3),a=new C("rotate","rotation",P,C.ANIMATIONTYPE_VECTOR3);this.animations=[i,a],this.xrCamera=e}get name(){return"FlyToCamera"}init(){}}D=new WeakMap;console.log=()=>{};class ye{constructor(){c(this,"handAnimation");c(this,"sop");c(this,"models");c(this,"cylinders");c(this,"cylinderFilename");this.cylinders=[],this.cylinderFilename="TLLGraduatedCylinderWithLabel.glb",this.models=[{fileName:"NewLaboratoryUNFINISHED.glb",callback:e=>this.createRoom(e),label:"floor"},{fileName:"clipBoardWithPaperCompressedTexture.glb",callback:e=>ge(e[0])},{fileName:"Placard_Label.glb",callback:e=>I(e,1,"Placard-A")},{fileName:"Placard_Label.glb",callback:e=>I(e,2,"Placard-B")},{fileName:"Placard_Label.glb",callback:e=>I(e,3,"Placard-C")},{fileName:this.cylinderFilename,callback:e=>this.cylinders.push(new S(e[0],1,"A",new w(1,0,0))),label:"Cylinder-A"},{fileName:this.cylinderFilename,callback:e=>this.cylinders.push(new S(e[0],2,"B",new w(0,1,0))),label:"Cylinder-B"},{fileName:this.cylinderFilename,callback:e=>this.cylinders.push(new S(e[0],3,"C",new w(0,0,1))),label:"Cylinder-C"}].map(function(e){return Object.assign({},{fileName:"LabBench.glb",root:"./models/",callback:me,label:"NoLabel"},e)}),this.createScene().then(e=>{for(let i of["A","B","C"])Object.assign({},e.getMeshByName(`pivot-Cylinder-${i}`).position);this.processScene(e,this.cylinders)})}async processScene(e,i){let a=e.getCameraByName("camera"),t=e.getLightByName("light1"),n;a.speed=.16;let r=setInterval(()=>{t.intensity>=1?clearInterval(r):t.intensity+=.1},60);const o=["WallsandFloor","WallsAndFloor.001"],d=[];for(let g of o){console.log(g);const h=e.getMeshByName(g);h&&d.push(h)}let l={floorMeshes:d,inputOptions:{doNotLoadControllerMeshes:!0}};n=await e.createDefaultXRExperienceAsync(l),n.pointerSelection.displayLaserPointer=!1,n.pointerSelection.displaySelectionMesh=!1,ue(e,n,i).then(g=>{const h=e.getMeshByName("clipboard");if(n){const m=new be(n.baseExperience);h.addBehavior(m)}pe(e,ce),fe(e,n,g,i)})}createRoom(e){const i=["WallsandFloor","WallsAndFloor.001","Table","Roof","Countertop","Walls"];let a,t;for(let n of i){const r=e.find(o=>o.name===n);if(r&&(r.checkCollisions=!0,r.name==="Table")){const d=r.getBoundingInfo().boundingBox.center.x;a=r.getScene(),t=a.getCameraByName("camera"),t.position.x=d-.7}}}createScene(){return new Promise(e=>{const i=document.getElementById("canvas"),a=new ie(i,!0,{stencil:!0}),t=new ne(a);t.collisionsEnabled=!0,window.addEventListener("resize",function(){a.resize()});const n=new oe("camera",new v(0,1.84,-1.134),t);n.ellipsoid=new v(.4,.7,.4),n.attachControl(i,!0),n.applyGravity=!0,n.minZ=0,n.speed=0,n.checkCollisions=!0,n.keysUp.push(87),n.keysDown.push(83),n.keysLeft.push(65),n.keysRight.push(68);var r=new ae("light1",new v(1,1,0),t);r.intensity=0,Promise.all(this.models.map(o=>new Promise(d=>se.ImportMesh("",o.root,o.fileName,t,function(l){o.mesh=l,d(l)})))).then(()=>{let o=[];this.models.map(d=>{o.push(d.callback(d.mesh)),e(t)})}),window.addEventListener("keydown",o=>{o.shiftKey&&o.ctrlKey&&o.altKey&&o.keyCode===73&&(t.debugLayer.isVisible()?t.debugLayer.hide():t.debugLayer.show())}),a.runRenderLoop(()=>{t.render()})})}}new ye;
