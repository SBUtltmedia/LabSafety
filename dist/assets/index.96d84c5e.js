var oe=Object.defineProperty;var ae=(h,e,t)=>e in h?oe(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t;var c=(h,e,t)=>(ae(h,typeof e!="symbol"?e+"":e,t),t),re=(h,e,t)=>{if(!e.has(h))throw TypeError("Cannot "+t)};var U=(h,e,t)=>(re(h,e,"read from private field"),t?t.call(h):e.get(h)),G=(h,e,t)=>{if(e.has(h))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(h):e.set(h,t)};import{H as le,M as he,V as M,S as T,D as X,P as D,T as E,C as Q,a as O,b as ce,A as x,c as de,B as q,d as me,R as ge,e as Z,f as W,W as ue,g as K,h as fe,i as pe,j as be,E as ye,k as Ce,U as Me,l as xe,m as Ae}from"./vendor.945360d5.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();window.exports=window;class ve{constructor(e,t,i,n=0){c(this,"complete",!1);c(this,"title");c(this,"description");c(this,"failed",!1);c(this,"onFail");c(this,"onSuccess");c(this,"onCompletion");c(this,"currentState");c(this,"tasks");c(this,"resetSOP",()=>{this.currentState=0,this.failed=!1,this.complete=!1});this.title=e,this.description=t,this.tasks=i,this.currentState=n}}const Pe="",B=60,Ie=50,J=3,P="cylinder",N="liquid",Oe="placard",b=new ve("","",[{next:"CtoA",label:"BtoC"},{next:"complete",label:"CtoA"}]);function C(h,e){return h.getChildMeshes().find(t=>t.name===e)||null}function k(h){h.rotation.x=0,h.rotation.y=0,h.rotation.z=0}function ee(h){h.position.x=0,h.position.y=0,h.position.z=0}class V{constructor(e,t,i,n){c(this,"name");c(this,"position");c(this,"mesh");c(this,"dragCollision");c(this,"highlightLayer");c(this,"scene");c(this,"particleSystem");c(this,"currentColor");c(this,"originalColor");c(this,"startOpacity");console.log(e),this.name=i,this.currentColor=n,this.originalColor=n,this.startOpacity=.7;const s=e.getScene();this.scene=s,this.highlightLayer=new le("highlight-layer",s),this.highlightLayer.innerGlow=!0,this.highlightLayer.outerGlow=!1;const a=s.getMeshByName("Table");let o=he.CreateSphere(`pivot-Cylinder-${i}`,{segments:2,diameterX:.15,diameterY:.33,diameterZ:.2},e.getScene());if(o.visibility=0,e.name=i,e.parent=o,e.rotationQuaternion=null,e.getChildMeshes().forEach(p=>{switch(p.name){case"BeakerwOpacity":p.name=P,p.rotationQuaternion=null,p.rotation.z=2*Math.PI,p.isPickable=!1;break;case"BeakerLiquid":p.name=N,p.isPickable=!1;break}}),a){const p=a.getBoundingInfo().boundingBox,y=C(e,P).getBoundingInfo().boundingBox.maximum.y+1e-8;o.position.y=p.maximumWorld.y+y,o.position.x=(p.maximumWorld.x-p.minimumWorld.x)/J*t+p.minimumWorld.x-.3,o.position.z=(p.centerWorld.z+p.minimumWorld.z)/2,this.position={...o.position}}else o.position.x=-2+t,o.position.y=1.22,o.position.z=.5;o.checkCollisions=!0,o.ellipsoid=new M(.02,.16,.02),this.mesh=o;const d=C(e,N),m=new T("liquid-material");m.diffuseColor=n,d.material=m;const u=C(e,"Label"),l=C(e,"LabelBack");console.log("Label:",l);const g=new X("dynamic texture",256,s),f=new T("Mat",s);f.diffuseTexture=g,u.material=f,l.material=f;const r="bold 300px monospace";g.drawText(e.name.toUpperCase(),65,225,r,"black","white");let S=this.mesh.getChildMeshes().find(p=>p.name==="cylinder");this.mesh.animations=S.animations,console.log("Children: ",this.mesh.getChildMeshes());const A=new D("particles",500,this.scene);A.particleTexture=new E("https://raw.githubusercontent.com/PatrickRyanMS/BabylonJStextures/master/FFV/smokeParticleTexture.png",this.scene),A.minLifeTime=.5,A.maxLifeTime=.7,A.emitRate=100,A.gravity=new M(0,.5,0),A.minSize=.01,A.maxSize=.07,A.createPointEmitter(new M(0,0,0),new M(0,1,0)),A.addColorGradient(1,Q.FromColor3(d.material.diffuseColor,1)),A.blendMode=D.BLENDMODE_STANDARD,A.emitter=this.mesh.position,this.particleSystem=A,this.setOpacity(this.startOpacity),this.addDragCollision()}startParticles(){this.particleSystem.start()}highlight(e=!0){let t=C(this.mesh,P);e?(console.log("Adding mesh"),this.highlightLayer.hasMesh(t)||this.highlightLayer.addMesh(t,O.Green())):this.highlightLayer.hasMesh(t)&&this.highlightLayer.removeMesh(t)}addDragCollision(){let e=new ce({dragPlaneNormal:new M(0,0,1)});e.useObjectOrientationForDragging=!1,e.moveAttached=!1,e.onDragStartObservable.add(()=>{}),e.onDragObservable.add(t=>{this.mesh.moveWithCollisions(t.delta)}),e.onDragEndObservable.add(()=>{this.fadeAndRespawn()}),this.mesh.addBehavior(e),this.dragCollision=e}removeDragCollision(){this.mesh.removeBehavior(this.dragCollision)}fadeAndRespawn(e=Ie){setTimeout(()=>{this.mesh.isPickable=!1;let t=60;this.mesh.name.split("-")[0];let i=this.mesh.getScene(),n=this.mesh.getChildMeshes(),s=n.find(d=>d.name==="cylinder");n.find(d=>d.name==="liquid");const a=C(this.mesh,N);console.log("Visibility: ",a.visibility);let o=[{name:"Invisibility",startValue:a.visibility},{name:"Visibility",startValue:0}];o.forEach(d=>{d.init=new x(d.name,"visibility",120,x.ANIMATIONTYPE_FLOAT,x.ANIMATIONLOOPMODE_CONSTANT),d.init.setKeys([{frame:0,value:d.startValue},{frame:t,value:a.visibility-d.startValue}])});for(let d=0;d<n.length-1;++d){let m=n[d];i.beginDirectAnimation(m,[o[0].init],0,60,!1)}i.beginDirectAnimation(n[n.length-1],[o[0].init],0,60,!1,void 0,()=>{console.log(this.mesh,this.position),this.mesh.position.x=this.position._x,this.mesh.position.y=this.position._y,this.mesh.position.z=this.position._z,this.mesh.animations=s.animations;let d=C(this.mesh,P);k(this.mesh),k(d),ee(d);for(let m=0;m<n.length-1;++m){let u=n[m];i.beginDirectAnimation(u,[o[1].init],0,60,!1)}i.beginDirectAnimation(n[n.length-1],[o[1].init],0,60,!1,void 0,()=>{this.highlight(!1),this.mesh.isPickable=!0})})},e)}rotateAroundZ(){let e=this.mesh.getAnimationByName(`${this.name}-rotateAroundZ`);this.scene.beginDirectAnimation(C(this.mesh,P),[e],0,60,!1,void 0,()=>{})}resetAroundZ(){let e=this.mesh.getAnimationByName(`${this.name}-resetRotateAroundZ`);this.scene.beginDirectAnimation(C(this.mesh,P),[e],0,60,!1,void 0,()=>{})}setColor(e){const t=C(this.mesh,N),i=new T("liquid-material");i.diffuseColor=e,t.material=i,this.currentColor=e}setOpacity(e){const t=C(this.mesh,N);t.visibility=e}resetProperties(){this.setOpacity(this.startOpacity),this.setColor(this.originalColor)}}const we="Stony Brook University VR Laboratory",Be="Victor Ruben",Ne="VR Chemical Mixture Synthesis",Se="4/1/2022",Te="General: Properly mixing VR chemicals",Le="42",De="I",Ee=[{text:"HAZARD IDENTIFICATION test from JSON",sublistType:"a",sublist:[{text:"Improper mixing of chemicals can lead to explosive results!"}]},{text:"CHEMICAL HANDLING PROCEDURES",sublistType:"a",sublist:[{text:"When mixing these chemicals - always follow the correct sequence"},{text:"Pour chemical B into chemical C"},{text:"Then pour chemical mixture B+C into chemical A"}]},{text:"EMERGENCY PROCEDURES",sublistType:"a",sublist:[{text:"In the event of an improper mixture - use the fire extinguisher to put out the flames"},{text:"Evacuate the lab"},{text:"Call for emergency services"}]}],Y={facility:we,labDirector:Be,scope:Ne,lastRevision:Se,general:Te,sopNum:Le,listType:De,items:Ee};function ke(h){h.name="clipboard";const e=h.getScene(),t=e.getMeshByName("Table");if(t){const a=t.getBoundingInfo().boundingBox;h.position.y=a.maximumWorld.y+.003}h.rotationQuaternion=null,h.rotation=new M(0,Math.PI/4,0);const i=e.getMeshByName("pivot-Cylinder-A");i&&(h.position.x=i.position.x+.2,h.position.z=i.position.z+.5);function n(a){console.log("data: ",Y);let o=document.createElement("template");o.innerHTML=a;var d=de.compile(o.innerHTML),m=d(Y);return o.innerHTML=m,o.content}function s(a){const d="data:image/svg+xml;utf8,"+encodeURIComponent(a),m=E.LoadFromDataString("tex",d,e,void 0,void 0,void 0,E.LINEAR_LINEAR_MIPNEAREST);let u=new T("mat",e);u.diffuseTexture=m,m.uScale=1,m.vScale=-1,u.emissiveColor=O.White(),u.useAlphaFromDiffuseTexture=!0,m.hasAlpha=!0;let l=C(h,"Plane");l.material=u,console.log("Material set")}fetch(`${Pe}images/sopTemplate.svg`).then(a=>a.text()).then(a=>{console.log("fetched!");let o=n(a),d=o.getElementById("procedure-list");console.log(d);const u=new XMLSerializer().serializeToString(o);s(u)}).catch(console.error.bind(console))}function Re(h){var e=new q(O.FromHexString("#0984e3"));e.ignoreChildren=!0;var t=h[0],i=q.MakeNotPickableAndWrapInBoundingBox(t);e.attachedMesh=i,e.onScaleBoxDragObservable.add(()=>{console.log("scaleDrag")}),e.onScaleBoxDragEndObservable.add(()=>{const n=e.attachedMesh;if(n){const s=n.getHierarchyBoundingVectors(!0);console.log("size x:",s.max.x-s.min.x),console.log("size y:",s.max.y-s.min.y),console.log("size z:",s.max.z-s.min.z)}console.log("scaleEnd")}),e.onRotationSphereDragObservable.add(()=>{console.log("rotDrag")}),e.onRotationSphereDragEndObservable.add(()=>{console.log("rotEnd")})}function H(h,e,t){const i=h.find(l=>l.name==="__root__"),n=i.getScene();i.name=t;const s=h.find(l=>l.name==="Label"),a=h.find(l=>l.name==="Placard");a.name=Oe;const o=new X("dynamic texture",256,n);o.wAng=-Math.PI/2,o.uAng=Math.PI;const d=new T("Mat",n);d.diffuseTexture=o,s.material=d;const m="bold 220px monospace";o.drawText(i.name.split("-")[1].toUpperCase(),65,185,m,"black","white"),a.addChild(s),a.rotationQuaternion=null,a.rotation=new M(0,Math.PI/2,0);const u=n.getMeshByName("Table");if(u){const l=u.getBoundingInfo().boundingBox;i.position.y=l.maximumWorld.y+.003,i.position.x=(l.maximumWorld.x-l.minimumWorld.x)/J*e+l.minimumWorld.x-.2,i.position.z=(l.centerWorld.z+l.minimumWorld.z)/2+.2}}function _e(h,e,t){let i;return new Promise(n=>{const s="./models/";let a="";var o={};let d=["left","right"];const m=new me(h);d.forEach(l=>{m.addMeshTask(`load ${l} hand`,"",s,`${l}${a}.glb`)});let u=0;m.onTaskSuccess=l=>{o[d[u]]=l.loadedMeshes[1],l.loadedMeshes[1].name=d[u],i=l.loadedAnimationGroups;for(let g=0;g<i.length;g++)i[g].name=`${d[u]}_${i[g].name}`;u++},m.onTasksDoneObservable.add(()=>{for(let l=0;l<h.animationGroups.length;l++)h.animationGroups[l].pause();e.input.onControllerAddedObservable.add(l=>{let g=l.inputSource.handedness;console.log(o[g]);let f=o[g].parent.parent;o[g].isPickable=!1;for(let v of t)v.removeDragCollision();let r=(Object.keys(o).indexOf(g)-1)*2-1;o[g].rotation.y=Math.PI*r,o[g].rotation.z=0,o[g].rotation.x=-Math.PI/4,f.parent=l.grip||l.pointer})}),m.loadAsync().then(()=>{n(i)})})}class te{constructor(e,t,i){c(this,"cylinderInstances");c(this,"clipboard");c(this,"scene");c(this,"labels");c(this,"guiManager");this.labels=["A","B","C"],this.scene=e,this.cylinderInstances=t,this.guiManager=i}getCylinderInstanceFromMesh(e){let t=e.name.split("-")[2];console.log("Name: ",t);for(let i of this.cylinderInstances)if(console.log("Instance name: ",i.name),i.name==t)return i;return null}intersectHandCylinder(e){for(let t of this.labels){let i=this.scene.getMeshByName(`pivot-Cylinder-${t}`);if(e.intersectsMesh(i,!1))return i}return null}intersectCylinder(e){for(let t of this.labels){let i=this.scene.getMeshByName(`pivot-Cylinder-${t}`);if(i!=e&&e.intersectsMesh(i))return i}return null}highlightAndRotateCylinders(e,t,i){e.highlight(),t.highlight();let n=e.mesh.getAbsolutePosition()._x,s=t.mesh.getAbsolutePosition()._x;if(s<n?(console.log("Left hit!"),e.mesh.rotation.y=Math.PI,t.mesh.rotation.y=e.mesh.rotation.y):(console.log("Right hit!"),e.mesh.rotation.y=0,t.mesh.rotation.y=e.mesh.rotation.y),!i){i=!0;let a=e.mesh.getHierarchyBoundingVectors(),o=a.max.y-a.min.y,d=-.09,u=n-s,l=C(e.mesh,P);s<n?(console.log("Src pos: ",e.position.x),l.position.x=u+d,l.position.y=o-.2):(l.position.x=u-d,l.position.y=o-.2),e.rotateAroundZ()}return i}moveWithCollisions(e,t){e.moveWithCollisions(t)}addColors(e,t){let i=e.currentColor,n=t.currentColor;console.log(i,n);let s=new O((i.r+n.r)/2,(i.g+n.g)/2,(i.b+n.b)/2);t.setColor(s)}showFinishScreen(){this.guiManager.gameFinishPrompt.setVisible(!0)}}class ie extends te{constructor(t,i,n){super(t,i,n);c(this,"particleSystem")}resetCylinders(){this.particleSystem&&this.particleSystem.stop();let t=["A","B","C"];for(let i=0;i<t.length;i++){const n=this.scene.getMeshByName(`pivot-Cylinder-${t[i]}`),s=this.scene.getMeshByName("Table");if(s&&n){const a=s.getBoundingInfo().boundingBox;n.position.z=(a.centerWorld.z+a.minimumWorld.z)/2}super.getCylinderInstanceFromMesh(n).setOpacity(.85),super.getCylinderInstanceFromMesh(n).setColor(super.getCylinderInstanceFromMesh(n).originalColor)}super.showFinishScreen()}postSceneCylinder(){let t=["A","B","C"],i=[];for(let s of t){const a=this.scene.getMeshByName(`pivot-Cylinder-${s}`);i.push(a);let o=new x(`${s}-rotateAroundZ`,"rotation.z",120,x.ANIMATIONTYPE_FLOAT,x.ANIMATIONLOOPMODE_CONSTANT),d=C(a,P);const m=[];m.push({frame:0,value:Math.PI*2}),m.push({frame:60,value:4.62}),d.animations.push(o),o.setKeys(m);let u=new x(`${s}-resetRotateAroundZ`,"rotation.z",120,x.ANIMATIONTYPE_FLOAT,x.ANIMATIONLOOPMODE_CONSTANT);const l=[];l.push({frame:0,value:4.62}),l.push({frame:60,value:Math.PI*2}),d.animations.push(u),u.setKeys(l)}let n=!1;for(let s=0;s<t.length;s++){let a=!1;const o=this.scene.getMeshByName(`pivot-Cylinder-${t[s]}`);let d=super.getCylinderInstanceFromMesh(o);console.log("Dragging!");const m=o.getBehaviorByName("PointerDrag");console.log(m);let u=[];for(let f of i)f!=o&&u.push(f);let l=C(o,P),g=!1;m.onDragObservable.add(()=>{let f=!1;k(o);const r=super.intersectCylinder(o);if(r){let v=super.getCylinderInstanceFromMesh(r);console.log("Hit!"),f=!0;let S=r.name.split("-")[2],p=`${o.name.split("-")[2]}to${S}`;if(b.tasks[b.currentState].label===p)b.tasks[b.currentState].next==="complete"?(d.fadeAndRespawn(),b.resetSOP(),this.resetCylinders(),a=!0):b.currentState=b.tasks.indexOf(b.tasks.find(y=>y.label==b.tasks[b.currentState].next));else if(!n){n=!0;const y=new D("particles",500,this.scene);y.particleTexture=new E("https://raw.githubusercontent.com/PatrickRyanMS/BabylonJStextures/master/FFV/smokeParticleTexture.png",this.scene),y.minLifeTime=.5,y.maxLifeTime=.7,y.emitRate=100,y.gravity=new M(0,.5,0),y.minSize=.01,y.maxSize=.07,y.createPointEmitter(new M(0,0,0),new M(0,1,0));const w=C(r,N);y.addColorGradient(1,Q.FromColor3(w.material.diffuseColor,1)),y.blendMode=D.BLENDMODE_STANDARD,y.emitter=r.position,this.particleSystem=y,this.particleSystem.start()}let I=o.getAbsolutePosition()._x;r.getAbsolutePosition()._x<I?(l.rotation.y=Math.PI,r.rotation.y=l.rotation.y):(l.rotation.y=0,r.rotation.y=l.rotation.y),g||(g=super.highlightAndRotateCylinders(d,v,g),super.addColors(d,v),a&&(v.resetProperties(),a=!1))}else d.highlight(!1),k(o);f==!1&&(d.highlight(!1),g&&(l.position.x=0,l.position.y=0,g=!1,d.resetAroundZ()))}),m.onDragEndObservable.add(()=>{C(o,P).getBehaviorByName("Highlight");for(let f of u)f!=l&&(d.highlight(!1),super.getCylinderInstanceFromMesh(f).highlight(!1),l.intersectsMesh(f)&&(d.resetAroundZ(),l.position.x=0,l.position.y=0,g=!1))})}}}class j extends te{constructor(t,i,n,s){super(i,n,s);c(this,"handedness");c(this,"holdingInstance");c(this,"holdingMesh");c(this,"targetMesh");c(this,"targetMeshInstance");c(this,"motionController");c(this,"handMesh");c(this,"isVisible");this.handedness=t,this.handMesh=i.getMeshByName(this.handedness),this.isVisible=!0}getMotionController(){return this.motionController}setMotionController(t){this.motionController=t}dropped(t){this.motionController.lastPosition=null,clearInterval(t),this.motionController.grabbed=!1,this.motionController.meshGrabbed=void 0,console.log(this.holdingMesh),this.holdingMesh&&(this.holdingInstance.fadeAndRespawn(100),this.holdingMesh=null,this.holdingInstance=null,this.motionController.meshGrabbed=null)}updateSOPTask(t,i,n){console.log(this.scene);let s=`${t}to${i}`;if(b.tasks[b.currentState].label===s)if(b.tasks[b.currentState].next==="complete"){let a=new ie(this.scene,this.cylinderInstances,this.guiManager);for(let o of this.cylinderInstances)o.fadeAndRespawn(100);b.resetSOP(),this.disappearAnimation(!1),this.dropped(n),a.resetCylinders();for(let o of super.cylinderInstances)o.resetProperties();return!0}else return b.currentState=b.tasks.indexOf(b.tasks.find(a=>a.label==b.tasks[b.currentState].next)),!1}disappearAnimation(t=!0){console.log("DISAPPEAR: ",t);let i=60,n=[{name:"Invisibility",startValue:1},{name:"Visibility",startValue:0}];n.forEach(s=>{s.init=new x(s.name,"visibility",120,x.ANIMATIONTYPE_FLOAT,x.ANIMATIONLOOPMODE_CONSTANT),s.init.setKeys([{frame:0,value:s.startValue},{frame:i,value:1-s.startValue}])}),console.log(this.handMesh),t?(this.isVisible=!1,this.scene.beginDirectAnimation(this.handMesh,[n[0].init],0,60,!1)):(this.isVisible=!0,this.scene.beginDirectAnimation(this.handMesh,[n[1].init],0,60,!1))}}function Fe(h,e,t,i,n){let s=new j("right",h,i,n),a=new j("left",h,i,n),o=!1,d={right:s,left:a},m=!1;function u(l){let g=l.name.split("-")[2];console.log("Name: ",g);for(let f of i)if(console.log("Instance name: ",f.name),f.name==g)return f;return null}e.input.onControllerAddedObservable.add(l=>{l.onMotionControllerInitObservable.add(g=>{let f=g;f.handID=g.handedness;let r=d[f.handedness];r.getMotionController()||r.setMotionController(f),console.log(r);let v=new ge(M.Zero(),M.Zero(),.25);const S=g.getComponentOfType("squeeze");g.getComponentOfType("trigger"),[S].forEach(A=>{console.log(h.getMeshByName("left")),A.onButtonStateChangedObservable.add(p=>{let I,_={left:"Fist",right:"Grip"},y=h.animationGroups.find((F,z)=>F.name===`${r.motionController.handID}_${_[r.motionController.handID]}`);y.goToFrame(p.value*(y._to-1)+1);let w=r.intersectHandCylinder(h.getMeshByName(f.handID));if(console.log("Grabbed Cylinder: ",w),p.value>.5&&!r.motionController.grabbed){if(w){o=!1,r.holdingMesh=w,r.holdingInstance=u(r.holdingMesh),r.motionController.meshGrabbed=r.holdingMesh,r.motionController.grabbed=!0;let F=r.motionController.lastPosition,z=v.origin;z!=F&&(r.disappearAnimation(!0),I=setInterval(()=>{let $=r.motionController.lastPosition;if(l.getWorldPointerRayToRef(v),$&&r.holdingMesh&&r.moveWithCollisions(r.holdingMesh,z.subtract($)),!r.intersectHandCylinder(h.getMeshByName(r.motionController.handID))&&r.holdingMesh&&(r.targetMeshInstance&&r.targetMeshInstance.highlight(!1),r.dropped(I),r.motionController.grabbed=!1,r.handMesh.visibility=1,o=!0),r.holdingMesh){let L=r.intersectCylinder(r.holdingMesh);if(L){r.targetMesh=L,r.targetMeshInstance=u(L);let ne=L.name.split("-")[2],se=r.holdingMesh.name.split("-")[2];m||r.addColors(r.holdingInstance,r.targetMeshInstance),m=r.highlightAndRotateCylinders(r.holdingInstance,r.targetMeshInstance,m),o=r.updateSOPTask(se,ne,I)}else r.targetMeshInstance&&r.targetMeshInstance.highlight(!1),r.holdingInstance.highlight(!1),m&&(r.holdingInstance.resetAroundZ(),ee(C(r.holdingMesh,P)),m=!1)}o||(r.motionController.lastPosition=Object.assign({},v.origin),f.lastPosition=Object.assign({},v.origin))},10))}}else(!p.value||!w)&&r.holdingMesh&&(r.holdingInstance.highlight(!1),r.motionController.grabbed=!1,r.targetMeshInstance&&r.targetMeshInstance.highlight(!1),r.dropped(I),r.disappearAnimation(!1))})})})})}var R;class ze{constructor(e){c(this,"flying",!1);c(this,"active",!1);c(this,"camera");c(this,"mesh");c(this,"offset",.3);c(this,"animations");c(this,"returnPosition");c(this,"returnRotation");c(this,"onPointerDownObserver");c(this,"xrCamera");c(this,"attach",(e,t,i,n,s)=>{const a=e.getScene();if(this.mesh=e,!t&&(t=a.activeCamera,!t))throw new Error("The scene has no active camera, and no camera was provided.");this.camera=t,i||(i=this.mesh.position),n||(n=this.mesh.rotation),s&&(this.offset=s),this.returnPosition=i,this.returnRotation=n,this.onPointerDownObserver=a.onPointerObservable.add(this.clipboardClick)});c(this,"detach",()=>{this.mesh.getScene().onPointerObservable.remove(this.onPointerDownObserver)});c(this,"clipboardClick",(e={type:Z.POINTERDOWN,pickInfo:{pickedMesh:this.mesh}})=>{var t;if(e.type===Z.POINTERDOWN){console.log("Clipboard click");const i=(t=e.pickInfo)==null?void 0:t.pickedMesh;if(i&&(i===this.mesh||i.isDescendantOf(this.mesh))&&!this.flying||this.active){const n=this.active?B/2:0,s=this.active?0:B/2;U(this,R).call(this),this.flying=!0,this.mesh.billboardMode==W.BILLBOARDMODE_ALL?this.mesh.billboardMode=W.BILLBOARDMODE_NONE:this.mesh.billboardMode=W.BILLBOARDMODE_ALL,this.mesh.getScene().beginDirectAnimation(this.mesh,this.animations,n,s,!1,void 0,()=>{this.flying=!1,this.active=!this.active})}}});c(this,"calculateTargetPositionWithOffset",e=>{if(this.xrCamera!==void 0&&this.xrCamera.state===ue.IN_XR){const a=this.xrCamera.camera._position.subtract(this.returnPosition).scale(1-e/M.Distance(this.returnPosition,this.xrCamera.camera._position));return this.returnPosition.add(a)}const i=this.camera._position.subtract(this.returnPosition).scale(1-e/M.Distance(this.returnPosition,this.camera._position));return this.returnPosition.add(i)});c(this,"setClipboardUp",()=>new M(3.1468286,4.6617744,1.680752));G(this,R,()=>{const e=this.animations.find(({name:s})=>s==="translate"),t=this.animations.find(({name:s})=>s==="rotate"),i=[{frame:0,value:this.returnPosition},{frame:B/2,value:this.calculateTargetPositionWithOffset(this.offset)}],n=[{frame:0,value:this.returnRotation},{frame:B/2,value:this.setClipboardUp()}];e.setKeys(i),t.setKeys(n)});const t=new x("translate","position",B,x.ANIMATIONTYPE_VECTOR3),i=new x("rotate","rotation",B,x.ANIMATIONTYPE_VECTOR3);this.animations=[t,i],this.xrCamera=e}get name(){return"FlyToCamera"}init(){}}R=new WeakMap;class We{constructor(e,t,i){c(this,"rect");c(this,"text");c(this,"button");this.rect=e,this.text=t,this.button=i}setVisible(e=!0){this.rect.isVisible=e,this.text.isVisible=e,this.button.isVisible=e}}class Ve{constructor(){c(this,"advancedTexture");c(this,"welcomePrompt");c(this,"gameFinishPrompt");this.advancedTexture=K.CreateFullscreenUI("UI"),this.welcomePrompt=this.createPromptWithButton("Welcome to lab! You can find the tasks for today by clicking on the clipboard."),this.gameFinishPrompt=this.createPromptWithButton("Task successfully completed!")}createPromptWithButton(e){var t=K.CreateFullscreenUI("UI"),i=new fe;i.width=.25,i.height=.25,i.cornerRadius=20,i.color="cyan",i.thickness=4,i.background="white",t.addControl(i);var n=new pe;n.text=e,n.color="black",n.fontSize="17px",n.resizeToFit=!0,n.textWrapping=!0,n.paddingBottomInPixels=40,n.paddingLeftInPixels=15,n.paddingRightInPixels=15,i.addControl(n);var s=be.CreateSimpleButton("but1","Click to dismiss");s.width="150px",s.height="40px",s.color="black",s.cornerRadius=20,s.background="white",s.topInPixels=40;let a=new We(i,n,s);return a.setVisible(!1),a.button.onPointerUpObservable.add(function(){a.setVisible(!1)}),a.button.onPointerEnterObservable.add(()=>{s.background="grey"}),a.button.onPointerOutObservable.add(()=>{s.background="white"}),t.addControl(a.button),i.addControl(s),a}}console.log=()=>{};class He{constructor(){c(this,"handAnimation");c(this,"sop");c(this,"models");c(this,"cylinders");c(this,"guiManager");this.cylinders=[];let e="TLLGraduatedCylinderNewLabel.glb";this.models=[{fileName:"NewLaboratoryUNFINISHED.glb",callback:t=>this.createRoom(t),label:"floor"},{fileName:"clipBoardWithPaperCompressedTextureNew.glb",callback:t=>ke(t[0])},{fileName:"Placard_Label.glb",callback:t=>H(t,1,"Placard-A")},{fileName:"Placard_Label.glb",callback:t=>H(t,2,"Placard-B")},{fileName:"Placard_Label.glb",callback:t=>H(t,3,"Placard-C")},{fileName:e,callback:t=>this.cylinders.push(new V(t[0],1,"A",new O(1,0,0))),label:"Cylinder-A"},{fileName:e,callback:t=>this.cylinders.push(new V(t[0],2,"B",new O(0,1,0))),label:"Cylinder-B"},{fileName:e,callback:t=>this.cylinders.push(new V(t[0],3,"C",new O(0,0,1))),label:"Cylinder-C"}].map(function(t){return Object.assign({},{fileName:"LabBench.glb",root:"./models/",callback:Re,label:"NoLabel"},t)}),this.createScene().then(t=>{this.guiManager=new Ve,this.guiManager.welcomePrompt.setVisible(!0);for(let i of["A","B","C"])Object.assign({},t.getMeshByName(`pivot-Cylinder-${i}`).position);this.processScene(t,this.cylinders,this.guiManager)})}async processScene(e,t,i){let n=e.getCameraByName("camera"),s=e.getLightByName("light1"),a;n.speed=.16;let o=setInterval(()=>{s.intensity>=1?clearInterval(o):s.intensity+=.1},60);const d=["WallsandFloor","WallsAndFloor.001"],m=[];for(let l of d){console.log(l);const g=e.getMeshByName(l);g&&m.push(g)}let u={floorMeshes:m,inputOptions:{doNotLoadControllerMeshes:!0}};a=await e.createDefaultXRExperienceAsync(u),a.pointerSelection.displayLaserPointer=!1,a.pointerSelection.displaySelectionMesh=!1,_e(e,a,t).then(l=>{if(console.log("add webxr"),a){const f=new ze(a.baseExperience);e.getMeshByName("clipboard").addBehavior(f)}new ie(e,t,i).postSceneCylinder(),Fe(e,a,l,t,i)})}createRoom(e){const t=["WallsandFloor","WallsAndFloor.001","Table","Roof","Countertop","Walls"];let i,n;for(let s of t){const a=e.find(o=>o.name===s);if(a&&(a.checkCollisions=!0,a.name==="Table")){const d=a.getBoundingInfo().boundingBox.center.x;i=a.getScene(),n=i.getCameraByName("camera"),n.position.x=d-.7}}}createScene(){return new Promise(e=>{const t=document.getElementById("canvas"),i=new ye(t,!0,{stencil:!0}),n=new Ce(i);n.collisionsEnabled=!0,window.addEventListener("resize",function(){i.resize()});const s=new Me("camera",new M(0,1.84,-1.134),n);s.ellipsoid=new M(.4,.7,.4),s.attachControl(t,!0),s.applyGravity=!0,s.minZ=0,s.speed=0,s.checkCollisions=!0,s.keysUp.push(87),s.keysDown.push(83),s.keysLeft.push(65),s.keysRight.push(68);var a=new xe("light1",new M(1,1,0),n);a.intensity=0,Promise.all(this.models.map(o=>new Promise(d=>Ae.ImportMesh("",o.root,o.fileName,n,function(m){o.mesh=m,d(m)})))).then(()=>{let o=[];this.models.map(d=>{o.push(d.callback(d.mesh)),e(n)})}),window.addEventListener("keydown",o=>{o.shiftKey&&o.ctrlKey&&o.altKey&&o.keyCode===73&&(n.debugLayer.isVisible()?n.debugLayer.hide():n.debugLayer.show())}),i.runRenderLoop(()=>{n.render()})})}}new He;
