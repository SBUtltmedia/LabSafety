import{B as ve,V as k,A as le,E as N,C as ce,a as _,b as ye,c as d,M as Ce,d as D,R as Se,T as Ie,e as Pe,O as C,W as w,H as de,f as q,g as m,h as Oe,i as Te,P as te,j as F,S as we,k as Ee,l as E,F as ke,m as Me,n as Re,o as Ae,p as S,D as Q,q as x,r as z,G as ie,s as se,t as Be,u as ue,v as xe,w as Le,x as Ne,U as _e,y as W,z as Fe}from"./vendor-YUaPsxbp.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();window.exports=window;class j extends ve{SWIPE_SENSIBILITY=.5;JOYSTICK_COLOR="LightGray";JOYSTICK_TOUCH_AREA_HORIZONTAL_SCREEN_SHARE=.5;JOYSTICK_CIRCLE_SIZE_VERTICAL_SCREEN_SHARE=.1;JOYSTICK_PUCK_SIZE_VERTICAL_SCREEN_SHARE=.05;JOYSTICK_OUTER_CIRCLE_THICKNESS_RATIO=.01;JOYSTICK_INNER_CIRCLE_THICKNESS_RATIO=.04;JOYSTICK_PUCK_THICKNESS_RATIO=.01;camera;joystickDelta=k.Zero();screenSize;ui;joystickPointerId;joystickButtonDownPos;joystickButtonDownPosOffset;joystickContainer;joystickOuterCirce;joystickInnerCircle;joystickPuck;joystickCircleRadius;joystickPuckRadius;getClassName=()=>this.constructor.name;getSimpleName=()=>"joystick";attachControl(e){super.attachControl(e),this.screenSize=j.getScreenSize(),this.ui=le.CreateFullscreenUI("UI"),this.prepareImages(),N.LastCreatedEngine.onResizeObservable.add(this.resize)}prepareImages(){this.joystickCircleRadius=this.screenSize.y*this.JOYSTICK_CIRCLE_SIZE_VERTICAL_SCREEN_SHARE,this.joystickPuckRadius=this.screenSize.y*this.JOYSTICK_PUCK_SIZE_VERTICAL_SCREEN_SHARE,this.joystickContainer=new ce("virtual_joystick");let e=this.joystickCircleRadius*2+this.joystickPuckRadius*2+1;this.joystickContainer.widthInPixels=e,this.joystickContainer.heightInPixels=e,this.joystickContainer.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_LEFT,this.joystickContainer.verticalAlignment=_.VERTICAL_ALIGNMENT_TOP,this.joystickOuterCirce=this.prepareJoystickCircle(this.joystickCircleRadius,e*this.JOYSTICK_OUTER_CIRCLE_THICKNESS_RATIO),this.joystickInnerCircle=this.prepareJoystickCircle(this.joystickPuckRadius,e*this.JOYSTICK_INNER_CIRCLE_THICKNESS_RATIO),this.joystickPuck=this.prepareJoystickCircle(this.joystickPuckRadius,e*this.JOYSTICK_PUCK_THICKNESS_RATIO),this.joystickContainer.addControl(this.joystickOuterCirce),this.joystickContainer.addControl(this.joystickInnerCircle),this.joystickContainer.addControl(this.joystickPuck),this.joystickContainer.isVisible=!1,this.ui.addControl(this.joystickContainer)}prepareJoystickCircle(e,t){let s=new ye;return s.widthInPixels=e*2,s.heightInPixels=e*2,s.thickness=t,s.color=this.JOYSTICK_COLOR,s.horizontalAlignment=_.HORIZONTAL_ALIGNMENT_CENTER,s.verticalAlignment=_.VERTICAL_ALIGNMENT_CENTER,s}detachControl(){this.disposeImages(),this.ui.dispose(),N.LastCreatedEngine.onResizeObservable.removeCallback(this.resize),super.detachControl()}disposeImages(){this.joystickContainer.dispose(),this.joystickInnerCircle.dispose(),this.joystickOuterCirce.dispose(),this.joystickPuck.dispose()}resize=()=>{this.screenSize=j.getScreenSize(),this.disposeImages(),this.prepareImages()};static getScreenSize(){let e=N.LastCreatedEngine;return new k(e.getRenderWidth(),e.getRenderHeight())}checkInputs(){let e=new d(this.joystickDelta.x,0,-this.joystickDelta.y);e.scaleInPlace(N.LastCreatedEngine.getDeltaTime()/1e3),this.camera.cameraDirection.addInPlace(d.TransformCoordinates(e,Ce.RotationY(this.camera.rotation.y)))}onTouch(e,t,s){e.pointerId===this.joystickPointerId?this.onTouchJoystick(new k(e.x,e.y).subtractInPlace(this.joystickButtonDownPosOffset)):this.onTouchSwipe(new k(t,s))}onTouchJoystick(e){const t=e.subtract(this.joystickButtonDownPos);t.length()>this.joystickCircleRadius&&t.scaleInPlace(this.joystickCircleRadius/t.length()),this.joystickPuck.left=t.x,this.joystickPuck.top=t.y,this.joystickDelta=t.scaleInPlace(this.camera.speed/this.joystickCircleRadius)}onTouchSwipe(e){let t=1;this.camera.getScene().useRightHandedSystem&&(t*=-1),this.camera.parent&&this.camera.parent._getWorldMatrixDeterminant()<0&&(t*=-1),this.camera.cameraRotation.y+=t*e.x/this.screenSize.x*this.SWIPE_SENSIBILITY,this.camera.cameraRotation.x+=e.y/this.screenSize.x*this.SWIPE_SENSIBILITY}onButtonDown(e){e.offsetX<this.screenSize.x*this.JOYSTICK_TOUCH_AREA_HORIZONTAL_SCREEN_SHARE&&this.onButtonDownJoystick(e)}onButtonDownJoystick(e){let t=new k(e.offsetX,e.offsetY);this.joystickPointerId=e.pointerId,this.joystickButtonDownPos=t,this.joystickButtonDownPosOffset=new k(e.clientX-t.x,e.clientY-t.y),this.joystickContainer.left=t.x-this.joystickContainer.widthInPixels/2,this.joystickContainer.top=t.y-this.joystickContainer.heightInPixels/2,this.joystickContainer.isVisible=!0}onButtonUp(e){e.pointerId===this.joystickPointerId&&this.onButtonUpJoystick()}onButtonUpJoystick(){this.joystickPointerId=null,this.joystickDelta.scaleInPlace(0),this.joystickContainer.isVisible=!1}}const De=new d(0,1,-1.134),je=new d(.4,.7,.4),Ge=.16;function Ve(i){i.ellipsoid=je,i.applyGravity=!0,i.minZ=0,i.speed=Ge,i.checkCollisions=!0,i.needMoveForGravity=!1}class ze{rect;text;button;constructor(e,t,s){this.rect=e,this.text=t,this.button=s}setVisible(e=!0){this.rect.isVisible=e,this.text.isVisible=e,this.button.isVisible=e}}class U{advancedTexture;welcomePrompt;gameFinishPrompt;camera;screen;scene;constructor(e){this.scene=e,this.camera=e.activeCamera}createPromptWithButton(e,t=null,...s){this.screen=D.CreatePlane("Start",{size:1}),this.screen.parent=this.camera,this.screen.position=new d(0,0,.5),this.advancedTexture=le.CreateForMesh(this.screen);let n=new ce("container");var a=new Se;a.width=.5,a.height=.2,a.color="cyan",a.thickness=4,a.background="white",n.addControl(a);var o=new Ie;o.text=e,o.color="black",o.fontSize="17px",o.resizeToFit=!0,o.textWrapping=!0,o.paddingBottomInPixels=40,o.paddingLeftInPixels=15,o.paddingRightInPixels=15,a.addControl(o);var r=Pe.CreateSimpleButton("but1","Click to dismiss");r.width="150px",r.height="40px",r.color="black",r.cornerRadius=20,r.background="white",r.topInPixels=40;let h=new ze(a,o,r),l=this.scene.getMeshByName("Start");function c(){n.dispose(),l.dispose(),t&&t(...s)}return h.button.onPointerUpObservable.add(function(){c()}),h.button.onPointerEnterObservable.add(()=>{r.background="grey"}),h.button.onPointerOutObservable.add(()=>{r.background="white"}),n.addControl(h.button),n.addControl(r),this.advancedTexture.addControl(n),h}}class Y{static createWelcomeScreen(e){new U(e).createPromptWithButton("Welcome to the game. Please click on the clipboard on the table to get started.").setVisible(!0)}static createSuccessScreen(e,t=null,...s){new U(e).createPromptWithButton("Congratulations! You have completed the SOP",t,...s).setVisible(!0)}static createFailureScreen(e,t=null,...s){new U(e).createPromptWithButton("Oops! You mixed the wrong chemicals which resulted in a fire",t,...s).setVisible(!0)}}function A(...i){}var fe=(i=>(i[i.DESKTOP=0]="DESKTOP",i[i.XR=1]="XR",i[i.MOBILE=2]="MOBILE",i[i.LOADING=3]="LOADING",i))(fe||{}),g=(i=>(i[i.GRAB=0]="GRAB",i[i.DROP=1]="DROP",i))(g||{}),P=(i=>(i[i.ACTIVE=0]="ACTIVE",i[i.INACTIVE=1]="INACTIVE",i))(P||{});const Ue=3,He=.005;class ee{onGrabStateChangedObservable=new C;onActivationStateChangedObservable=new C;#e;#t;modeSelectorMap={0:{},1:{},3:{}};hasDefaultSelector=!1;#a=[];interactionMode=3;interactableMeshes=[];xrExperience;constructor(e,t){this.#e=e,t?(this.xrExperience=t,this.xrExperience.input.controllers.forEach(this.#i),this.xrExperience.input.onControllerAddedObservable.add(this.#i),this.xrExperience.baseExperience.state===w.NOT_IN_XR?(this.#l(0),this.hasDefaultSelector||this.configureDesktopInteraction(this.#e.activeCamera)):this.xrExperience.baseExperience.state===w.IN_XR?this.interactionMode=1:this.interactionMode=3,this.xrExperience.baseExperience.onStateChangedObservable.add(s=>{s===w.NOT_IN_XR?(this.#l(0),this.hasDefaultSelector||this.configureDesktopInteraction(this.#e.activeCamera)):s===w.IN_XR?this.#l(1):this.#l(3)})):this.#l(0),this.#t=new de("interaction-highlight-layer"),this.#e.onBeforeRenderObservable.add(()=>{this.#a.splice(0,this.#a.length);const s=this.getActiveSelectors(),n=s.filter(({grabbedMesh:h})=>!!h).map(({grabbedMesh:h})=>h),a=s.filter(({grabbedMesh:h})=>!h),o=this.interactableMeshes.filter(h=>!n.includes(h)),r={};for(const h of a){const l=[];for(const c of o)h.grabber.intersectsMesh(c,!0)&&l.push(c);h.targetMesh=this.#c(h.grabber,l),h.targetMesh&&(r[h.targetMesh.uniqueId]=h.targetMesh)}this.#a.push(...Object.values(r)),this.#t.removeAllMeshes();for(const h of this.#a)h instanceof q&&this.#t.addMesh(h,m.Gray())})}#i=e=>{e.motionController&&this.#s(e.motionController,e.pointer.uniqueId),e.onMotionControllerInitObservable.add(t=>{this.#s(t,e.pointer.uniqueId)})};#s=(e,t)=>{const s=e.getComponentOfType("squeeze");s&&s.onButtonStateChangedObservable.add(()=>{s.changes.pressed&&this.#n(s.pressed,t)});const n=e.getMainComponent();n&&n.onButtonStateChangedObservable.add(()=>{n.changes.pressed&&this.#o(n.pressed,t)})};#n=(e,t)=>{const s=this.modeSelectorMap[this.interactionMode][t];e?s.targetMesh&&(s.grabbedMesh=s.targetMesh,s.targetMesh=null,this.#r(s.grabbedMesh,{anchor:s.anchor,grabber:s.grabber,state:0})):s.grabbedMesh&&(this.#r(s.grabbedMesh,{anchor:s.anchor,grabber:s.grabber,state:1}),s.grabbedMesh=null)};#o=(e,t)=>{const{anchor:s,grabber:n,grabbedMesh:a}=this.modeSelectorMap[this.interactionMode][t];a&&(e?this.#h(a,{anchor:s,grabber:n,state:0}):this.#h(a,{anchor:s,grabber:n,state:1}))};#r=(e,t)=>{if(e.isDisposed()){for(const n in this.modeSelectorMap)for(const a of Object.values(this.modeSelectorMap[n]))a.grabbedMesh===e&&(a.grabbedMesh=null);return}const s=e.getBehaviorByName("Interactable");if(!s)throw new Error("InteractionManager: grabbed mesh must have InteractableBehavior.");this.onGrabStateChangedObservable.notifyObserver(s.grabStateObserver,t)};#h=(e,t)=>{if(e.isDisposed())return;const s=e.getBehaviorByName("Interactable");if(!s)throw new Error("InteractionManager: activated mesh must have InteractableBehavior.");this.onActivationStateChangedObservable.notifyObserver(s.activationStateObserver,t,e.uniqueId)};#l=e=>{const t=this.getActiveSelectors();for(const s of t)this.#r(s.grabbedMesh,{anchor:s.anchor,grabber:s.grabber,state:1}),s.grabbedMesh=null;this.interactionMode=e};addSelector=(e,t,s)=>{const n={anchor:e,grabber:t,grabbedMesh:null,targetMesh:null};for(const a of s)this.modeSelectorMap[a][e.uniqueId]=n};configureDesktopInteraction=e=>{const t=Oe("default-grabber",{height:Ue,diameter:He});t.isVisible=!1,t.isPickable=!1,t.setParent(e),t.position.setAll(0),t.rotation.copyFromFloats(Math.PI/2,0,0);const s=new Te("default-anchor");s.isPickable=!1,s.setParent(e),s.position.copyFrom(d.Forward()),this.addSelector(s,t,[0]),this.hasDefaultSelector=!0,this.#e.onPointerObservable.add(n=>{n.event.inputIndex===te.LeftClick?n.type===F.POINTERDOWN?this.#n(!0,s.uniqueId):n.type===F.POINTERUP&&this.#n(!1,s.uniqueId):n.event.inputIndex===te.RightClick&&(n.type===F.POINTERDOWN?this.#o(!0,s.uniqueId):n.type===F.POINTERUP&&this.#o(!1,s.uniqueId))})};getActiveSelectors=()=>Object.values(Object.values(this.modeSelectorMap[this.interactionMode]));#c=(e,t)=>ee.#d(e,t,this.interactionMode);static#d=(e,t,s)=>{let n=null,a=Number.POSITIVE_INFINITY;switch(s){case 0:case 2:case 1:for(const o of t){const r=d.Distance(e.getAbsolutePosition(),o.getAbsolutePosition());r<a&&(n=o,a=r)}break}return n}}const Ke=["room","placard","cylinder","clipboard","fire-extinguisher"];function be(i=Ke){return Promise.all(i.map(e=>we.ImportMeshAsync("","./models/",`${e}.glb`).then(t=>{const s=t.meshes.find(n=>n.id==="__root__");return s.id=e,s.name=e,t})))}function ge(i){const t=i.getScene().meshes.find(s=>s.name==="Table");if(t){const s=t.getBoundingInfo().boundingBox;i.position.x=s.center.x-.5,i.position.y=s.center.y*2+.46,i.position.z=-3}else i.position=d.Zero()}function ae(i,e){return i.id<e.id?-1:i.id>e.id?1:0}function $e(i){const e=i.filter(o=>o.id.split("-").length===2&&o.id.split("-")[0]==="cylinder").sort(ae),t=i.filter(o=>o.name.split("-")[0]==="placard"&&!o.name.includes("placard-base")).sort(ae),s=i.find(o=>o.id==="clipboard"),n=i.find(o=>o.name==="Table"),a=i.find(o=>o.id==="fire-extinguisher");if(n){const o=n.getBoundingInfo().boundingBox;e.forEach((r,h)=>{const l=r.getBoundingInfo().boundingBox,c=r.position.y-l.minimum.y;r.position.copyFromFloats(o.minimum.x+(h+1)*(o.maximum.x-o.minimum.x)/(e.length+2),o.maximum.y+c,(2*o.minimum.z+o.center.z)/3),r.rotationQuaternion=null,r.rotation.copyFromFloats(Math.PI,0,0)}),t.forEach((r,h)=>{const c=r.getChildMeshes().find(p=>p.name==="placard-base").getBoundingInfo().boundingBox,f=r.position.y-c.minimum.y;r.position.y=o.maximum.y+f,r.position.x=o.minimum.x+(h+1)*(o.maximum.x-o.minimum.x)/(t.length+2)+.2,r.position.z=(2*o.minimum.z+o.center.z)/3+.2,r.rotationQuaternion=null,r.rotation.copyFromFloats(0,Math.PI/2,0)}),s.position.copyFromFloats(e[0].position.x+.5,o.maximum.y,e[0].position.z+.3),s.rotationQuaternion=null,s.rotation.copyFromFloats(0,-Math.PI/2,Math.PI),a.position.copyFromFloats(3.73,1.77,-2.51),a.rotationQuaternion=null,a.rotation.copyFromFloats(0,0,Math.PI)}}const G="./",qe=`${G}sound/mi_explosion_03_hpx.mp3`,We=`${G}sound/ding-idea-40142.mp3`,Ye=`${G}sound/success.mp3`,Je=`${G}images/sopTemplate.svg`;var O=(i=>(i[i.SUCCESSFUL=0]="SUCCESSFUL",i[i.FAILURE=1]="FAILURE",i[i.RESET=2]="RESET",i))(O||{});class J{name;description;#e;optional;subtasks;subtaskObservers;onTaskStateChangeObservable;constructor(e,t,s,n=!1){if(this.name=e,this.description=t,this.#e=2,this.optional=n,s.some(a=>a.length===0))throw new Error(`Task ${this.name}: subtask partition must not be empty.`);this.subtasks=s,this.onTaskStateChangeObservable=new C,this.subtaskObservers=this.subtasks.map(a=>a.map((o,r)=>{const h=o.onTaskStateChangeObservable.add((l,c)=>{switch(l){case 1:o.optional||this.fail();break;case 0:if(r!==0&&a[r-1].status!==0){c.skipNextObservers=!0;break}this.subtasks.every(p=>p.at(-1).status===0)&&this.#t();break}});return o.onTaskStateChangeObservable.makeObserverTopPriority(h),h}))}fail=()=>{if(this.#e!==2)throw new Error(`Attempted to fail a Task (${this.name}) which has already succeeded or failed.`);if(this.onTaskStateChangeObservable.notifyObservers(1))A(`Failing Task ${this.name}`),this.#e=1;else throw new Error(`Task ${this.name}: An observer skipped following observers.`)};succeed=()=>{if(this.subtasks.length)throw new Error(`Task ${this.name} has subtasks and cannot be manually succeeded.`);this.#t()};#t=()=>{if(this.#e!==2)throw new Error(`Attempted to succeed a Task (${this.name}) which has already succeeded or failed.`);this.#e=0,this.onTaskStateChangeObservable.notifyObservers(this.#e)?A(`Succeeding Task ${this.name}`):(this.#e=2,this.fail())};reset=()=>{this.subtasks.forEach(e=>{e.forEach(t=>t.reset())}),this.#e=2,this.onTaskStateChangeObservable.notifyObservers(this.#e)};get failed(){return this.#e===1}get successful(){return this.#e===0}get status(){return this.#e}}const Xe={[O.SUCCESSFUL]:"correct",[O.FAILURE]:"incorrect",[O.RESET]:"empty"};class Ze{templateString;data;basicTasks;rootTask;#e;mesh;#t;#a;constructor(e,t,s,n){this.templateString=e,this.#t=Ee.compile(this.templateString),this.data=t,this.rootTask=s,this.basicTasks=n,this.#e=[],this.#a=0}get name(){return"UpdateClipboard"}init(){}#i=e=>this.#s.find(t=>t.taskName===e)||null;get#s(){return this.data.items[1].sublist}attach=e=>{this.mesh=e,this.#n(),this.#e.push(...this.basicTasks.map(t=>t.onTaskStateChangeObservable.add(s=>{const n=this.#i(t.name);n.indicator=Xe[s],this.#n()}))),this.#e.push(this.rootTask.onTaskStateChangeObservable.add(t=>{}))};detach=()=>{for(let e of this.#e)e.remove()};#n=()=>{const e=document.createElement("template"),t=this.#t(this.data);e.innerHTML=t;const n=new XMLSerializer().serializeToString(e.content),a="data:image/svg+xml;utf8,"+encodeURIComponent(n),o=E.LoadFromDataString(`clipboard-texture-${this.#a++}`,a,this.mesh.getScene(),void 0,void 0,void 0,E.LINEAR_LINEAR_MIPNEAREST,()=>{o.uScale=1,o.vScale=-1,o.hasAlpha=!0,this.#o(o)})};#o=e=>{const t=this.mesh.material;t.diffuseTexture!==e&&(t.diffuseTexture&&t.diffuseTexture.dispose(),t.diffuseTexture=e)}}class Qe{mesh;extinguished=!1;onFireObservable=new C;constructor(){}get name(){return"Fire"}init(){}attach=e=>{this.mesh=e};extinguish=()=>{this.extinguished=!0,this.onFireObservable.notifyObservers(!1),this.mesh.isVisible=!1};detach=()=>{}}function et(){const i=new ke("fire");i.diffuseTexture=new E("images/fire.png"),i.distortionTexture=new E("images/distortion.png"),i.opacityTexture=new E("images/candleopacity.png"),i.speed=5;const e=new Me("spotlight",new d(2,2,2),new d(-1,-2,-1),3,1),t=new Re(10240,e);t.usePercentageCloserFiltering=!0,t.bias=100,t.transparencyShadow=!0;const s=D.CreatePlane("fire-plane",{width:4,height:3});s.receiveShadows=!0,s.position.copyFromFloats(-4.1,0,-1.6),s.rotationQuaternion=null,s.rotation.copyFromFloats(0,-Math.PI/2,0),s.material=i,s.material.shadowDepthWrapper=new Ae(s.material),t.getShadowMap().renderList.push(s);const n=new Qe;return s.addBehavior(n),s}const B={sop:null,taskList:null,json:null};class tt{mesh;constructor(){}get name(){return"Pourable"}init(){}attach=e=>{this.mesh=e};detach=()=>{};getPouringPosition=e=>{if(e.x<this.mesh.absolutePosition.x){const t=new d(-.2,.3,0);return t.addInPlace(this.mesh.absolutePosition),t}else{const t=new d(.2,.3,0);return t.addInPlace(this.mesh.absolutePosition),t}}}class it{highlightLayer;mesh;otherMesh;color;constructor(e){this.highlightLayer=new de("highlight-layer"),this.highlightLayer.innerGlow=!0,this.highlightLayer.outerGlow=!1,this.color=e}get name(){return"Highlight"}init(){}attach=e=>{this.mesh=e};detach=()=>{this.unhighlightAll()};highlightSelf=()=>{this.highlightLayer.hasMesh(this.mesh)||this.highlightLayer.addMesh(this.mesh,this.color)};highlightOther=e=>{this.highlightLayer.hasMesh(e)||(this.otherMesh=e,this.highlightLayer.addMesh(this.otherMesh,this.color))};unhighlightSelf=()=>{this.highlightLayer.hasMesh(this.mesh)&&this.highlightLayer.removeMesh(this.mesh)};unhighlightOther=()=>{this.otherMesh&&this.highlightLayer.hasMesh(this.otherMesh)&&this.highlightLayer.removeMesh(this.otherMesh)};unhighlightAll=()=>{this.highlightLayer.hasMesh(this.mesh)&&this.highlightLayer.removeMesh(this.mesh),this.otherMesh&&this.highlightLayer.hasMesh(this.otherMesh)&&this.highlightLayer.removeMesh(this.otherMesh)}}class V{#e;interactionManager;#t=null;#a=null;onGrabStateChangedObservable=new C;onActivationStateChangedObservable=new C;defaultPosition;defaultRotation;hideGrabber=!0;#i;#s=!1;#n;#o=!1;#r=null;#h=null;#l=null;#c=!0;constructor(e,t){this.interactionManager=e,this.#n=!!t?.activatable,this.#i=t?.moveAttached!==!1,this.defaultPosition=t?.defaultPosition||d.Zero(),this.defaultRotation=t?.defaultRotation||d.Zero()}get name(){return"Interactable"}set activatable(e){!e&&this.#o&&this.#u(),this.#n=e}get grabbing(){return!!this.#r&&!!this.#h}get grabStateObserver(){return this.#t}get activationStateObserver(){return this.#a}#d=()=>{this.#l=this.onGrabStateChangedObservable.add(({anchor:e,state:t})=>{t===g.GRAB?(this.#e.setParent(e),this.#e.position.copyFrom(this.defaultPosition),this.#e.rotation.copyFrom(this.defaultRotation)):t===g.DROP&&this.#e.setParent(null)})};#b=()=>{this.#l.remove(),this.#l=null,this.grabbing&&this.#e.setParent(null)};set moveAttached(e){e&&!this.#i&&this.#e?this.#d():!e&&this.#i&&this.#e&&this.#b(),this.#i=e}set enabled(e){e&&!this.#c&&!this.#f&&this.#v?this.#p():!e&&this.#c&&this.#f&&this.#m(),this.#c=e}get enabled(){return this.#c}get#v(){return!!this.#e}#y=()=>{this.#o=!0,this.onActivationStateChangedObservable.notifyObservers({anchor:this.#r,grabber:this.#h,state:P.ACTIVE})};#u=()=>{this.#o=!1,this.onActivationStateChangedObservable.notifyObservers({anchor:this.#r,grabber:this.#h,state:P.INACTIVE})};#C=(e,t)=>{this.onGrabStateChangedObservable.notifyObservers({anchor:e,grabber:t,state:g.GRAB}),this.#r=e,this.#h=t,this.hideGrabber&&this.#s&&(t.isVisible=!1)};#g=()=>{this.#o&&this.#u(),this.hideGrabber&&this.#s&&(this.#h.isVisible=!0),this.onGrabStateChangedObservable.notifyObservers({anchor:this.#r,grabber:this.#h,state:g.DROP}),this.#r=null,this.#h=null};init(){}attach=e=>{this.#e=e,this.enabled&&this.#p(),this.#i&&this.#d(),this.interactionManager.interactableMeshes.push(this.#e)};#p=()=>{this.#t=this.interactionManager.onGrabStateChangedObservable.add(({anchor:e,grabber:t,state:s})=>{s===g.GRAB&&!this.grabbing?(this.#s=t.isVisible,this.#C(e,t)):s===g.DROP&&this.grabbing&&this.#g()},this.#e.uniqueId),this.#a=this.interactionManager.onActivationStateChangedObservable.add(({anchor:e,grabber:t,state:s})=>{this.#n&&this.grabbing&&(s===P.ACTIVE&&!this.#o?this.#y():s===P.INACTIVE&&this.#o&&this.#u())},this.#e.uniqueId)};enable=()=>{this.enabled=!0};disable=()=>{this.enabled=!1};#m=()=>{this.#t.remove(),this.#a.remove(),this.#t=null,this.#a=null};get#f(){return!!this.#t&&!!this.#a}detach=()=>{this.#i&&this.#b(),this.grabbing&&this.#g(),this.#f&&this.#m(),this.onGrabStateChangedObservable.clear(),this.onActivationStateChangedObservable.clear();const e=this.interactionManager.interactableMeshes.findIndex(t=>t===this.#e);e!==-1&&this.interactionManager.interactableMeshes.splice(e,1),this.#e=null}}class st{mesh;#e;#t;#a;#i;#s;onBeforePourObservable;onMidPourObservable;onAfterPourObservable;pourDelay=1e3;#n=0;animating=!1;onAnimationChangeObservable;constructor(e){this.#e=new V(e,{activatable:!0,defaultRotation:new d(0,Math.PI/2,Math.PI)}),this.#t=new it(m.Green()),this.onBeforePourObservable=new C,this.onMidPourObservable=new C,this.onAfterPourObservable=new C,this.onAnimationChangeObservable=new C}get name(){return"Pouring"}init(){}attach=e=>{this.mesh=e,this.mesh.addBehavior(this.#e),this.mesh.addBehavior(this.#t);const t=e.getScene(),s=this.#e.interactionManager.interactableMeshes;this.#a=this.#e.onGrabStateChangedObservable.add(({state:n})=>{n===g.GRAB?this.#i=t.onBeforeRenderObservable.add(()=>{const a=this.#o(s);this.#r(a)}):n===g.DROP&&(this.#r(null),this.#i&&(this.#i.remove(),this.#i=null))})};detach=()=>{this.#a.remove(),this.#i&&this.#i.remove()};#o(e){const t=e.filter(a=>{const o=this.mesh.absolutePosition.y>a.absolutePosition.y,r=!!a.getBehaviorByName("Pourable"),h=!a.getBehaviorByName("Interactable").grabbing,l=this.mesh.intersectsMesh(a);return o&&r&&h&&l});let s=null,n=Number.POSITIVE_INFINITY;for(const a of t){const o=d.Distance(this.mesh.absolutePosition,a.absolutePosition);o<n&&(s=a,n=o)}return s}#r(e){this.#s!==e&&(this.#s&&(this.#s instanceof q&&this.#t.unhighlightAll(),this.#n&&(clearTimeout(this.#n),this.#n=0)),this.#s=e,this.#s&&(this.#s instanceof q&&(this.#t.highlightSelf(),this.#t.highlightOther(this.#s)),this.#e.onActivationStateChangedObservable.add(({state:t})=>{t===P.ACTIVE&&this.pour()})))}pour=()=>{if(!this.#s)throw new Error("PouringBehavior: attempted pour with no current target.");if(!this.#s.getBehaviorByName("Pourable"))throw new Error("PouringBehavior: target is not pourable.");const t=this.#s;A(t.id),this.onBeforePourObservable.notifyObservers(t),this.onMidPourObservable.notifyObservers(t),this.onAfterPourObservable.notifyObservers(t)}}const M=30,at=[{frame:0,value:new d(Math.PI,0,0)},{frame:M,value:new d(Math.PI,0,-Math.PI/2)},{frame:2*M,value:new d(Math.PI,0,0)}],nt=[{frame:0,value:new d(Math.PI,0,0)},{frame:M,value:new d(Math.PI,0,Math.PI/2)},{frame:2*M,value:new d(Math.PI,0,0)}],ot=new S("pour-neg-z","rotation",M,S.ANIMATIONTYPE_VECTOR3,S.ANIMATIONLOOPMODE_CONSTANT),rt=new S("pour-pos-z","rotation",M,S.ANIMATIONTYPE_VECTOR3,S.ANIMATIONLOOPMODE_CONSTANT);ot.setKeys(at,!0);rt.setKeys(nt,!0);class ht{mesh;startPos;#e;#t;#a;#i=null;#s;#n;#o;constructor(e=1.25){this.#e=e,this.startPos=d.Zero(),this.#n=[{name:"Invisibility",startValue:1},{name:"Visibility",startValue:0}],this.#n.forEach(t=>{t.animation=new S(t.name,"visibility",60,S.ANIMATIONTYPE_FLOAT,S.ANIMATIONLOOPMODE_CONSTANT),t.animation.setKeys([{frame:0,value:t.startValue},{frame:30,value:t.startValue?0:1}])})}init(){}get name(){return"FadeAndRespawn"}attach(e){this.mesh=e,this.#t=this.mesh.getBehaviorByName("Interactable"),this.#s=this.mesh.getBehaviorByName("Pouring"),this.#o=this.mesh.getScene(),this.#a=this.#t.onGrabStateChangedObservable.add(({state:t})=>{t===g.DROP&&(this.#s.animating?this.#i=this.#s.onAnimationChangeObservable.addOnce(s=>{if(s)throw new Error("Received notication of starting animating before receiving notification of stopping animating.");this.#r(),this.#i=null}):this.#r())})}detach(){this.#a.remove(),this.#i&&this.#i.remove()}#r(){if(Math.abs(d.Distance(this.mesh.getAbsolutePosition(),this.startPos))<=.15){this.#l();return}this.#o.beginDirectHierarchyAnimation(this.mesh,!1,[this.#n.find(t=>t.name==="Invisibility").animation],0,60,!1,this.#e,()=>{this.#l(),this.#h()})}#h(){this.#o.beginDirectHierarchyAnimation(this.mesh,!1,[this.#n.find(e=>e.name==="Visibility").animation],0,60,!1,this.#e)}#l(){this.mesh.position.copyFrom(this.startPos),this.mesh.rotation.copyFromFloats(Math.PI,0,0)}}function pe(i,e){const t=i.getChildMeshes().find(n=>n.id.split("-").pop()==="liquid"),s=new x("liquid-material");s.diffuseColor=e,t.material=s}function H(i,e){pe(i,e);const t=new Q("dynamic-texture",256,null,!0,E.LINEAR_LINEAR_MIPNEAREST);t.uAng=Math.PI;const s=new x("cylinder-label-material");s.diffuseTexture=t;const n="bold 250px monospace",a=i.getChildMeshes().filter(l=>{const c=l.id.split("-").pop();return c==="label"||c==="labelback"});for(const l of a)l.material=s,t.drawText(i.id.split("-").pop().toUpperCase(),0,225,n,"black","white");const o=new st(R),r=new tt,h=new ht;i.addBehavior(o),i.addBehavior(r),i.addBehavior(h)}const lt=(i,e)=>{let t=[],s=[],n={};const a={ding:new z("ding",We),explosion:new z("explosion",qe),fanfare:new z("fanfare",Ye)};e.forEach(o=>{o.logic&&o.logic.taskType==="pouring"&&ct(i,o,t,s,n)}),dt(i,s,a),t.forEach(o=>{o.onTaskStateChangeObservable.add(r=>{r===O.SUCCESSFUL&&!a.fanfare.isPlaying&&!a.explosion.isPlaying&&(a.ding.stop(),a.ding.play())})}),B.taskList=t},ne=(i,e,t)=>{i===e?t.succeed():t.fail()},ct=(i,e,t,s,n)=>{let a=e.taskName,o=e.text,r=e.logic,h=[];r.subtasks.forEach(p=>{let v=n[p];v&&h.push(v)});let l;h.length?l=new J(a,o,[[...h]]):l=new J(a,o,[]),t.push(l),s.push(l),n[a]=l;let f=i.getMeshByName(r.from).getBehaviorByName("Pouring");f.onAfterPourObservable.add(p=>{A(`Pouring mesh name: ${f.mesh.name}`),A(`Poured mesh name: ${p.name}`);const v=p.getChildMeshes().find(I=>I.id.split("-").pop()==="liquid").material.diffuseColor,T=f.mesh.getChildMeshes().find(I=>I.id.split("-").pop()==="liquid").material.diffuseColor,L=new m((v.r+T.r)/2,(v.g+T.g)/2,(v.b+T.b)/2);pe(p,L),f.animating?f.onAnimationChangeObservable.addOnce(()=>{ne(p.name,r.to,l)}):ne(p.name,r.to,l)})},dt=(i,e,t)=>{B.sop=new J("SOP","Standard operating procedure for lab safety.",[e]),B.sop.onTaskStateChangeObservable.add(s=>{switch(s){case O.SUCCESSFUL:Y.createSuccessScreen(i,()=>X(i)),t.fanfare.stop(),t.fanfare.play();break;case O.FAILURE:t.explosion.stop(),t.explosion.play();const a=et().getBehaviorByName("Fire");a&&a.onFireObservable.add(o=>{o||(Y.createFailureScreen(i,()=>X(i)),t.fanfare.stop(),t.fanfare.play())});break;case O.RESET:break}})};function ut(i,e){const t=i.getScene(),s=new x("clipboard-material",t);s.emissiveColor.copyFrom(m.White()),s.useAlphaFromDiffuseTexture=!0;const n=i.getChildMeshes().find(a=>a.name===`${i.id}-plane`);n.material=s,fetch("./json/sopData.json").then(a=>a.json()).then(a=>{let o=a.items[1].sublist;lt(t,o);const r=new Ze(e,a,B.sop,B.taskList);n.addBehavior(r)})}function K(i){const e=i.getScene(),t=i.name.split("-")[1],s=i.getChildMeshes().find(h=>h.name==="Placard"),n=i.getChildMeshes().find(h=>h.name==="Label");s.id="placard-base",s.name="placard-base";const a=new Q("dynamic texture",256,e);a.wAng=-Math.PI/2,a.uAng=Math.PI;const o=new x("Mat",e);o.diffuseTexture=a,n.material=o,a.drawText(t.toUpperCase(),65,185,"bold 220px monospace","black","white"),s.addChild(n)}function ft(i){i.keysUp.push(87),i.keysDown.push(83),i.keysLeft.push(65),i.keysRight.push(68)}const bt=["WallsandFloor","Floor","Table","Roof","Countertop","Walls","FumehoodBase_LP","FumehoodInner_LP","FumehoodInnerHook_LP"];function gt(i){i.getChildMeshes().forEach(e=>{bt.includes(e.name)&&(e.checkCollisions=!0)})}function pt(i){const e=i.getScene().activeCamera;gt(i),ge(e),ft(e)}class mt{particleSystem;#e;constructor(e){this.#e=e,this.#t()}#t(){let e=this.#e.getScene(),t;ie.IsSupported?(t=new ie("particles",{capacity:15e3},e),t.activeParticleCount=2e3):t=new se("particles",2e3,e),t.particleTexture=new E("https://raw.githubusercontent.com/PatrickRyanMS/BabylonJStextures/master/FFV/smokeParticleTexture.png",e),t.emitRate=150,t.createPointEmitter(new d(-3.5,-3.5,0),new d(3.5,3.5,0)),t.gravity=new d(0,0,20),t.isLocal=!0,t.minLifeTime=.3,t.maxLifeTime=.3,t.minEmitPower=.7,t.maxEmitPower=.5,t.minSize=.01,t.maxSize=.02;let s=.3;t.addSizeGradient(s,s,s),t.blendMode=se.BLENDMODE_STANDARD,t.emitter=this.#e,this.particleSystem=t}start(){this.particleSystem.start()}stop(){this.particleSystem.stop()}}const vt=2;function yt(i){const e=new V(R,{activatable:!0,defaultRotation:new d(0,0,Math.PI)});let t=new mt(i);i.addBehavior(e);let s=null;const n=i.getScene(),a=D.CreateSphere("debug-sphere-1",{diameter:.1}),o=D.CreateSphere("debug-sphere-2",{diameter:.1});a.isVisible=!1,o.isVisible=!1,e.onActivationStateChangedObservable.add(({state:r})=>{r===P.ACTIVE?(t.start(),s=n.onBeforeRenderObservable.add(()=>{const h=new Be(i.absolutePosition,i.getDirection(ue.Z).normalize(),vt);a.setAbsolutePosition(h.origin),o.setAbsolutePosition(h.origin.add(h.direction.scale(h.length)));const l=n.pickWithRay(h,c=>{const f=c.getBehaviorByName("Fire");return!!(f&&!f.extinguished)});if(l.hit){const c=l.pickedMesh.getBehaviorByName("Fire");c.extinguished||c.extinguish()}})):r===P.INACTIVE&&(t.stop(),s&&(s.remove(),s=null))})}function Ct(i){const e=i.getChildMeshes(!0)[0];e.rotationQuaternion=null;const t=new V(R,{moveAttached:!1});let s=null;const n=i.getScene();t.onGrabStateChangedObservable.add(({anchor:a,state:o})=>{o===g.GRAB?s=n.onBeforeRenderObservable.add(()=>{const r=a.getAbsolutePosition().subtract(e.getAbsolutePosition());if(r.y=0,r.x>0)return;const h=r.z<0?0:Math.PI,l=-Math.atan(r.x/r.z);e.rotation.copyFromFloats(0,l+h,0)}):o===g.DROP&&s&&(s.remove(),s=null)}),e.addBehavior(t)}const St=1.93,It=1.3,oe=(i,e)=>{let t=Math.floor(i.position.y*100)/100;t+e>=It&&t+e<=St&&(i.position.y+=e)},Pt=i=>{const e=i.getScene();let t=null,s=null;const n=new V(R,{moveAttached:!1});i.addBehavior(n),n.onGrabStateChangedObservable.add(({anchor:a,state:o})=>{if(o==g.GRAB){const r=i.getBehaviorByName("PointerDrag");if(r&&(s=r.onDragObservable.add(h=>{let l=h.delta.y;oe(i,l)})),a){let h=d.Zero();h.copyFrom(a.getAbsolutePosition()),t=e.onBeforeRenderObservable.add(()=>{const l=a.getAbsolutePosition().subtract(h);let c=Math.floor(l.y*100)/100;oe(i,c),h.copyFrom(a.getAbsolutePosition())})}}else o==g.DROP&&(s&&s.remove(),t&&t.remove())})};function Ot(i){const e=i.find(u=>u.name==="room"),t=i.find(u=>u.name==="placard"),s=i.find(u=>u.name==="cylinder").getChildMeshes(!0)[0],n=i.find(u=>u.name==="clipboard").getChildMeshes(!0)[0],a=i.find(u=>u.name==="fire-extinguisher").getChildMeshes(!0)[0],o=i.find(u=>u.name==="FireCabinet"),r=i.find(u=>u.name==="Glass Divider");pt(e),Pt(r);const h=n.parent;h.id="clipboard-root",h.name=h.id,n.setParent(null),h.dispose(!0),wt(n),fetch(Je).then(u=>u.text()).then(u=>{ut(n,u)});const l=t.clone(`${t.name}-c`,t.parent),c=t.clone(`${t.name}-b`,t.parent),f=t;l.id=l.name,c.id=c.name,f.name+="-a",f.id=f.name,l.getChildMeshes().forEach(u=>u.name=u.name.split(".")[1]),c.getChildMeshes().forEach(u=>u.name=u.name.split(".")[1]),K(l),K(c),K(f),i.push(l,c);const p=s.parent;s.setParent(null),p.dispose(!0);const v=s.clone(`${s.id}-c`,null),T=s.clone(`${s.id}-b`,null),L=s;Tt([L,T,v],["a","b","c"]),H(v,m.Blue()),H(T,m.Green()),H(L,m.Red());const I=a.parent;I.id="fire-extinguisher-root",I.name=I.id,a.setParent(null),I.dispose(),a.id="fire-extinguisher",a.name=a.id,yt(a),Ct(o),i.push(v,T)}function Tt(i,e){i.forEach((t,s)=>{t.id=`cylinder-${e[s]}`,t.name=t.id,t.getChildMeshes().forEach(n=>{switch(n.id.split(".").pop()){case"BeakerLiquid":n.id=`${t.id}-liquid`,n.name=n.id;break;case"Label":n.id=`${t.id}-label`;break;case"LabelBack":n.id=`${t.id}-labelback`;break}})})}function wt(i){i.id="clipboard",i.name=i.id,i.getChildMeshes().forEach(e=>{switch(e.id){case"Plane":e.id=`${i.id}-plane`,e.name=e.id;break;case"Clipper":e.id=`${i.id}-clip`,e.name=e.id;break;case"horizontalScrew":e.id=`${i.id}-screw`,e.name=e.id;break;case"metalThingy":e.id=`${i.id}-metal`,e.name=e.id;break}})}const me=64,$=me/2,Et=.005;function kt(i,e){const t=new Q(i,me),s=t.getContext();s.beginPath(),s.arc($,$,$,0,2*Math.PI),s.fill(),t.update();const n=new x(i);n.diffuseTexture=t,n.opacityTexture=t;const a=xe(i,{size:Et},e);return a.material=n,a}async function Mt(i,e){const t=await be([i,e]);let s=null,n=null;for(const a of t){const o=a.meshes.find(h=>h.id===i||h.id===e);for(const h of a.animationGroups)h.name+=`-${o.name}`,h.pause();const[r]=o.getChildMeshes();if(!r)throw new Error(`Cannot collapse the root mesh of ${o.name}`);if(r.id=o.id,r.name=o.name,r.setParent(null),o.dispose(!0),r.name===i)s=r;else if(r.name===e)n=r;else throw new Error("Base mesh name is invalid. This shouldn't be possible.")}if(!s)throw new Error("No left hand mesh found.");if(!n)throw new Error("No right hand mesh found.");return{left:s,right:n}}const Rt={inputOptions:{doNotLoadControllerMeshes:!0},pointerSelectionOptions:{enablePointerSelectionOnAllControllers:!0}};async function At(i){let e=!1;i.pointerSelection.laserPointerDefaultColor=m.Green(),i.pointerSelection.laserPointerPickedColor=m.Green(),i.pointerSelection.selectionMeshDefaultColor=m.Green(),i.pointerSelection.selectionMeshPickedColor=m.Green(),i.pointerSelection.displayLaserPointer=e,i.pointerSelection.displaySelectionMesh=e,window.addEventListener("keydown",a=>{a.keyCode===73&&(e=!e,i.pointerSelection.displayLaserPointer=e,i.pointerSelection.displaySelectionMesh=e)}),i.baseExperience.onStateChangedObservable.add(a=>{w.IN_XR}),i.baseExperience.camera.onAfterCameraTeleport.add(()=>{i.baseExperience.camera.position.y=i.baseExperience.camera.realWorldHeight});const n=await Mt("left","right");for(const a of i.input.controllers)re(a,n[`${a.inputSource.handedness}`]);i.input.onControllerAddedObservable.add(a=>{re(a,n[`${a.inputSource.handedness}`])}),i.input.onControllerRemovedObservable.add(a=>{let o=b.findIndex(r=>r===a.pointer.name);o!==-1&&b.splice(o,1),a.grip&&(o=b.findIndex(r=>r===a.grip.name),o!==-1&&b.splice(o,1))})}function re(i,e){b.push(i.pointer.name),i.grip&&b.push(i.grip.name),e.isPickable=!1,Bt(i,e,i.inputSource.handedness)}function Bt(i,e,t){e.setParent(i.pointer),e.rotationQuaternion=null,t!=="none"?e.rotation.copyFromFloats(Math.PI,0,Math.PI/2):e.rotation.copyFromFloats(0,0,0),i.motionController&&he(i.motionController,e),i.onMotionControllerInitObservable.add(s=>{he(s,e)}),R.addSelector(i.pointer,e,[fe.XR]),b.push(e.name)}function he(i,e){const t=i.getComponentOfType("squeeze"),s=e.getScene().animationGroups.find(n=>n.name===`Fist-${e.name}`);t.onButtonStateChangedObservable.add(n=>{const a=s.from+(s.to-s.from)*n.value;s.goToFrame(a)})}let y,R;const b=[];async function xt(i){const e=new Le(i),t=new Ne("light1",new d(1,1,0),e),s=new _e("camera",De),n=document.getElementById("canvas");let a=!1;("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.maxTouchPoints>0)&&(a=!0),a?(console.log("MOBILE"),s.inputs.clear(),s.inputs.add(new j)):n.addEventListener("click",()=>{n.requestPointerLock()}),Nt(e,!0),Ve(s),e.activeCamera=s,e.activeCamera.attachControl(n,!0),t.intensity=0,W.audioEngine.useCustomUnlockedButton=!0;const o=new Fe(e),r=kt("reticle",o.utilityLayerScene);if(r.setParent(s),r.position.copyFrom(ue.Z),b.push(r.name),"xr"in window.navigator){y=await e.createDefaultXRExperienceAsync(Rt),R=new ee(e,y),await At(y),b.push(...e.meshes.map(l=>l.name));for(const l of y.input.controllers)b.push(l.pointer.name),l.grip&&b.push(l.grip.name);y.input.onControllerAddedObservable.add(l=>{b.push(l.pointer.name),l.grip&&b.push(l.grip.name)}),y.input.onControllerRemovedObservable.add(l=>{let c=b.findIndex(f=>f===l.pointer.name);c!==-1&&b.splice(c,1),l.grip&&(c=b.findIndex(f=>f===l.grip.name),c!==-1&&b.splice(c,1))}),b.push("laserPointer"),r.isVisible=y.baseExperience.state!==w.IN_XR,y.baseExperience.onStateChangedObservable.add(l=>{r.isVisible=l!==w.IN_XR})}await X(e),Y.createWelcomeScreen(e);const h=document.querySelector("div.splash");return h.textContent="Click to start!",h.addEventListener("click",()=>{h.classList.add("hide"),W.audioEngine.audioContext.resume()},!1),e}function Lt(i){let e=setInterval(()=>{i.intensity>=1?clearInterval(e):i.intensity+=.1},60)}async function X(i){const e=i.getLightByName("light1");e.intensity=0;const t=i.activeCamera,s=i.meshes.filter(r=>!b.includes(r.name));for(const r of s)r.dispose();const a=(await be()).map(r=>r.meshes).flat();return Ot(a),$e(a),ge(t),a.filter(r=>r.id.split("-").length===2&&r.id.split("-")[0]==="cylinder").forEach(r=>{let h=r.getBehaviorByName("FadeAndRespawn");h&&h.startPos.copyFrom(r.position)}),"xr"in window.navigator&&(y.teleportation.removeFloorMeshByName("Floor"),y.teleportation.addFloorMesh(i.getMeshByName("Floor"))),Lt(e),i}function Nt(i,e){i.collisionsEnabled=!0}function _t(i){window.addEventListener("resize",function(){i.resize()})}const Ft=document.getElementById("canvas"),Z=new W(Ft,!0,{stencil:!0});_t(Z);xt(Z).then(i=>{Z.runRenderLoop(()=>i.render())});
