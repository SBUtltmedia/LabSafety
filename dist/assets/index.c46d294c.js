var q=Object.defineProperty;var K=(i,e,o)=>e in i?q(i,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[e]=o;var c=(i,e,o)=>(K(i,typeof e!="symbol"?e+"":e,o),o),V=(i,e,o)=>{if(!e.has(i))throw TypeError("Cannot "+o)};var k=(i,e,o)=>(V(i,e,"read from private field"),o?o.call(i):e.get(i)),_=(i,e,o)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,o)};import{M as T,V as O,S as D,D as z,H as U,C as I,P as $,A as m,B as R,a as Y,R as Z,b as F,c as x,W as j,E as Q,d as X,U as J,e as ee,f as te}from"./vendor.8cc9db75.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const t of n)if(t.type==="childList")for(const a of t.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function o(n){const t={};return n.integrity&&(t.integrity=n.integrity),n.referrerpolicy&&(t.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?t.credentials="include":n.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function l(n){if(n.ep)return;n.ep=!0;const t=o(n);fetch(n.href,t)}})();window.exports=window;function p(i,e){return i.getChildMeshes().find(o=>o.name===e)||null}function ie(i){var l;const e=new URLSearchParams(document.location.search);(e.get("debug")===""||((l=e.get("debug"))==null?void 0:l.toLowerCase())==="true")&&i.debugLayer.show()}class H{constructor(e,o,l,n=0){c(this,"complete",!1);c(this,"title");c(this,"description");c(this,"failed",!1);c(this,"onFail");c(this,"onSuccess");c(this,"onCompletion");c(this,"currentState");c(this,"tasks");this.title=e,this.description=o,this.tasks=l,this.currentState=n}}const B=60,ne=50,G=3,M="cylinder",W="liquid",oe="placard";new H("","",[{next:"CtoA",label:"BtoC"},{next:"complete",label:"CtoA"}]);class ae{constructor(e,o){c(this,"highlightLayer");c(this,"highlightColor");c(this,"highlightReferences");c(this,"highlightingMeshes");c(this,"mesh");c(this,"attach",e=>{this.mesh=e,this.highlightLayer.addMesh(this.mesh,this.highlightColor)});c(this,"detach",()=>{this.highlightLayer.removeMesh(this.mesh),this.highlightReferences=0,this.highlightingMeshes=[]});c(this,"highlightSelf",()=>{this.highlightLayer.isEnabled=!0});c(this,"unhighlightSelf",()=>{this.highlightReferences||(this.highlightLayer.isEnabled=!1)});c(this,"highlightMesh",e=>{if(this.highlightingMeshes.find(l=>l===e))return!1;const o=e.getBehaviorByName(this.name);return o?(o.highlightReferences+=1,o.highlightSelf(),this.highlightingMeshes.push(e),!0):!1});c(this,"unhighlightMesh",e=>{const o=e.getBehaviorByName(this.name);if(!o)return!1;const l=this.highlightingMeshes.findIndex(n=>n===e);return l===-1?!1:(o.highlightReferences-=1,o.unhighlightSelf(),this.highlightingMeshes.splice(l,1),!0)});this.highlightLayer=e,this.highlightColor=o,this.highlightReferences=0,this.highlightingMeshes=[]}get name(){return"Highlight"}init(){}}const w=(i,e,o,l)=>{const n=i.getScene(),t=n.getMeshByName("Table");let a=T.CreateSphere(`pivot-${o}`,{diameterX:.15,diameterY:.33,diameterZ:.2},i.getScene());a.visibility=0,i.name=o,i.parent=a,i.rotationQuaternion=null;let r=T.CreateBox("LEFT_COLLISION");r.scaling.y=.01,r.scaling.x=.04,r.scaling.z=.04,r.parent=a,r.position.y+=.3,r.position.x-=.15,r.visibility=0;let s=T.CreateBox("RIGHT_COLLISION");if(s.scaling.y=.01,s.scaling.x=.04,s.scaling.z=.04,s.parent=a,s.position.y+=.3,s.position.x+=.15,s.visibility=0,i.getChildMeshes().forEach(u=>{switch(u.name){case"BeakerwOpacity":u.name=M,u.rotationQuaternion=null,u.rotation.z=2*Math.PI,u.isPickable=!1;break;case"BeakerLiquid":u.name=W,u.isPickable=!1;break}}),t){const u=t.getBoundingInfo().boundingBox,S=p(i,M).getBoundingInfo().boundingBox.maximum.y+1e-5;a.position.y=u.maximumWorld.y+S,a.position.x=(u.maximumWorld.x-u.minimumWorld.x)/G*e+u.minimumWorld.x-.3,a.position.z=(u.centerWorld.z+u.minimumWorld.z)/2}else a.position.x=-2+e,a.position.y=1.22,a.position.z=.5;a.checkCollisions=!0,a.ellipsoid=new O(.02,.16,.02);const d=p(i,W),h=new D("liquid-material");h.diffuseColor=l,d.material=h;const g=p(i,"Label"),f=p(i,"LabelBack"),y=new z("dynamic texture",256,n);y.uAng=Math.PI;const b=new D("Mat",n);b.diffuseTexture=y,g.material=b,f.material=b;const C="bold 220px monospace";y.drawText(i.name.split("-")[1].toUpperCase(),65,185,C,"black","white");const v=new U("highlight-layer");v.innerGlow=!0,v.outerGlow=!1,v.isEnabled=!1,p(i,M).addBehavior(new ae(v,I.Green())),se(a,a.position.x,a.position.y,a.position.z)};function se(i,e,o,l){let n,t=new $({dragPlaneNormal:new O(0,0,1)});t.useObjectOrientationForDragging=!1,t.moveAttached=!1,t.onDragStartObservable.add(()=>{n&&clearTimeout(n)}),t.onDragObservable.add(a=>{i.moveWithCollisions(a.delta)}),t.onDragEndObservable.add(()=>{n=setTimeout(()=>le(i,e,o,l),ne)}),i.addBehavior(t)}function le(i,e,o,l){i.isPickable=!1;let n=i.name.split("-")[0],t=i.getScene(),a=i.getChildMeshes(),r=a.find(A=>A.name==="cylinder"),s=a.find(A=>A.name==="liquid"),d=s.visibility,h=new m("InvisibilityOfCylinder","visibility",120,m.ANIMATIONTYPE_FLOAT,m.ANIMATIONLOOPMODE_CONSTANT),g=new m("VisibilityOfCylinder","visibility",120,m.ANIMATIONTYPE_FLOAT,m.ANIMATIONLOOPMODE_CONSTANT),f=new m("InvisibilityOfLiquid","visibility",120,m.ANIMATIONTYPE_FLOAT,m.ANIMATIONLOOPMODE_CONSTANT),y=new m("VisibilityOfLiquid","visibility",120,m.ANIMATIONTYPE_FLOAT,m.ANIMATIONLOOPMODE_CONSTANT);const b=[];b.push({frame:0,value:d}),b.push({frame:60,value:0});const C=[];C.push({frame:0,value:0}),C.push({frame:60,value:d});const v=[];v.push({frame:0,value:1}),v.push({frame:60,value:0});const u=[];u.push({frame:0,value:0}),u.push({frame:60,value:1}),r.animations.push(h),r.animations.push(g),s.animations.push(f),s.animations.push(y),h.setKeys(v),g.setKeys(u),f.setKeys(b),y.setKeys(C),t.beginDirectAnimation(r,[h],0,60,!1),t.beginDirectAnimation(s,[f],0,60,!1,void 0,()=>{r.rotation.z=Math.PI*2,i.position.x=e,i.position.y=o,i.position.z=l,r.getAnimationByName(`${n}-rotateAroundZ`),t.beginDirectAnimation(r,[g],0,60,!1),t.beginDirectAnimation(s,[y],0,60,!1,void 0,()=>{i.isPickable=!0})})}function re(i){i.name="clipboard";const e=i.getScene(),o=e.getMeshByName("Table");if(o){const n=o.getBoundingInfo().boundingBox;i.position.y=n.maximumWorld.y+.003}i.rotationQuaternion=null,i.rotation=new O(0,Math.PI/4,0);const l=e.getMeshByName("pivot-Cylinder-A");l&&(i.position.x=l.position.x+.2,i.position.z=l.position.z+.5)}function he(i){var e=new R(I.FromHexString("#0984e3"));e.ignoreChildren=!0;var o=i[0],l=R.MakeNotPickableAndWrapInBoundingBox(o);e.attachedMesh=l,e.onScaleBoxDragObservable.add(()=>{console.log("scaleDrag")}),e.onScaleBoxDragEndObservable.add(()=>{const n=e.attachedMesh;if(n){const t=n.getHierarchyBoundingVectors(!0);console.log("size x:",t.max.x-t.min.x),console.log("size y:",t.max.y-t.min.y),console.log("size z:",t.max.z-t.min.z)}console.log("scaleEnd")}),e.onRotationSphereDragObservable.add(()=>{console.log("rotDrag")}),e.onRotationSphereDragEndObservable.add(()=>{console.log("rotEnd")})}function E(i,e,o){const l=i.find(g=>g.name==="__root__"),n=l.getScene();l.name=o;const t=i.find(g=>g.name==="Label"),a=i.find(g=>g.name==="Placard");a.name=oe;const r=new z("dynamic texture",256,n);r.wAng=-Math.PI/2,r.uAng=Math.PI;const s=new D("Mat",n);s.diffuseTexture=r,t.material=s;const d="bold 220px monospace";r.drawText(l.name.split("-")[1].toUpperCase(),65,185,d,"black","white"),a.addChild(t),a.rotationQuaternion=null,a.rotation=new O(0,Math.PI/2,0);const h=n.getMeshByName("Table");if(h){const g=h.getBoundingInfo().boundingBox;l.position.y=g.maximumWorld.y+.003,l.position.x=(g.maximumWorld.x-g.minimumWorld.x)/G*e+g.minimumWorld.x-.2,l.position.z=(g.centerWorld.z+g.minimumWorld.z)/2+.2}}const de=new H("","",[{next:"CtoA",label:"BtoC"},{next:"complete",label:"CtoA"}]),N={right:"handR2320",left:"handL2320"};function ce(i,e){let o;return new Promise(l=>{const n="./models/",t="left.glb",a="right.glb";var r={};const s=new Y(i);s.addMeshTask("load left hand","",n,t),s.addMeshTask("load right hand","",n,a),s.onTaskSuccess=d=>{console.log("Task:",d.loadedMeshes[0]);for(let h of d.loadedMeshes)r[h.name]=h;console.log("MODELS: ",r),o=d.loadedAnimationGroups,console.log("Scene animation groups: ",i.animationGroups)},s.onTasksDoneObservable.add(()=>{for(let d=0;d<i.animationGroups.length;d++)i.animationGroups[d].pause();e.pointerSelection.detach(),e.input.onControllerAddedObservable.add(d=>{let h=d.inputSource.handedness,g=r[N[h]].parent.parent;r[N[h]].isPickable=!1,console.log(g);let f=(Object.keys(r).indexOf(N[h])-1)*2-1;console.log(r[N[h]]),r[N[h]].rotation.y=Math.PI*f,r[N[h]].rotation.z=0,r[N[h]].rotation.x=-Math.PI/4,g.parent=d.grip||d.pointer})}),s.loadAsync().then(()=>{l(o)})})}function ge(i,e,o,l){let n,t;function a(r){for(let s of["A","B","C"]){let d=i.getMeshByName(`pivot-Cylinder-${s}`);if(r.intersectsMesh(d,!1))return d}return!1}e.input.onControllerAddedObservable.add(r=>{r.onMotionControllerInitObservable.add(s=>{let d=s;d.handID=s.handedness;let h=new Z(O.Zero(),O.Zero(),.25);r.getWorldPointerRayToRef(h);const g=s.getComponentOfType("squeeze");[s.getComponentOfType("trigger"),g].forEach(y=>{y.onButtonStateChangedObservable.add(b=>{console.log(b),y.pressed,console.log("Trigger pressed: ",b.value);let C={left:0,right:7},v,u=i.animationGroups[C[d.handID]];if(console.log(u),b.value?v=b.value*u._to:v=1,u.goToFrame(v),b.value&&!d.grabbed){d.lastPosition||(d.lastPosition=Object.assign({},h.origin)),console.log("Cylinder inside: ",n),d.grabbed=!0,r.getWorldPointerRayToRef(h),console.log("Current hand: ",d);let A=a(i.getMeshByName(N[d.handID]));if(A){n=A;let L=d.lastPosition;h.origin!=L&&(t=setInterval(()=>{d.lastPosition&&(r.getWorldPointerRayToRef(h),n.position=h.origin),d.lastPosition=Object.assign({},h.origin)},10))}}else b.value||(d.lastPosition=null,clearInterval(t),console.log("Dropped test tube"),d.grabbed=!1,d.meshGrabbed=void 0,console.log("Current hand: ",d),console.log(i.getMeshByName("pivot-Cylinder-A").position),n&&(n.position=l[n.name],n=void 0))})})})})}function ue(i,e){i.onBeforeRenderObservable.add(function(){let n=["A","B","C"];for(let t=0;t<n.length;t++){const a=i.getMeshByName(`pivot-Cylinder-${n[t]}`),r=i.getMeshByName("Table");if(r&&a){const s=r.getBoundingInfo().boundingBox;a.position.z=(s.centerWorld.z+s.minimumWorld.z)/2}}});let o=["A","B","C"],l=[];for(let n of o){const t=i.getMeshByName(`pivot-Cylinder-${n}`);l.push(t);let a=new m(`${n}-rotateAroundZ`,"rotation.z",120,m.ANIMATIONTYPE_FLOAT,m.ANIMATIONLOOPMODE_CONSTANT),r=p(t,M);const s=[];s.push({frame:0,value:Math.PI*2}),s.push({frame:60,value:4.62}),r.animations.push(a),a.setKeys(s);let d=new m(`${n}-resetRotateAroundZ`,"rotation.z",120,m.ANIMATIONTYPE_FLOAT,m.ANIMATIONLOOPMODE_CONSTANT);const h=[];h.push({frame:0,value:4.62}),h.push({frame:60,value:Math.PI*2}),r.animations.push(d),d.setKeys(h)}for(let n=0;n<o.length;n++){const t=i.getMeshByName(`pivot-Cylinder-${o[n]}`),a=t.getBehaviorByName("PointerDrag");let r=[];for(let h of l)h!=t&&r.push(h);let s=p(t,M),d=!1;a.onDragObservable.add(()=>{const h=p(t,M).getBehaviorByName("Highlight");let g=!1;for(let f of r){let y=p(f,"LEFT_COLLISION"),b=p(f,"RIGHT_COLLISION"),C=p(f,M);if(t.intersectsMesh(y)||t.intersectsMesh(b)){g=!0;let v=f.name.split("-")[2],A=`${t.name.split("-")[2]}to${v}`;if(e.tasks[e.currentState].label===A&&(e.tasks[e.currentState].next==="complete"?window.location.assign("."):e.currentState=e.tasks.indexOf(e.tasks.find(L=>L.label==e.tasks[e.currentState].next))),h&&(h.highlightMesh(s),h.highlightMesh(C),t.intersectsMesh(y)?(C.rotation.y=Math.PI,s.rotation.y=0):(C.rotation.y=0,s.rotation.y=Math.PI),!d)){let L=s.getAnimationByName(`${o[n]}-rotateAroundZ`);d=!0,i.beginDirectAnimation(s,[L],0,60,!1,void 0,()=>{})}break}else h.unhighlightMesh(C)}if(g==!1){h.unhighlightMesh(s);let f=s.getAnimationByName(`${o[n]}-resetRotateAroundZ`);d&&(d=!1,i.beginDirectAnimation(s,[f],0,60,!1,void 0,()=>{}))}}),a.onDragEndObservable.add(()=>{const h=p(t,M).getBehaviorByName("Highlight");for(let g of r){let f=p(g,"LEFT_COLLISION"),y=p(g,"RIGHT_COLLISION"),b=p(g,M);if(h.unhighlightMesh(s),h.unhighlightMesh(b),s.intersectsMesh(f)||s.intersectsMesh(y)){let C=s.getAnimationByName(`${o[n]}-resetRotateAroundZ`);s.rotation.z==4.62&&i.beginDirectAnimation(s,[C],0,60,!1,void 0,()=>{})}}})}}var P;class me{constructor(e){c(this,"flying",!1);c(this,"active",!1);c(this,"camera");c(this,"mesh");c(this,"offset",.3);c(this,"animations");c(this,"returnPosition");c(this,"returnRotation");c(this,"onPointerDownObserver");c(this,"xrCamera");c(this,"attach",(e,o,l,n,t)=>{const a=e.getScene();if(this.mesh=e,!o&&(o=a.activeCamera,!o))throw new Error("The scene has no active camera, and no camera was provided.");this.camera=o,l||(l=this.mesh.position),n||(n=this.mesh.rotation),t&&(this.offset=t),this.returnPosition=l,this.returnRotation=n,this.onPointerDownObserver=a.onPointerObservable.add(this.clipboardClick)});c(this,"detach",()=>{this.mesh.getScene().onPointerObservable.remove(this.onPointerDownObserver)});c(this,"clipboardClick",(e={type:F.POINTERDOWN,pickInfo:{pickedMesh:this.mesh}})=>{var o;if(e.type===F.POINTERDOWN){const l=(o=e.pickInfo)==null?void 0:o.pickedMesh;if(l&&(l===this.mesh||l.isDescendantOf(this.mesh))&&!this.flying){const n=this.active?B/2:0,t=this.active?0:B/2;k(this,P).call(this),this.flying=!0,this.mesh.billboardMode==x.BILLBOARDMODE_ALL?this.mesh.billboardMode=x.BILLBOARDMODE_NONE:this.mesh.billboardMode=x.BILLBOARDMODE_ALL,this.mesh.getScene().beginDirectAnimation(this.mesh,this.animations,n,t,!1,void 0,()=>{this.flying=!1,this.active=!this.active})}}});c(this,"calculateTargetPositionWithOffset",e=>{if(this.xrCamera!==void 0&&this.xrCamera.state===j.IN_XR){const a=this.xrCamera.camera._position.subtract(this.returnPosition).scale(1-e/O.Distance(this.returnPosition,this.xrCamera.camera._position));return this.returnPosition.add(a)}const l=this.camera._position.subtract(this.returnPosition).scale(1-e/O.Distance(this.returnPosition,this.camera._position));return this.returnPosition.add(l)});c(this,"setClipboardUp",()=>new O(3.1468286,4.6617744,1.680752));_(this,P,()=>{const e=this.animations.find(({name:t})=>t==="translate"),o=this.animations.find(({name:t})=>t==="rotate"),l=[{frame:0,value:this.returnPosition},{frame:B/2,value:this.calculateTargetPositionWithOffset(this.offset)}],n=[{frame:0,value:this.returnRotation},{frame:B/2,value:this.setClipboardUp()}];e.setKeys(l),o.setKeys(n)});const o=new m("translate","position",B,m.ANIMATIONTYPE_VECTOR3),l=new m("rotate","rotation",B,m.ANIMATIONTYPE_VECTOR3);this.animations=[o,l],this.xrCamera=e}get name(){return"FlyToCamera"}init(){}}P=new WeakMap;class fe{constructor(){c(this,"handAnimation");c(this,"sop");c(this,"models");this.models=[{fileName:"NewLaboratoryUNFINISHED.glb",callback:e=>this.createRoom(e),label:"floor"},{fileName:"TLLGraduatedCylinderWithLabel.glb",callback:e=>w(e[0],1,"Cylinder-A",new I(1,0,0)),label:"Cylinder-A"},{fileName:"TLLGraduatedCylinderWithLabel.glb",callback:e=>w(e[0],2,"Cylinder-B",new I(0,1,0)),label:"Cylinder-B"},{fileName:"TLLGraduatedCylinderWithLabel.glb",callback:e=>w(e[0],3,"Cylinder-C",new I(0,0,1)),label:"Cylinder-C"},{fileName:"clipBoardWithPaperCompressedTexture.glb",callback:e=>re(e[0])},{fileName:"Placard_Label.glb",callback:e=>E(e,1,"Placard-A")},{fileName:"Placard_Label.glb",callback:e=>E(e,2,"Placard-B")},{fileName:"Placard_Label.glb",callback:e=>E(e,3,"Placard-C")}].map(function(e){return Object.assign({},{fileName:"LabBench.glb",root:"./models/",callback:he,label:"NoLabel"},e)}),this.createScene().then(e=>{let o={"pivot-Cylinder-A":e.getMeshByName("pivot-Cylinder-A").position,"pivot-Cylinder-B":e.getMeshByName("pivot-Cylinder-B").position,"pivot-Cylinder-C":e.getMeshByName("pivot-Cylinder-C").position};this.processScene(e,o)})}async processScene(e,o){let l=e.getCameraByName("camera"),n=e.getLightByName("light1"),t={};l.speed=.16;let a=setInterval(()=>{n.intensity>=1?clearInterval(a):n.intensity+=.1},60);const r=["WallsandFloor","WallsAndFloor.001"],s=[];for(let h of r){console.log(h);const g=e.getMeshByName(h);g&&s.push(g)}let d={floorMeshes:s,inputOptions:{doNotLoadControllerMeshes:!0}};t=await e.createDefaultXRExperienceAsync(d),ce(e,t).then(h=>{const g=e.getMeshByName("clipboard");if(t){const f=new me(t.baseExperience);g.addBehavior(f)}console.log(this.models[2]),ue(e,de),ge(e,t,h,o)})}createRoom(e){const o=["WallsandFloor","WallsAndFloor.001","Table","Roof","Countertop","Walls"];let l,n;for(let t of o){const a=e.find(r=>r.name===t);if(a&&(a.checkCollisions=!0,a.name==="Table")){const s=a.getBoundingInfo().boundingBox.center.x;l=a.getScene(),n=l.getCameraByName("camera"),n.position.x=s-.7}}}createScene(){let e=this.models;return console.log(e),new Promise(o=>{var l=document.getElementById("canvas"),n=new Q(l,!0,{stencil:!0}),t=new X(n);t.debugLayer.show(),t.collisionsEnabled=!0,window.addEventListener("resize",function(){n.resize()}),ie(t);const a=new J("camera",new O(0,1.84,-1.134),t);a.ellipsoid=new O(.4,.7,.4),a.attachControl(l,!0),a.applyGravity=!0,a.minZ=0,a.speed=0,a.checkCollisions=!0,a.keysUp.push(87),a.keysDown.push(83),a.keysLeft.push(65),a.keysRight.push(68);var r=new ee("light1",new O(1,1,0),t);r.intensity=0,Promise.all(this.models.map(s=>new Promise(d=>te.ImportMesh("",s.root,s.fileName,t,function(h){s.mesh=h,d(h)})))).then(()=>{this.models.map(s=>{s.callback(s.mesh),o(t)})}),window.addEventListener("keydown",s=>{s.shiftKey&&s.ctrlKey&&s.altKey&&s.keyCode===73&&(t.debugLayer.isVisible()?t.debugLayer.hide():t.debugLayer.show())}),n.runRenderLoop(()=>{t.render()})})}}new fe;
