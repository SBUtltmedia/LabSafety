var K=Object.defineProperty;var U=(s,e,n)=>e in s?K(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var h=(s,e,n)=>(U(s,typeof e!="symbol"?e+"":e,n),n),V=(s,e,n)=>{if(!e.has(s))throw TypeError("Cannot "+n)};var R=(s,e,n)=>(V(s,e,"read from private field"),n?n.call(s):e.get(s)),_=(s,e,n)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,n)};import{M as Z,V as B,S as E,D as G,H as q,C as P,P as Y,A as p,B as W,a as j,R as Q,b as z,c as I,W as X,E as J,d as ee,U as te,e as ie,f as ne}from"./vendor.9a7447f4.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function n(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerpolicy&&(i.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?i.credentials="include":t.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(t){if(t.ep)return;t.ep=!0;const i=n(t);fetch(t.href,i)}})();window.exports=window;class oe{constructor(e,n,a,t=0){h(this,"complete",!1);h(this,"title");h(this,"description");h(this,"failed",!1);h(this,"onFail");h(this,"onSuccess");h(this,"onCompletion");h(this,"currentState");h(this,"tasks");this.title=e,this.description=n,this.tasks=a,this.currentState=t}}const N=60,ae=50,H=3,A="cylinder",F="liquid",se="placard",le=new oe("","",[{next:"CtoA",label:"BtoC"},{next:"complete",label:"CtoA"}]);class re{constructor(e,n){h(this,"highlightLayer");h(this,"highlightColor");h(this,"highlightReferences");h(this,"highlightingMeshes");h(this,"mesh");h(this,"attach",e=>{this.mesh=e,this.highlightLayer.addMesh(this.mesh,this.highlightColor)});h(this,"detach",()=>{this.highlightLayer.removeMesh(this.mesh),this.highlightReferences=0,this.highlightingMeshes=[]});h(this,"highlightSelf",()=>{this.highlightLayer.isEnabled=!0});h(this,"unhighlightSelf",()=>{this.highlightReferences||(this.highlightLayer.isEnabled=!1)});h(this,"highlightMesh",e=>{if(this.highlightingMeshes.find(a=>a===e))return!1;const n=e.getBehaviorByName(this.name);return n?(n.highlightReferences+=1,n.highlightSelf(),this.highlightingMeshes.push(e),!0):!1});h(this,"unhighlightMesh",e=>{const n=e.getBehaviorByName(this.name);if(!n)return!1;const a=this.highlightingMeshes.findIndex(t=>t===e);return a===-1?!1:(n.highlightReferences-=1,n.unhighlightSelf(),this.highlightingMeshes.splice(a,1),!0)});this.highlightLayer=e,this.highlightColor=n,this.highlightReferences=0,this.highlightingMeshes=[]}get name(){return"Highlight"}init(){}}function v(s,e){return s.getChildMeshes().find(n=>n.name===e)||null}class T{constructor(e,n,a,t){h(this,"name");h(this,"position");h(this,"mesh");h(this,"dragCollision");console.log(e),this.name=a;const i=e.getScene(),r=i.getMeshByName("Table");let o=Z.CreateSphere(`pivot-Cylinder-${a}`,{segments:2,diameterX:.15,diameterY:.33,diameterZ:.2},e.getScene());if(o.visibility=0,e.name=a,e.parent=o,e.rotationQuaternion=null,e.getChildMeshes().forEach(u=>{switch(u.name){case"BeakerwOpacity":u.name=A,u.rotationQuaternion=null,u.rotation.z=2*Math.PI,u.isPickable=!1;break;case"BeakerLiquid":u.name=F,u.isPickable=!1;break}}),r){const u=r.getBoundingInfo().boundingBox,x=v(e,A).getBoundingInfo().boundingBox.maximum.y+.01001;o.position.y=u.maximumWorld.y+x,o.position.x=(u.maximumWorld.x-u.minimumWorld.x)/H*n+u.minimumWorld.x-.3,o.position.z=(u.centerWorld.z+u.minimumWorld.z)/2,this.position={...o.position}}else o.position.x=-2+n,o.position.y=1.22,o.position.z=.5;o.checkCollisions=!0,o.ellipsoid=new B(.02,.16,.02),this.mesh=o;const l=v(e,F),d=new E("liquid-material");d.diffuseColor=t,l.material=d;const g=v(e,"Label"),c=v(e,"LabelBack");console.log("Label:",g);const m=new G("dynamic texture",256,i);m.uAng=Math.PI;const f=new E("Mat",i);f.diffuseTexture=m,g.material=f,c.material=f;const y="bold 220px monospace";m.drawText(e.name.toUpperCase(),65,185,y,"black","white");const b=new q("highlight-layer");b.innerGlow=!0,b.outerGlow=!1,b.isEnabled=!1,v(e,A).addBehavior(new re(b,P.Green())),this.addDragCollision()}addDragCollision(){let e=new Y({dragPlaneNormal:new B(0,0,1)});e.useObjectOrientationForDragging=!1,e.moveAttached=!1,e.onDragStartObservable.add(()=>{}),e.onDragObservable.add(n=>{this.mesh.moveWithCollisions(n.delta)}),e.onDragEndObservable.add(()=>{this.fadeAndRespawn()}),this.mesh.addBehavior(e),this.dragCollision=e}removeDragCollision(){this.mesh.removeBehavior(this.dragCollision)}fadeAndRespawn(e=ae){setTimeout(()=>{this.mesh.isPickable=!1;let n=60;this.mesh.name.split("-")[0];let a=this.mesh.getScene(),t=this.mesh.getChildMeshes();console.log(t);let i=t.find(o=>o.name==="cylinder");t.find(o=>o.name==="liquid");let r=[{name:"Invisibility",startValue:1},{name:"Visibility",startValue:0}];r.forEach(o=>{o.init=new p(o.name,"visibility",120,p.ANIMATIONTYPE_FLOAT,p.ANIMATIONLOOPMODE_CONSTANT),o.init.setKeys([{frame:0,value:o.startValue},{frame:n,value:1-o.startValue}])});for(let o=0;o<t.length-1;++o){let l=t[o];a.beginDirectAnimation(l,[r[0].init],0,60,!1)}a.beginDirectAnimation(t[t.length-1],[r[0].init],0,60,!1,void 0,()=>{console.log(this.mesh,this.position),this.mesh.position.x=this.position._x,this.mesh.position.y=this.position._y,this.mesh.position.z=this.position._z,this.mesh.animations=i.animations,this.mesh.rotation.x=0,this.mesh.rotation.y=0,this.mesh.rotation.z=0;for(let o=0;o<t.length-1;++o){let l=t[o];a.beginDirectAnimation(l,[r[1].init],0,60,!1)}a.beginDirectAnimation(t[t.length-1],[r[1].init],0,60,!1,void 0,()=>{this.mesh.isPickable=!0})})},e)}}function he(s){s.name="clipboard";const e=s.getScene(),n=e.getMeshByName("Table");if(n){const t=n.getBoundingInfo().boundingBox;s.position.y=t.maximumWorld.y+.003}s.rotationQuaternion=null,s.rotation=new B(0,Math.PI/4,0);const a=e.getMeshByName("pivot-Cylinder-A");a&&(s.position.x=a.position.x+.2,s.position.z=a.position.z+.5)}function ce(s){var e=new W(P.FromHexString("#0984e3"));e.ignoreChildren=!0;var n=s[0],a=W.MakeNotPickableAndWrapInBoundingBox(n);e.attachedMesh=a,e.onScaleBoxDragObservable.add(()=>{console.log("scaleDrag")}),e.onScaleBoxDragEndObservable.add(()=>{const t=e.attachedMesh;if(t){const i=t.getHierarchyBoundingVectors(!0);console.log("size x:",i.max.x-i.min.x),console.log("size y:",i.max.y-i.min.y),console.log("size z:",i.max.z-i.min.z)}console.log("scaleEnd")}),e.onRotationSphereDragObservable.add(()=>{console.log("rotDrag")}),e.onRotationSphereDragEndObservable.add(()=>{console.log("rotEnd")})}function S(s,e,n){const a=s.find(c=>c.name==="__root__"),t=a.getScene();a.name=n;const i=s.find(c=>c.name==="Label"),r=s.find(c=>c.name==="Placard");r.name=se;const o=new G("dynamic texture",256,t);o.wAng=-Math.PI/2,o.uAng=Math.PI;const l=new E("Mat",t);l.diffuseTexture=o,i.material=l;const d="bold 220px monospace";o.drawText(a.name.split("-")[1].toUpperCase(),65,185,d,"black","white"),r.addChild(i),r.rotationQuaternion=null,r.rotation=new B(0,Math.PI/2,0);const g=t.getMeshByName("Table");if(g){const c=g.getBoundingInfo().boundingBox;a.position.y=c.maximumWorld.y+.003,a.position.x=(c.maximumWorld.x-c.minimumWorld.x)/H*e+c.minimumWorld.x-.2,a.position.z=(c.centerWorld.z+c.minimumWorld.z)/2+.2}}function de(s,e,n){let a;return new Promise(t=>{const i="./models/";let r="";var o={};let l=["left","right"];const d=new j(s);l.forEach(c=>{d.addMeshTask(`load ${c} hand`,"",i,`${c}${r}.glb`)});let g=0;d.onTaskSuccess=c=>{o[l[g]]=c.loadedMeshes[1],c.loadedMeshes[1].name=l[g],a=c.loadedAnimationGroups;for(let m=0;m<a.length;m++)a[m].name=`${l[g]}_${a[m].name}`;g++},d.onTasksDoneObservable.add(()=>{for(let c=0;c<s.animationGroups.length;c++)s.animationGroups[c].pause();e.pointerSelection.detach(),e.input.onControllerAddedObservable.add(c=>{let m=c.inputSource.handedness;console.log(o[m]);let f=o[m].parent.parent;o[m].isPickable=!1;for(let b of n)b.removeDragCollision();let y=(Object.keys(o).indexOf(m)-1)*2-1;o[m].rotation.y=Math.PI*y,o[m].rotation.z=0,o[m].rotation.x=-Math.PI/4,f.parent=c.grip||c.pointer})}),d.loadAsync().then(()=>{t(a)})})}function ge(s,e,n,a){let t,i=["A","B","C"];function r(o){for(let l of i){let d=s.getMeshByName(`pivot-Cylinder-${l}`);if(o.intersectsMesh(d,!1))return d}return!1}e.input.onControllerAddedObservable.add(o=>{o.onMotionControllerInitObservable.add(l=>{let d=l;d.handID=l.handedness;let g=new Q(B.Zero(),B.Zero(),.25);const c=l.getComponentOfType("squeeze"),m=l.getComponentOfType("trigger");function f(y,b){d.lastPosition=null,clearInterval(b),console.log("Dropped test tube"),d.grabbed=!1,d.meshGrabbed=void 0,console.log("Current hand: ",d),console.log(y),console.log(a),y&&a.find(C=>{console.log(C,y);let M=y.name.split("-");return C.name==M[M.length-1]}).fadeAndRespawn(100)}[m,c].forEach(y=>{y.onButtonStateChangedObservable.add(b=>{let u=d.handID,C,M={left:"Fist",right:"Grip"},x=s.animationGroups.find((D,L)=>(console.log(L,u),D.name===`${u}_${M[u]}`));console.log(x._to),console.log(s.animationGroups[0],s.animationGroups[7]),x.goToFrame(b.value*(x._to-1)+1);let O=r(s.getMeshByName(d.handID));if(b.value>0&&(d.lastPosition=Object.assign({},g.origin)),b.value>0&&!d.grabbed){if(O){t=O,d.meshGrabbed=t,d.grabbed=!0,o.getWorldPointerRayToRef(g),d.lastPosition=Object.assign({},g.origin);let D=d.lastPosition,L=g.origin;L!=D&&(C=setInterval(()=>{let k=d.lastPosition;o.getWorldPointerRayToRef(g),k&&t&&t.moveWithCollisions(L.subtract(k)),!r(s.getMeshByName(u))&&t&&(console.log(u,t),f(t,C),t=null),d.lastPosition=Object.assign({},g.origin)},10))}}else(!b.value||!O)&&t&&(console.log(u,t),f(t,C),t=null)})})})})}function $(s){s.rotation.x=0,s.rotation.y=0,s.rotation.z=0}function me(s,e){s.onBeforeRenderObservable.add(function(){let t=["A","B","C"];for(let i=0;i<t.length;i++){const r=s.getMeshByName(`pivot-Cylinder-${t[i]}`),o=s.getMeshByName("Table");if(o&&r){const l=o.getBoundingInfo().boundingBox;r.position.z=(l.centerWorld.z+l.minimumWorld.z)/2}}});let n=["A","B","C"],a=[];for(let t of n){const i=s.getMeshByName(`pivot-Cylinder-${t}`);a.push(i);let r=new p(`${t}-rotateAroundZ`,"rotation.z",120,p.ANIMATIONTYPE_FLOAT,p.ANIMATIONLOOPMODE_CONSTANT),o=v(i,A);const l=[];l.push({frame:0,value:Math.PI*2}),l.push({frame:60,value:4.62}),o.animations.push(r),r.setKeys(l);let d=new p(`${t}-resetRotateAroundZ`,"rotation.z",120,p.ANIMATIONTYPE_FLOAT,p.ANIMATIONLOOPMODE_CONSTANT);const g=[];g.push({frame:0,value:4.62}),g.push({frame:60,value:Math.PI*2}),o.animations.push(d),d.setKeys(g)}for(let t=0;t<n.length;t++){const i=s.getMeshByName(`pivot-Cylinder-${n[t]}`),r=i.getBehaviorByName("PointerDrag");let o=[];for(let g of a)g!=i&&o.push(g);let l=v(i,A),d=!1;r.onDragObservable.add(()=>{const g=v(i,A).getBehaviorByName("Highlight");let c=!1;for(let m=0;m<n.length;m++){if(t==m)continue;const f=s.getMeshByName(`pivot-Cylinder-${n[m]}`);if($(i),$(f),i.intersectsMesh(f)){c=!0;let y=f.name.split("-")[2],u=`${i.name.split("-")[2]}to${y}`;if(e.tasks[e.currentState].label===u&&(e.tasks[e.currentState].next==="complete"?window.location.assign("."):e.currentState=e.tasks.indexOf(e.tasks.find(C=>C.label==e.tasks[e.currentState].next))),g){let C=v(f,A);g.highlightMesh(l),g.highlightMesh(C);let M=i.getAbsolutePosition()._x,x=f.getAbsolutePosition()._x;if(console.log("Current x: ",M,"Target x: ",x),x<M?(console.log("Left hit!"),l.rotation.y=Math.PI,f.rotation.y=l.rotation.y):(console.log("Right hit!"),l.rotation.y=0,f.rotation.y=l.rotation.y),!d){let O=l.getAnimationByName(`${n[t]}-rotateAroundZ`);d=!0,s.beginDirectAnimation(l,[O],0,60,!1,void 0,()=>{})}}break}else g.unhighlightMesh(v(f,A)),f.rotation.x=0,f.rotation.y=0,f.rotation.z=0}if(c==!1){g.unhighlightMesh(l);let m=l.getAnimationByName(`${n[t]}-resetRotateAroundZ`);d&&(d=!1,console.log(l,m,`${n[t]}-resetRotateAroundZ`),s.beginDirectAnimation(l,[m],0,60,!1,void 0,()=>{}))}}),r.onDragEndObservable.add(()=>{const g=v(i,A).getBehaviorByName("Highlight");for(let c of o){if(c==l)continue;let m=v(c,A);if(g.unhighlightMesh(l),g.unhighlightMesh(m),l.intersectsMesh(c)){let f=l.getAnimationByName(`${n[t]}-resetRotateAroundZ`);l.rotation.z==4.62&&s.beginDirectAnimation(l,[f],0,60,!1,void 0,()=>{})}}})}}var w;class ue{constructor(e){h(this,"flying",!1);h(this,"active",!1);h(this,"camera");h(this,"mesh");h(this,"offset",.3);h(this,"animations");h(this,"returnPosition");h(this,"returnRotation");h(this,"onPointerDownObserver");h(this,"xrCamera");h(this,"attach",(e,n,a,t,i)=>{const r=e.getScene();if(this.mesh=e,!n&&(n=r.activeCamera,!n))throw new Error("The scene has no active camera, and no camera was provided.");this.camera=n,a||(a=this.mesh.position),t||(t=this.mesh.rotation),i&&(this.offset=i),this.returnPosition=a,this.returnRotation=t,this.onPointerDownObserver=r.onPointerObservable.add(this.clipboardClick)});h(this,"detach",()=>{this.mesh.getScene().onPointerObservable.remove(this.onPointerDownObserver)});h(this,"clipboardClick",(e={type:z.POINTERDOWN,pickInfo:{pickedMesh:this.mesh}})=>{var n;if(e.type===z.POINTERDOWN){const a=(n=e.pickInfo)==null?void 0:n.pickedMesh;if(a&&(a===this.mesh||a.isDescendantOf(this.mesh))&&!this.flying){const t=this.active?N/2:0,i=this.active?0:N/2;R(this,w).call(this),this.flying=!0,this.mesh.billboardMode==I.BILLBOARDMODE_ALL?this.mesh.billboardMode=I.BILLBOARDMODE_NONE:this.mesh.billboardMode=I.BILLBOARDMODE_ALL,this.mesh.getScene().beginDirectAnimation(this.mesh,this.animations,t,i,!1,void 0,()=>{this.flying=!1,this.active=!this.active})}}});h(this,"calculateTargetPositionWithOffset",e=>{if(this.xrCamera!==void 0&&this.xrCamera.state===X.IN_XR){const r=this.xrCamera.camera._position.subtract(this.returnPosition).scale(1-e/B.Distance(this.returnPosition,this.xrCamera.camera._position));return this.returnPosition.add(r)}const a=this.camera._position.subtract(this.returnPosition).scale(1-e/B.Distance(this.returnPosition,this.camera._position));return this.returnPosition.add(a)});h(this,"setClipboardUp",()=>new B(3.1468286,4.6617744,1.680752));_(this,w,()=>{const e=this.animations.find(({name:i})=>i==="translate"),n=this.animations.find(({name:i})=>i==="rotate"),a=[{frame:0,value:this.returnPosition},{frame:N/2,value:this.calculateTargetPositionWithOffset(this.offset)}],t=[{frame:0,value:this.returnRotation},{frame:N/2,value:this.setClipboardUp()}];e.setKeys(a),n.setKeys(t)});const n=new p("translate","position",N,p.ANIMATIONTYPE_VECTOR3),a=new p("rotate","rotation",N,p.ANIMATIONTYPE_VECTOR3);this.animations=[n,a],this.xrCamera=e}get name(){return"FlyToCamera"}init(){}}w=new WeakMap;console.log=()=>{};class fe{constructor(){h(this,"handAnimation");h(this,"sop");h(this,"models");h(this,"cylinders");this.cylinders=[],this.models=[{fileName:"NewLaboratoryUNFINISHED.glb",callback:e=>this.createRoom(e),label:"floor"},{fileName:"clipBoardWithPaperCompressedTexture.glb",callback:e=>he(e[0])},{fileName:"Placard_Label.glb",callback:e=>S(e,1,"Placard-A")},{fileName:"Placard_Label.glb",callback:e=>S(e,2,"Placard-B")},{fileName:"Placard_Label.glb",callback:e=>S(e,3,"Placard-C")},{fileName:"TLLGraduatedCylinderWithLabel.glb",callback:e=>this.cylinders.push(new T(e[0],1,"A",new P(1,0,0))),label:"Cylinder-A"},{fileName:"TLLGraduatedCylinderWithLabel.glb",callback:e=>this.cylinders.push(new T(e[0],2,"B",new P(0,1,0))),label:"Cylinder-B"},{fileName:"TLLGraduatedCylinderWithLabel.glb",callback:e=>this.cylinders.push(new T(e[0],3,"C",new P(0,0,1))),label:"Cylinder-C"}].map(function(e){return Object.assign({},{fileName:"LabBench.glb",root:"./models/",callback:ce,label:"NoLabel"},e)}),this.createScene().then(e=>{for(let n of["A","B","C"])Object.assign({},e.getMeshByName(`pivot-Cylinder-${n}`).position);this.processScene(e,this.cylinders)})}async processScene(e,n){let a=e.getCameraByName("camera"),t=e.getLightByName("light1"),i;a.speed=.16;let r=setInterval(()=>{t.intensity>=1?clearInterval(r):t.intensity+=.1},60);const o=["WallsandFloor","WallsAndFloor.001"],l=[];for(let g of o){console.log(g);const c=e.getMeshByName(g);c&&l.push(c)}let d={floorMeshes:l,inputOptions:{doNotLoadControllerMeshes:!0}};i=await e.createDefaultXRExperienceAsync(d),i.pointerSelection.displayLaserPointer=!1,i.pointerSelection.displaySelectionMesh=!1,de(e,i,n).then(g=>{const c=e.getMeshByName("clipboard");if(i){const m=new ue(i.baseExperience);c.addBehavior(m)}me(e,le),ge(e,i,g,n)})}createRoom(e){const n=["WallsandFloor","WallsAndFloor.001","Table","Roof","Countertop","Walls"];let a,t;for(let i of n){const r=e.find(o=>o.name===i);if(r&&(r.checkCollisions=!0,r.name==="Table")){const l=r.getBoundingInfo().boundingBox.center.x;a=r.getScene(),t=a.getCameraByName("camera"),t.position.x=l-.7}}}createScene(){return new Promise(e=>{var n=document.getElementById("canvas"),a=new J(n,!0,{stencil:!0}),t=new ee(a);t.collisionsEnabled=!0,window.addEventListener("resize",function(){a.resize()});const i=new te("camera",new B(0,1.84,-1.134),t);i.ellipsoid=new B(.4,.7,.4),i.attachControl(n,!0),i.applyGravity=!0,i.minZ=0,i.speed=0,i.checkCollisions=!0,i.keysUp.push(87),i.keysDown.push(83),i.keysLeft.push(65),i.keysRight.push(68);var r=new ie("light1",new B(1,1,0),t);r.intensity=0,Promise.all(this.models.map(o=>new Promise(l=>ne.ImportMesh("",o.root,o.fileName,t,function(d){o.mesh=d,l(d)})))).then(()=>{let o=[];this.models.map(l=>{o.push(l.callback(l.mesh)),e(t)})}),window.addEventListener("keydown",o=>{o.shiftKey&&o.ctrlKey&&o.altKey&&o.keyCode===73&&(t.debugLayer.isVisible()?t.debugLayer.hide():t.debugLayer.show())}),a.runRenderLoop(()=>{t.render()})})}}new fe;
