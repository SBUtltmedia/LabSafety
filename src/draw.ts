import { SceneLoader } from '@babylonjs/core/Loading/sceneLoader';
import { Color3, CreateGround, CreateSphere, DynamicTexture, StandardMaterial, Vector3 } from '@babylonjs/core';
import { modelsPath } from './constants';

SceneLoader.ImportMeshAsync('', modelsPath, 'clipBoardWithPaperCompressedTexture.glb').then(result => {
    const clipboard = result.meshes.find(mesh => mesh.name === 'Plane')!;
    clipboard.isVisible = false;
    clipboard.getChildMeshes().forEach(mesh => mesh.isVisible = false);
    clipboard.position = new Vector3(0, 1, 0);
    const dynamicTexture = new DynamicTexture('test-texture', 5);
    // const clipboardMaterial = new StandardMaterial('clipboard-material', scene);
    // clipboardMaterial.diffuseTexture = dynamicTexture;
    // clipboard.material = clipboardMaterial;
    const sphere = CreateSphere('sphere', {
        diameter: 10
    });
    sphere.position.y += 5;
    const sphereMaterial = new StandardMaterial('clipboard-material');
    sphereMaterial.diffuseTexture = dynamicTexture;
    sphere.material = sphereMaterial;
    const ctx = dynamicTexture.getContext();
    const img = new Image();
    // const img = document.getElementById('imgElement')! as HTMLImageElement;
    const imgSrc = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiCiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIKICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczpzb2RpcG9kaT0iaHR0cDovL3NvZGlwb2RpLnNvdXJjZWZvcmdlLm5ldC9EVEQvc29kaXBvZGktMC5kdGQiCiAgIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIgogICB3aWR0aD0iNDQ5LjEwNTE2IgogICBoZWlnaHQ9IjQyNS43MTQyOSIKICAgaWQ9InN2ZzIiCiAgIHZlcnNpb249IjEuMSIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMC40OC4wIHI5NjU0IgogICBzb2RpcG9kaTpkb2NuYW1lPSJzdGFyLnN2ZyI+CiAgPGRlZnMKICAgICBpZD0iZGVmczQiPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDUyNi4xODEwOSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI3NDQuMDk0NDggOiA1MjYuMTgxMDkgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjM3Mi4wNDcyNCA6IDM1MC43ODczOSA6IDEiCiAgICAgICBpZD0icGVyc3BlY3RpdmUyOTg1IiAvPgogIDwvZGVmcz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaWQ9ImJhc2UiCiAgICAgcGFnZWNvbG9yPSIjMDAwMDAwIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjAuMzUiCiAgICAgaW5rc2NhcGU6Y3g9Ii0yNzUuNDk2MDciCiAgICAgaW5rc2NhcGU6Y3k9IjExMS45OTI1MSIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBmaXQtbWFyZ2luLXRvcD0iMCIKICAgICBmaXQtbWFyZ2luLWxlZnQ9IjAiCiAgICAgZml0LW1hcmdpbi1yaWdodD0iMCIKICAgICBmaXQtbWFyZ2luLWJvdHRvbT0iMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzMTkiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iNzgxIgogICAgIGlua3NjYXBlOndpbmRvdy14PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIyMiIKICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIwIiAvPgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIgogICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0xNDQuNzgxNzgsLTIxOC42NDA0KSI+CiAgICA8cmVjdAogICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZSIKICAgICAgIGlkPSJyZWN0MzgzNCIKICAgICAgIHdpZHRoPSI0NDkuMTA1MTYiCiAgICAgICBoZWlnaHQ9IjQyNS43MTQyOSIKICAgICAgIHg9IjE0NC43ODE3OCIKICAgICAgIHk9IjIxOC42NDA0IgogICAgICAgcng9IjcuNzM2NTM4NCIKICAgICAgIHJ5PSIwIiAvPgogICAgPHBhdGgKICAgICAgIHNvZGlwb2RpOnR5cGU9InN0YXIiCiAgICAgICBzdHlsZT0iZmlsbDojZmZmZjM3O2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojZmM3NTAwO3N0cm9rZS13aWR0aDoxOTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2Utb3BhY2l0eToxO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowIgogICAgICAgaWQ9InBhdGgzNzc1IgogICAgICAgc29kaXBvZGk6c2lkZXM9IjUiCiAgICAgICBzb2RpcG9kaTpjeD0iMTkxLjQyODU3IgogICAgICAgc29kaXBvZGk6Y3k9IjE0Ni43MjA3OSIKICAgICAgIHNvZGlwb2RpOnIxPSIyMDYuNDI3MzQiCiAgICAgICBzb2RpcG9kaTpyMj0iOTMuMjYwNTY3IgogICAgICAgc29kaXBvZGk6YXJnMT0iLTEuNTcwNzk2MyIKICAgICAgIHNvZGlwb2RpOmFyZzI9Ii0wLjk4MDYyODQ5IgogICAgICAgaW5rc2NhcGU6ZmxhdHNpZGVkPSJmYWxzZSIKICAgICAgIGlua3NjYXBlOnJvdW5kZWQ9IjAiCiAgICAgICBpbmtzY2FwZTpyYW5kb21pemVkPSIwLjAxNSIKICAgICAgIGQ9Ik0gMTg4Ljk5NjA0LC02MS4zODQxNDUgMjQxLjc0MDIsNjcuOTU0NjU1IDM4NC45NjU3Miw4NC4yNjM1OTIgMjgxLjA5OTQ0LDE3My44MTUwNCAzMTUuMjQ0NTMsMzEzLjM3MzA5IDE5Ny44MDQ4MywyNDEuODQxMjggNzEuMDM4MDU3LDMxNS43MzE1OCAxMDMuMDI3NDEsMTc3LjM5MDA5IC0yLjE0Mzk3MTIsODIuMjcwMDIyIDEzMS44OTU0Miw3NS4zNDgxOTQgeiIKICAgICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE4Mi4xNTAzMywzMDQuODQ2MzEpIgogICAgICAgaW5rc2NhcGU6dHJhbnNmb3JtLWNlbnRlci14PSIwLjAxNzcwMzI1OSIKICAgICAgIGlua3NjYXBlOnRyYW5zZm9ybS1jZW50ZXIteT0iLTE5LjU0NzA3NCIgLz4KICA8L2c+Cjwvc3ZnPgo=';
    // const imgSrc = 'data:image/svg+xml;utf8,' + encodeURIComponent($('#sopHolder').html());
    img.src = imgSrc;
    console.log(imgSrc);

    img.addEventListener('load', function() {
        // console.log('this', this);
        ctx.drawImage(this, 0, 0, 19, 19);
        // dynamicTexture.drawText('SOP: don\'t blow up.', 0, 0, 'bold 440px monospace', 'red', 'white');
        dynamicTexture.update();
    });

});
